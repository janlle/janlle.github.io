<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-openCV" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/openCV/" class="article-date">
  <time datetime="2019-02-04T12:16:14.052Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="openCV-调用网络摄像头"><a href="#openCV-调用网络摄像头" class="headerlink" title="openCV 调用网络摄像头"></a>openCV 调用网络摄像头</h1><h2 id="所需要硬件及软件环境"><a href="#所需要硬件及软件环境" class="headerlink" title="所需要硬件及软件环境"></a>所需要硬件及软件环境</h2><p>python3.6，一个网络摄像头，openCV，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line"># @author leone</span><br><span class="line"># @desc 使用 python 的 openCV 获取网络摄像头的数据</span><br><span class="line"># @version 2018-12-23</span><br><span class="line"></span><br><span class="line">import cv2</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"># 根据摄像头设置IP及rtsp端口</span><br><span class="line">url = &apos;rtsp://account:password@192.168.0.35:554/11&apos;</span><br><span class="line"></span><br><span class="line"># 读取视频流</span><br><span class="line">cap = cv2.VideoCapture(url)</span><br><span class="line"># 设置视频参数</span><br><span class="line">cap.set(3, 480)</span><br><span class="line"></span><br><span class="line">print(cap.isOpened())</span><br><span class="line"></span><br><span class="line">print(sys.version)</span><br><span class="line"></span><br><span class="line">print(cv2.__version__)</span><br><span class="line"></span><br><span class="line">while cap.isOpened():</span><br><span class="line">    ret_flag, img_camera = cap.read()</span><br><span class="line">    cv2.imshow(&quot;camera&quot;, img_camera)</span><br><span class="line"></span><br><span class="line">    # 每帧数据延时 1ms, 延时为0, 读取的是静态帧</span><br><span class="line">    k = cv2.waitKey(1)</span><br><span class="line">    if k == ord(&apos;s&apos;):</span><br><span class="line">        cv2.imwrite(&quot;test.jpg&quot;, img_camera)</span><br><span class="line">    if k == ord(&apos;q&apos;):</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line"># 释放所有摄像头</span><br><span class="line">cap.release()</span><br><span class="line"></span><br><span class="line"># 删除窗口</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
<p>由于网络摄像头的<a href="https://zh.wikipedia.org/wiki/%E5%8D%B3%E6%99%82%E4%B8%B2%E6%B5%81%E5%8D%94%E5%AE%9A" target="_blank" rel="noopener">RTSP</a>:实时流协议要手动开启，进入你的摄像头管理界面，例如：192.168.0.35 找到设置-&gt;网络设置-&gt;RTSP设置-&gt;开启RTSP开关 最好保存设置，并重启摄像头。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/openCV/" data-id="cjrqbftxx000gakc4acg5995i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/Nginx/" class="article-date">
  <time datetime="2019-02-04T12:16:14.034Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><h2 id="nginx详解"><a href="#nginx详解" class="headerlink" title="nginx详解"></a>nginx详解</h2><h3 id="什么是nginx"><a href="#什么是nginx" class="headerlink" title="什么是nginx"></a>什么是nginx</h3><p>Nginx (engine x) 是一个高性能的HTTP和反向代理服务，也是一个IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。<br>其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。2011年6月1日，nginx 1.0.4发布。<br>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好。</p>
<h2 id="nginx的安装配置详解"><a href="#nginx的安装配置详解" class="headerlink" title="nginx的安装配置详解"></a>nginx的安装配置详解</h2><h3 id="nginx的安装"><a href="#nginx的安装" class="headerlink" title="nginx的安装"></a>nginx的安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 安装nginx依赖包</span><br><span class="line">yum -y install gcc gcc-c++ make libtool zlib zlib-devel openssl openssl-devel pcre pcre-devel</span><br><span class="line"></span><br><span class="line"># 下载nginx</span><br><span class="line">$ wget http://nginx.org/download/nginx-1.8.0.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压缩</span><br><span class="line">$ tar -zxvf nginx-1.8.0.tar.gz</span><br><span class="line"></span><br><span class="line"># 配置</span><br><span class="line">$ ./configure --prefix=/usr/local/nginx</span><br><span class="line"></span><br><span class="line"># 编译并安装</span><br><span class="line">$ make &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"># 查看nginx的版本</span><br><span class="line">$ /usr/local/nginx/sbin/nginx -v</span><br><span class="line"></span><br><span class="line"># 校验nginx的配置是否正确</span><br><span class="line">$ /usr/local/nginx/sbin/nginx -t</span><br><span class="line"></span><br><span class="line"># 默认配置文件 /usr/local/nginx/conf/nginx.conf，-c 指定</span><br><span class="line">$ /usr/local/nginx/sbin/nginx     </span><br><span class="line"></span><br><span class="line">$ /usr/local/nginx/sbin/nginx -s reload # 重新载入配置文件</span><br><span class="line"></span><br><span class="line"># 重启Nginx，不会改变启动时指定的配置文件</span><br><span class="line">$ /usr/local/nginx/sbin/nginx -s reopen </span><br><span class="line"></span><br><span class="line"># 停止Nginx</span><br><span class="line">$ /usr/local/nginx/sbin/nginx -s stop</span><br></pre></td></tr></table></figure>
<h3 id="安装ssl模块"><a href="#安装ssl模块" class="headerlink" title="安装ssl模块"></a>安装ssl模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 进入nginx解压目录</span><br><span class="line">./configure --prefix=/usr/local/nginx --with-http_stub_status_module  --with-http_ssl_module</span><br><span class="line"></span><br><span class="line"># 编译不要make install，否则就覆盖安装了make完之后在objs目录下就生成会有一个nginx文件这个就是支持ssl的nginx程序</span><br><span class="line">$ make</span><br><span class="line"></span><br><span class="line"># 备份旧的nginx程序</span><br><span class="line">cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak</span><br><span class="line"></span><br><span class="line"># 把新的nginx程序覆盖旧的</span><br><span class="line">cp objs/nginx /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>
<h3 id="nginx-配置文件"><a href="#nginx-配置文件" class="headerlink" title="nginx 配置文件"></a>nginx 配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"># nginx进程,一般设置为和cpu核数一样</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line"># 错误日志存放目录 </span><br><span class="line"># 全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line"># 进程pid存放位置</span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"># 一个nginx进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值ulimit -n）与nginx进程数相除，但是nginx分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span><br><span class="line">worker_rlimit_nofile 65535;</span><br><span class="line"></span><br><span class="line"># nginx工作模式配置</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    # 单个后台worker process进程的最大并发链接数</span><br><span class="line">    worker_connections  1024;     </span><br><span class="line">    multi_accept        on;       </span><br><span class="line">    # epoll是多路复用IO(I/O Multiplexing)中的一种方式,但是仅用于linux2.6以上内核,可以大大提高nginx的性能</span><br><span class="line">    use                 epoll;            </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># http设置</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    # 文件扩展名与文件类型映射表</span><br><span class="line">    include           mime.types;</span><br><span class="line">    # 默认文件类型</span><br><span class="line">    default_type      application/octet-stream;</span><br><span class="line">    </span><br><span class="line">    # 开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。</span><br><span class="line">    sendfile           on;</span><br><span class="line"></span><br><span class="line">    # 长连接超时时间，单位是秒</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line">    </span><br><span class="line">    # 存储访问记录的日志目录</span><br><span class="line">    access_log         logs/access.log; </span><br><span class="line"></span><br><span class="line">    # 存储记录错误发生的日志目录</span><br><span class="line">    error_log          logs/error.log;  </span><br><span class="line"></span><br><span class="line">    # 设定mime类型,类型由mime.type文件定义</span><br><span class="line">    include mime.types;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name    *.xxx.com;</span><br><span class="line">        return         301 https://$server_name$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 虚拟主机的配置</span><br><span class="line">    server &#123;</span><br><span class="line">        # 监听端口</span><br><span class="line">        listen                  443 ssl;</span><br><span class="line"></span><br><span class="line">        # 域名可以有多个，用空格隔开</span><br><span class="line">        server_name             *.xxx.com;</span><br><span class="line">        </span><br><span class="line">        # 字符集</span><br><span class="line">        charset                 utf-8;</span><br><span class="line">        ssl                     on;</span><br><span class="line">        # 证书路径</span><br><span class="line">        ssl_certificate         /xxx/yyy/fullchain.pem;</span><br><span class="line">        # 私钥路径</span><br><span class="line">        ssl_certificate_key     /xxx/yyy/privkey.pem;</span><br><span class="line"></span><br><span class="line">        # 开启gzip压缩</span><br><span class="line">        gzip  on;</span><br><span class="line"></span><br><span class="line">        # 连接超时时间</span><br><span class="line">        keepalive_timeout  65;</span><br><span class="line">        </span><br><span class="line">        location / &#123;</span><br><span class="line">            # 访问域名跟目录</span><br><span class="line">            root       /xxx/xxx/;</span><br><span class="line"></span><br><span class="line">            # 载入其他配置文件</span><br><span class="line">            index      index.html;</span><br><span class="line"></span><br><span class="line">            if ($host ~ ^(api)\.rllin\.cn$)&#123;</span><br><span class="line">                  proxy_pass http://0.0.0.0:9901;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if ($host ~ ^(dev)\.rllin\.cn$)&#123;</span><br><span class="line">                  proxy_pass http://0.0.0.0:9902;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        # 错误页面</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        </span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">            root   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    # 其他配置文件位置</span><br><span class="line">    include /usr/local/nginx/conf.d/*.xxx.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/Nginx/" data-id="cjrqbftxd0003akc4oeux9bw8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-install" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/mysql-install/" class="article-date">
  <time datetime="2019-02-04T12:16:14.005Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="linux下安装mysql8"><a href="#linux下安装mysql8" class="headerlink" title="linux下安装mysql8"></a>linux下安装mysql8</h3><ul>
<li>下载mysql <blockquote>
<p>$ wget <a href="http://mirrors.ustc.edu.cn/mysql-ftp/Downloads/MySQL-8.0/mysql-8.0.4-rc-linux-glibc2.12-x86_64.tar.gz" target="_blank" rel="noopener">http://mirrors.ustc.edu.cn/mysql-ftp/Downloads/MySQL-8.0/mysql-8.0.4-rc-linux-glibc2.12-x86_64.tar.gz</a></p>
</blockquote>
</li>
<li>解压<blockquote>
<p>$ mysql tar -zxvf mysql-8.0.4-rc-linux-glibc2.12-x86_64.tar.gz -C /usr/local/</p>
</blockquote>
</li>
<li>修改文件夹名称 <blockquote>
<p>$ mv mysql-8.0.4-rc-linux-glibc2.12-x86_64/ mysql</p>
</blockquote>
</li>
<li>添加默认配置文件<blockquote>
<p>$ vim/etc/my.cnf</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">port=3306</span><br><span class="line">socket=/tmp/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">user=mysql</span><br><span class="line">socket=/tmp/mysql/mysql.sock</span><br><span class="line">basedir=/usr/local/mysql</span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line">log-error=error.log</span><br></pre></td></tr></table></figure>
<ul>
<li><p>创建mysql组和mysql用户</p>
<blockquote>
<p>$ groupadd mysql<br>$ useradd -g mysql mysql</p>
</blockquote>
</li>
<li><p>初始化mysql </p>
<blockquote>
<p>$ /usr/local/mysql/bin/mysqld  –initialize –user=mysql –basedir=/usr/local/mysql/ –datadir=/usr/local/mysql/data/</p>
</blockquote>
</li>
</ul>
<ul>
<li>在初始化过程中可能会遇到错误，日志如下可以修改/tmp/mysql的目录权限<blockquote>
<p>$ chown -R mysql:mysql /tmp/mysql</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2018-07-08T02:53:24.542370Z 0 [System] [MY-010116] /usr/local/mysql/bin/mysqld (mysqld 8.0.4-rc) starting as process 17745 ...</span><br><span class="line">mysqld: Can&apos;t create/write to file &apos;/tmp/mysql/data/ibd35qXQ&apos; (Errcode: 13 - Permission denied)</span><br><span class="line">2018-07-08T02:53:24.554816Z 1 [ERROR] [MY-011066] InnoDB: Unable to create temporary file; errno: 13</span><br><span class="line">2018-07-08T02:53:24.554856Z 1 [ERROR] [MY-011066] InnoDB: InnoDB Database creation was aborted with error Generic error. You may need to delete the ibdata1 file before trying to start up again.</span><br><span class="line">2018-07-08T02:53:24.555000Z 0 [ERROR] [MY-010020] Data Dictionary initialization failed.</span><br><span class="line">2018-07-08T02:53:24.555033Z 0 [ERROR] [MY-010119] Aborting</span><br><span class="line">2018-07-08T02:53:24.555919Z 0 [System] [MY-010910] /usr/local/mysql/bin/mysqld: Shutdown complete.</span><br></pre></td></tr></table></figure>
<ul>
<li><p>如果无异常情况日志如下可以看到mysql默认会生成root账号和密码root@localhost: J&amp;:rqhMd/9&gt;f</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2018-07-08T02:57:57.631578Z 0 [System] [MY-010116] /usr/local/mysql/bin/mysqld (mysqld 8.0.4-rc) starting as process 18894 ...</span><br><span class="line">2018-07-08T02:58:03.499117Z 0 [Warning] [MY-010068] CA certificate ca.pem is self signed.</span><br><span class="line">2018-07-08T02:58:03.718786Z 5 [Note] [MY-010454] A temporary password is generated for root@localhost: J&amp;:rqhMd/9&gt;f</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来可以启动mysql服务器</p>
<blockquote>
<p>$ ./support-files/mysql.server start</p>
</blockquote>
</li>
<li>修改mysql的默认初始化密码<blockquote>
<p>$ alter user ‘root‘@’%’ identified with mysql_native_password by ‘root’;</p>
</blockquote>
</li>
<li>创建用户 <blockquote>
<p>$ create user ‘jack‘@’localhost’ identified by ‘jack’;</p>
</blockquote>
</li>
<li>授予权限 <blockquote>
<p>$ grant replication slave on <em>.</em> to ‘jack‘@’localhost’;</p>
</blockquote>
</li>
<li>刷新<blockquote>
<p>$ flush privileges; </p>
</blockquote>
</li>
<li>修改root用户可以远程连接<blockquote>
<p>$ update mysql.user set host=’%’ where user=’root’</p>
</blockquote>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/mysql-install/" data-id="cjrqbftxw000fakc4ydozjgky" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MySql" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/MySql/" class="article-date">
  <time datetime="2019-02-04T12:16:13.991Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><h2 id="MySQL简介"><a href="#MySQL简介" class="headerlink" title="MySQL简介"></a>MySQL简介</h2><p>MySQL原本是一个开放源代码的关系数据库管理系统，原开发者为瑞典的MySQL AB公司，该公司于2008年被昇阳微系统（Sun Microsystems）收购。2009年，甲骨文公司（Oracle）收购昇阳微系统公司，MySQL成为Oracle旗下产品。</p>
<p>MySQL在过去由于性能高、成本低、可靠性好，已经成为最流行的开源数据库，因此被广泛地应用在Internet上的中小型网站中。随着MySQL的不断成熟，它也逐渐用于更多大规模网站和应用，比如维基百科、Google和Facebook等网站。非常流行的开源软件组合LAMP中的“M”指的就是MySQL。</p>
<p>但被甲骨文公司收购后，Oracle大幅调涨MySQL商业版的售价，且甲骨文公司不再支持另一个自由软件项目OpenSolaris的发展，因此导致自由软件社群们对于Oracle是否还会持续支持MySQL社群版（MySQL之中唯一的免费版本）有所隐忧，MySQL的创始人麦克尔·维德纽斯以MySQL为基础，成立分支计划MariaDB。而原先一些使用MySQL的开源软件逐渐转向MariaDB或其它的数据库。例如维基百科已于2013年正式宣布将从MySQL迁移到MariaDB数据库[6]。</p>
<h3 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h3><p>关系数据库（英语：Relational database），是创建在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示。关系模型是由埃德加·科德于1970年首先提出的，并配合“科德十二定律”。现如今虽然对此模型有一些批评意见，但它还是数据存储的传统标准。标准数据查询语言SQL就是一种基于关系数据库的语言，这种语言执行对关系数据库中数据的检索和操作。</p>
<p>关系模型由关系数据结构、关系操作集合、关系完整性约束三部分组成。</p>
<h3 id="MySQL特性"><a href="#MySQL特性" class="headerlink" title="MySQL特性"></a>MySQL特性</h3><p>MySQL是一种使用广泛的数据库，特性如下：</p>
<ul>
<li>使用C和C++编写，并使用了多种编译器进行测试，保证源代码的可移植性 
　　</li>
<li><p>支持AIX、FreeBSD、HP-UX、Linux、Mac OS、Novell Netware、OpenBSD、OS/2<br>Wrap、Solaris、Windows等多种操作系统。 　　</p>
</li>
<li><p>为多种编程语言提供了API。编程语言包括C、C++、Python、Java、Perl、PHP、Eiffel、Ruby和Tcl等。 　　</p>
</li>
<li><p>支持多线程，充分利用CPU资源 　　</p>
</li>
<li><p>优化的SQL查询算法，有效地提高查询速度</p>
</li>
<li><p>既能够作为一个单独的应用程序应用在客户端服务器网络环境中，也能够作为一个库而<br>嵌入到其他的软件中提供多语言支持，常见的编码如中文的GB 2312、BIG5，日文的Shift_JIS等都可以用作数据表名和数据列名</p>
</li>
<li><p>提供TCP/IP、ODBC和JDBC等多种数据库连接途径</p>
</li>
<li><p>提供用于管理、检查、优化数据库操作的管理工具 </p>
</li>
<li><p>可以处理拥有上千万条记录的大型数据库</p>
</li>
</ul>
<h3 id="MySQL应用"><a href="#MySQL应用" class="headerlink" title="MySQL应用"></a>MySQL应用</h3><p>与大型数据库例如Oracle、DB2、SQL Server等相比，MySQL自有它的不足之处，如规模小、功能有限（MySQL Cluster的功能和效率都相对比较差）等，但是这丝毫也没有减少它受欢迎的程度。对于一般的个人使用者和中小型企业来说，MySQL提供的功能已经绰绰有余，而且由于MySQL是开放源码软件，因此可以大大降低总体拥有成本。 目前Internet上流行的网站构架方式是LAMP（Linux+Apache+MySQL+PHP），即使用Linux作为操作系统，Apache作为Web服务器，MySQL作为数据库，PHP作为服务器端脚本解释器。由于Linux+Apache+MySQL+PHP都是自由或开放源码软件（FLOSS)，因此使用LAMP不用花一分钱就可以建立起一个稳定、免费的网站系统。</p>
<h3 id="MySLQ存储引擎"><a href="#MySLQ存储引擎" class="headerlink" title="MySLQ存储引擎"></a>MySLQ存储引擎</h3><ul>
<li>MySQL存储引擎简介</li>
</ul>
<p>插件式存储引擎是MySQL数据库最重要的特性之一，用户可以根据应用的需要选择如何存储和索引数据库，是否使用事务等。mySQL默认支持多种存储引擎，以适应不同领域的数据库应用需要。用户可以通过选择使用不同的存储引擎提高应用的效率，提供灵活的存储，用户设置可以按照自己的需要定制和使用自己的存储引擎，以实现最大程度的可定制性。<br>MySQL常用的存储引擎为MyISAM、InnoDB、MEMORY、MERGE，其中InnoDB提供事务安全表，其他存储引擎都是非事务安全表。<br>MyISAM是MySQL的默认存储引擎。MyISAM不支持事务、也不支持外键，但其访问速度快，对事务完整性没有要求。<br>InnoDB存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但是比起MyISAM存储引擎，InnoDB写的处理效率差一些并且会占用更多的磁盘空间以保留数据和索引。MySQL支持外键存储引擎只有InnoDB，在创建外键的时候，要求附表必须有对应的索引，子表在创建外键的时候也会自动创建对应的索引。</p>
<ul>
<li>MySQL存储引擎特性</li>
</ul>
<p>主要体现在性能、事务、并发控制、参照完整性、缓存、故障恢复，备份及回存等几个方面<br>目前比较普及的存储引擎是MyISAM和InnoDB，而MyISAM又是绝大部分Web应用的首选。MyISAM与InnoDB的主要的不同点在于性能和事务控制上。<br>MyISAM是早期ISAM(Indexed Sequential Access Method）的扩展实现，ISAM被设计为适合处理读频率远大于写频率的情况，因此ISAM以及后来的MyISAM都没有考虑对事物的支持，不需要事务记录，ISAM的查询效率相当可观，而且内存占用很少。MyISAM在继承了ISAM优点的同时，与时俱进的提供了大量实用的新特性和相关工具。例如考虑到并发控制，提供了表级锁。而且由于MyISAM是每张表使用各自独立的存储文件（MYD数据文件和MYI索引文件），使得备份及恢复十分方便（拷贝覆盖即可），而且还支持在线恢复。<br>所以如果应用不需要事务，不支持外键，处理的只是基本的CRUD（增删改查）操作，那么MyISAM是不二选择。</p>
<h2 id="linux-CentOS7-5-x86-64-下安装mysql8-0"><a href="#linux-CentOS7-5-x86-64-下安装mysql8-0" class="headerlink" title="linux (CentOS7.5_x86_64)下安装mysql8.0"></a>linux (CentOS7.5_x86_64)下安装mysql8.0</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"># 下载mysql </span><br><span class="line"></span><br><span class="line">$ wget http://mirrors.163.com/mysql/Downloads/MySQL-8.0/mysql-8.0.13-el7-x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">$ mysql tar -zxvf mysql-8.0.4-rc-linux-glibc2.12-x86_64.tar.gz -C /usr/local</span><br><span class="line"></span><br><span class="line"># 修改文件夹名称 </span><br><span class="line">$ mv mysql-8.0.4-rc-linux-glibc2.12-x86_64/ mysql</span><br><span class="line"></span><br><span class="line">添加默认配置文件</span><br><span class="line">$ vim/etc/my.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">port=3306</span><br><span class="line">socket=/tmp/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">user=mysql</span><br><span class="line">socket=/tmp/mysql/mysql.sock</span><br><span class="line">basedir=/usr/local/mysql</span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建mysql组</span><br><span class="line">$ groupadd mysql</span><br><span class="line"></span><br><span class="line"># 创建mysql用户</span><br><span class="line">$ useradd -g mysql mysql</span><br><span class="line"></span><br><span class="line"># 创建mysql数据目录</span><br><span class="line">$ mkdir $MYSQL_HOME/data</span><br><span class="line"></span><br><span class="line"># 初始化mysql </span><br><span class="line">$ /usr/local/mysql/bin/mysqld  --initialize --user=mysql --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 初始化报错</span><br><span class="line">bin/mysqld: error while loading shared libraries: libaio.so.1: cannot open shared object file: No such file or directory</span><br><span class="line"></span><br><span class="line"># 解决方法</span><br><span class="line">yum install -y libaio</span><br><span class="line"></span><br><span class="line"># 初始化报错</span><br><span class="line">2018-07-08T02:53:24.542370Z 0 [System] [MY-010116] /usr/local/mysql/bin/mysqld (mysqld 8.0.4-rc) starting as process 17745 ...</span><br><span class="line">mysqld: Can&apos;t create/write to file &apos;/tmp/mysql/data/ibd35qXQ&apos; (Errcode: 13 - Permission denied)</span><br><span class="line">2018-07-08T02:53:24.554816Z 1 [ERROR] [MY-011066] InnoDB: Unable to create temporary file; errno: 13</span><br><span class="line">2018-07-08T02:53:24.554856Z 1 [ERROR] [MY-011066] InnoDB: InnoDB Database creation was aborted with error Generic error. You may need to delete the ibdata1 file before trying to start up again.</span><br><span class="line">2018-07-08T02:53:24.555000Z 0 [ERROR] [MY-010020] Data Dictionary initialization failed.</span><br><span class="line">2018-07-08T02:53:24.555033Z 0 [ERROR] [MY-010119] Aborting</span><br><span class="line">2018-07-08T02:53:24.555919Z 0 [System] [MY-010910] /usr/local/mysql/bin/mysqld: Shutdown complete.</span><br><span class="line"></span><br><span class="line"># 解决办法：修改/tmp/mysql的目录权限</span><br><span class="line">$ chown -R mysql:mysql /tmp/mysql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 初始化成功</span><br><span class="line">&gt; 如果无异常情况日志如下可以看到mysql默认会生成root账号和密码root@localhost: /TI(mjVAs1Ta</span><br><span class="line"></span><br><span class="line">[root@localhost mysql]# bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data</span><br><span class="line">2019-01-29T10:19:34.023997Z 0 [System] [MY-013169] [Server] /usr/local/mysql/bin/mysqld (mysqld 8.0.13) initializing of server in progress as process 4240</span><br><span class="line">2019-01-29T10:19:39.764895Z 5 [Note] [MY-010454] [Server] A temporary password is generated for root@localhost: /TI(mjVAs1Ta</span><br><span class="line">2019-01-29T10:19:43.041419Z 0 [System] [MY-013170] [Server] /usr/local/mysql/bin/mysqld (mysqld 8.0.13) initializing of server has completed</span><br><span class="line"></span><br><span class="line"># 拷贝mysql启动文件到系统初始化目录</span><br><span class="line">$ cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动mysql服务器</span><br><span class="line">$ service mysqld start</span><br></pre></td></tr></table></figure>
<h3 id="mysql-基本操作"><a href="#mysql-基本操作" class="headerlink" title="mysql 基本操作"></a>mysql 基本操作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 使用mysql客户端连接mysql</span><br><span class="line">$ /usr/local/mysql/bin/mysql -u root -p password</span><br><span class="line"></span><br><span class="line">修改mysql的默认初始化密码</span><br><span class="line">&gt; alter user &apos;root&apos;@&apos;localhost&apos; identified by &apos;root&apos;;</span><br><span class="line"></span><br><span class="line"># 创建用户 CREATE USER &apos;用户名称&apos;@&apos;主机名称&apos; INDENTIFIED BY &apos;用户密码&apos;</span><br><span class="line">&gt; create user &apos;jack&apos;@&apos;localhost&apos; identified by &apos;jack&apos;;</span><br><span class="line"></span><br><span class="line"># 授予权限  grant 权限 on 数据库.表 to &apos;用户名&apos;@&apos;登录主机&apos;  [INDENTIFIED BY &apos;用户密码&apos;];</span><br><span class="line">&gt; grant replication slave on *.* to &apos;jack&apos;@&apos;localhost&apos;;</span><br><span class="line"></span><br><span class="line"># 刷新</span><br><span class="line"># $ flush privileges; </span><br><span class="line"></span><br><span class="line"># 修改root用户可以远程连接</span><br><span class="line">&gt; update mysql.user set host=&apos;%&apos; where user=&apos;root&apos;;</span><br><span class="line"></span><br><span class="line"># 查看mysql所用用户</span><br><span class="line">&gt; select user,host from mysql.user;</span><br><span class="line"></span><br><span class="line"># docker 修改mysql的最大连接数</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install vim</span><br><span class="line">vim /etc/mysql/mysql.conf.d/mysqld.cnf</span><br><span class="line">max_connections=1000</span><br><span class="line"></span><br><span class="line">&gt; alter user &apos;root&apos;@&apos;%&apos; identified with mysql_native_password by &apos;root&apos;;</span><br></pre></td></tr></table></figure>
<h2 id="mysql-集群主从复制"><a href="#mysql-集群主从复制" class="headerlink" title="mysql 集群主从复制"></a>mysql 集群主从复制</h2><p>准备两台安装好的mysql服务器<br>192.168.79.15    (master)<br>192.168.79.16    (slave)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"># 配置主服务添加如下配置</span><br><span class="line">$ vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line"># 节点唯一id值</span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line"># 开启二进制日志</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line"># 指定日志格式 有mixed|row|statement 推荐mixed</span><br><span class="line">binlog-format=mixed</span><br><span class="line"></span><br><span class="line"># 步进值auto_imcrement。一般有n台主MySQL就填n(可选配置)</span><br><span class="line">auto_increment_increment=2  </span><br><span class="line"></span><br><span class="line"># 起始值。一般填第n台主MySQL。此时为第一台主MySQL(可选配置)</span><br><span class="line">auto_increment_offset=1   </span><br><span class="line"></span><br><span class="line"># 忽略mysql库(可选配置)</span><br><span class="line">binlog-ignore=mysql   </span><br><span class="line"></span><br><span class="line"># 忽略information_schema库(可选配置)</span><br><span class="line">binlog-ignore=information_schema   </span><br><span class="line"></span><br><span class="line"># 要同步的数据库，默认所有库(可选配置)</span><br><span class="line">replicate-do-db=db1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># slave 节点配置</span><br><span class="line"></span><br><span class="line"># 节点唯一id值</span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"># 开启二进制日志</span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line"># 步进值auto_imcrement。一般有n台主MySQL就填n(可选配置)</span><br><span class="line">auto_increment_increment=2</span><br><span class="line"></span><br><span class="line"># 起始值。一般填第n台主MySQL。此时为第一台主MySQL(可选配置)</span><br><span class="line">auto_increment_offset=2</span><br><span class="line"></span><br><span class="line"># 要同步的数据库，默认所有库(可选配置)</span><br><span class="line">replicate-do-db=db1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看 master 的状态 , 尤其是当前的日志及位置</span><br><span class="line">&gt; show master status;</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-bin.000004 |     1608 |              |                  |                   |</span><br><span class="line">+------------------+----------+--------------+------------------+-------------------+</span><br><span class="line"></span><br><span class="line"># 在slave节点执行如下命令</span><br><span class="line"></span><br><span class="line">注意master_log_file 是对应show master status;中file的值，master_log_pos是对应position的值</span><br><span class="line"></span><br><span class="line">&gt; change master to</span><br><span class="line">master_host=&apos;192.168.79.15&apos;,</span><br><span class="line">master_user=&apos;root&apos;,</span><br><span class="line">master_password=&apos;root&apos;,</span><br><span class="line">master_log_file=&apos;mysql-bin.000009&apos;,</span><br><span class="line">master_log_pos=0;</span><br><span class="line"></span><br><span class="line"># 启动 slave  状态 ( 开始监听 msater 的变化 )</span><br><span class="line">&gt; start slave;</span><br><span class="line"></span><br><span class="line"># 查看 slave 的状态 </span><br><span class="line">&gt; show slave status\G</span><br><span class="line"></span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 192.168.79.15</span><br><span class="line">                  Master_User: root</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-bin.000009</span><br><span class="line">          Read_Master_Log_Pos: 863</span><br><span class="line">               Relay_Log_File: node-6-relay-bin.000002</span><br><span class="line">                Relay_Log_Pos: 500</span><br><span class="line">        Relay_Master_Log_File: mysql-bin.000009</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: </span><br><span class="line">          Replicate_Ignore_DB: </span><br><span class="line">           Replicate_Do_Table: </span><br><span class="line">       Replicate_Ignore_Table: </span><br><span class="line">      Replicate_Wild_Do_Table: </span><br><span class="line">  Replicate_Wild_Ignore_Table: </span><br><span class="line">                   Last_Errno: 0</span><br><span class="line">                   Last_Error: </span><br><span class="line">                 Skip_Counter: 0</span><br><span class="line">          Exec_Master_Log_Pos: 863</span><br><span class="line">              Relay_Log_Space: 709</span><br><span class="line">              Until_Condition: None</span><br><span class="line">               Until_Log_File: </span><br><span class="line">                Until_Log_Pos: 0</span><br><span class="line">           Master_SSL_Allowed: No</span><br><span class="line">           Master_SSL_CA_File: </span><br><span class="line">           Master_SSL_CA_Path: </span><br><span class="line">              Master_SSL_Cert: </span><br><span class="line">            Master_SSL_Cipher: </span><br><span class="line">               Master_SSL_Key: </span><br><span class="line">        Seconds_Behind_Master: 0</span><br><span class="line">Master_SSL_Verify_Server_Cert: No</span><br><span class="line">                Last_IO_Errno: 0</span><br><span class="line">                Last_IO_Error: </span><br><span class="line">               Last_SQL_Errno: 0</span><br><span class="line">               Last_SQL_Error: </span><br><span class="line">  Replicate_Ignore_Server_Ids: </span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: 6291c709-23af-11e9-99fb-000c29071862</span><br><span class="line">             Master_Info_File: mysql.slave_master_info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">                  Master_Bind: </span><br><span class="line">      Last_IO_Error_Timestamp: </span><br><span class="line">     Last_SQL_Error_Timestamp: </span><br><span class="line">               Master_SSL_Crl: </span><br><span class="line">           Master_SSL_Crlpath: </span><br><span class="line">           Retrieved_Gtid_Set: </span><br><span class="line">            Executed_Gtid_Set: </span><br><span class="line">                Auto_Position: 0</span><br><span class="line">         Replicate_Rewrite_DB: </span><br><span class="line">                 Channel_Name: </span><br><span class="line">           Master_TLS_Version: </span><br><span class="line">       Master_public_key_path: </span><br><span class="line">        Get_master_public_key: 0</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 当Slave_IO_Running: Yes和Slave_SQL_Running: Yes都为yes是说明主从复制正常</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#重置 slave 状态 .</span><br><span class="line">$ reset slave;</span><br><span class="line"></span><br><span class="line">#暂停 slave 状态 ;</span><br><span class="line">$ stop slave;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/MySql/" data-id="cjrqbftyf000oakc43molxl27" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Lucene" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/Lucene/" class="article-date">
  <time datetime="2019-02-04T12:16:13.974Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="lucene"><a href="#lucene" class="headerlink" title="lucene"></a>lucene</h1><h2 id="Lucene介绍及核心概念"><a href="#Lucene介绍及核心概念" class="headerlink" title="Lucene介绍及核心概念"></a>Lucene介绍及核心概念</h2><h3 id="什么是Lucene"><a href="#什么是Lucene" class="headerlink" title="什么是Lucene"></a>什么是Lucene</h3><p>Lucene是一套用于全文检索和搜索的开放源代码程序库，由Apache软件基金会支持和提供。Lucene提供了一个简单却强大的应用程序接口，能够做全文索引和搜索，在Java开发环境里Lucene是一个成熟的免费开放源代码工具；就其本身而论，Lucene是现在并且是这几年，最受欢迎的免费Java信息检索程序库。</p>
<h3 id="lucene可以做什么"><a href="#lucene可以做什么" class="headerlink" title="lucene可以做什么"></a>lucene可以做什么</h3><p>Lucene允许你向自己的应用程序中添加搜索功能。Lucene能够把你从文本中解析出来的数据进行索引和搜索。Lucene并不关心你的数据来源，格式，甚至不关心数据的语种。 </p>
<h3 id="Lucene的优点"><a href="#Lucene的优点" class="headerlink" title="Lucene的优点"></a>Lucene的优点</h3><ul>
<li>Lucene作为一个全文检索引擎，其具有如下突出的优点：</li>
</ul>
<p>（1）索引文件格式独立于应用平台。Lucene定义了一套以8位字节为基础的索引文件格式，使得兼容系统或者不同平台的应用能够共享建立的索引文件。</p>
<p>（2）在传统全文检索引擎的倒排索引的基础上，实现了分块索引，能够针对新的文件建立小文件索引，提升索引速度。然后通过与原有索引的合并，达到优化的目的。</p>
<p>（3）优秀的面向对象的系统架构，使得对于Lucene扩展的学习难度降低，方便扩充新功能。</p>
<p>（4）设计了独立于语言和文件格式的文本分析接口，索引器通过接受Token流完成索引文件的创立，用户扩展新的语言和文件格式，只需要实现文本分析的接口。</p>
<p>（5）已经默认实现了一套强大的查询引擎，用户无需自己编写代码即使系统可获得强大的查询能力，Lucene的查询实现中默认实现了布尔操作、模糊查询（Fuzzy Search[11]）、分组查询等等。</p>
<h3 id="Lucene相关名词解释"><a href="#Lucene相关名词解释" class="headerlink" title="Lucene相关名词解释"></a>Lucene相关名词解释</h3><p>1、IndexWriter</p>
<p>lucene中最重要的的类之一，它主要是用来将文档加入索引，同时控制索引过程中的一些参数使用。</p>
<p>2、Analyzer</p>
<p>分析器,主要用于分析搜索引擎遇到的各种文本。常用的有StandardAnalyzer分析器,StopAnalyzer分析器,WhitespaceAnalyzer分析器等。</p>
<p>3、Directory</p>
<p>索引存放的位置;lucene提供了两种索引存放的位置，一种是磁盘，一种是内存。一般情况将索引放在磁盘上；相应地lucene提供了FSDirectory和RAMDirectory两个类。</p>
<p>4、Document</p>
<p>文档;Document相当于一个要进行索引的单元，任何可以想要被索引的文件都必须转化为Document对象才能进行索引。</p>
<p>5、Field</p>
<p>类似于数据库中的一个字段，存储了key-value值。</p>
<p>6、IndexSearcher</p>
<p>是lucene中最基本的检索工具，所有的检索都会用到IndexSearcher工具;</p>
<p>7、Query</p>
<p>Query类似关系型数据库中的SQL语句。与关系型数据库类似，Lucene提供了以下的基本查询：精确查询xxx = ? TermQuery、范围查询  xxx BETWEEN? AND ?  PointRangeQuery、模糊查询    xxx LIKE ‘%?%’  PrefixQuery、RegexpQuery、组合查询 (…) AND (…) OR (…)    BooleanQuery</p>
<p>8、QueryParser</p>
<p>是一个解析用户输入的工具，可以通过扫描用户输入的字符串，生成Query对象。</p>
<p>9、Hits</p>
<p>在搜索完成之后，需要把搜索结果返回并显示给用户，只有这样才算是完成搜索的目的。在Lucene中，搜索的结果的集合是用Hits类的实例来表示的。</p>
<h3 id="什么是正向索引、什么是倒排索引？"><a href="#什么是正向索引、什么是倒排索引？" class="headerlink" title="什么是正向索引、什么是倒排索引？"></a>什么是正向索引、什么是倒排索引？</h3><pre><code>正向索引（forward index），反向索引（inverted index）更熟悉的名字是倒排索引。

在搜索引擎中每个文件都对应一个文件ID，文件内容被表示为一系列关键词的集合（实际上在搜索引擎索引库中，关键词也已经转换为关键词ID）。例如“文档1”经过分词，提取了20个关键词，每个关键词都会记录它在文档中的出现次数和出现位置，得到正向索引的结构如下：

doc1 ---&gt; word1：出现次数，出现位置列表；单词2：出现次数，出现位置列表...

doc2 ---&gt; word1：出现次数，出现位置列表；单词2：出现次数，出现位置列表...

当用户在主页上搜索关键词“苹果手机”时，假设只存在正向索引（forward index），那么就需要扫描索引库中的所有文档，找出所有包含关键词“苹果手机”的文档，再根据打分模型进行打分，排出名次后呈现给用户。因为互联网上收录在搜索引擎中的文档的数目是个天文数字，这样的索引结构根本无法满足实时返回排名结果的要求。

所以，搜索引擎会将正向索引重新构建为倒排索引，即把文件ID对应到关键词的映射转换为关键词到文件ID的映射，每个关键词都对应着一系列的文件，这些文件中都出现这个关键词，得到倒排索引的结构如下：

word1 ---&gt; doc3、doc2、doc7、doc6.....

word2 ---&gt; doc1、doc2、doc5、doc6.....
</code></pre><h2 id="lucene-java客户端"><a href="#lucene-java客户端" class="headerlink" title="lucene java客户端"></a>lucene java客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since: 2018-11-23</span><br><span class="line"> **/</span><br><span class="line">public class Book &#123;</span><br><span class="line"></span><br><span class="line">    private int bookId;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    private float price;</span><br><span class="line"></span><br><span class="line">    private String picture;</span><br><span class="line"></span><br><span class="line">    private String description;</span><br><span class="line"></span><br><span class="line">    public Book() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Book(int bookId, String name, float price, String picture, String description) &#123;</span><br><span class="line">        this.bookId = bookId;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">        this.picture = picture;</span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getBookId() &#123;</span><br><span class="line">        return bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setBookId(int bookId) &#123;</span><br><span class="line">        this.bookId = bookId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public float getPrice() &#123;</span><br><span class="line">        return price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPrice(float price) &#123;</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getPicture() &#123;</span><br><span class="line">        return picture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPicture(String picture) &#123;</span><br><span class="line">        this.picture = picture;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDescription() &#123;</span><br><span class="line">        return description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDescription(String description) &#123;</span><br><span class="line">        this.description = description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line">package com.andy.lucene;</span><br><span class="line"></span><br><span class="line">import org.apache.commons.io.FileUtils;</span><br><span class="line">import org.apache.lucene.analysis.Analyzer;</span><br><span class="line">import org.apache.lucene.analysis.standard.StandardAnalyzer;</span><br><span class="line">import org.apache.lucene.document.*;</span><br><span class="line">import org.apache.lucene.index.DirectoryReader;</span><br><span class="line">import org.apache.lucene.index.IndexReader;</span><br><span class="line">import org.apache.lucene.index.IndexWriter;</span><br><span class="line">import org.apache.lucene.index.IndexWriterConfig;</span><br><span class="line">import org.apache.lucene.queryparser.classic.QueryParser;</span><br><span class="line">import org.apache.lucene.search.IndexSearcher;</span><br><span class="line">import org.apache.lucene.search.Query;</span><br><span class="line">import org.apache.lucene.search.ScoreDoc;</span><br><span class="line">import org.apache.lucene.search.TopDocs;</span><br><span class="line">import org.apache.lucene.store.Directory;</span><br><span class="line">import org.apache.lucene.store.FSDirectory;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.nio.charset.StandardCharsets;</span><br><span class="line">import java.nio.file.FileSystems;</span><br><span class="line">import java.nio.file.Path;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since: 2018-11-23</span><br><span class="line"> **/</span><br><span class="line">public class BookMain &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger = LoggerFactory.getLogger(BookMain.class);</span><br><span class="line"></span><br><span class="line">    private static List&lt;Book&gt; books = new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    private static String docPath = &quot;E:\\tmp\\lucene\\docDir&quot;;</span><br><span class="line">    private static String indexPath = &quot;E:\\tmp\\lucene\\indexDir&quot;;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        books.add(new Book(1, &quot;Java核心编程思想&quot;, 23, &quot;http://www.taobao.com/image.jpg&quot;, &quot;Java是一门面向对象编程语言，不仅吸收了C++语言的各种优点，还摒弃了C++里难以理解的多继承、指针等概念，因此Java语言具有功能强大和简单易用两个特征。Java语言作为静态面向对象编程语言的代表，极好地实现了面向对象理论，允许程序员以优雅的思维方式进行复杂的编程&quot;));</span><br><span class="line">        books.add(new Book(2, &quot;mysql数据库设计&quot;, 47, &quot;http://www.taobao.com/image.jpg&quot;, &quot;MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件。&quot;));</span><br><span class="line">        books.add(new Book(3, &quot;JavaWeb进阶&quot;, 75, &quot;http://www.jd.com/image.jpg&quot;, &quot;Java Web，是用Java技术来解决相关web互联网领域的技术总和。web包括：web服务器和web客户端两部分。Java在客户端的应用有java applet，不过使用得很少，Java在服务器端的应用非常的丰富，比如Servlet，JSP和第三方框架等等。Java技术对Web领域的发展注入了强大的动力。&quot;));</span><br><span class="line">        books.add(new Book(4, &quot;spring入门&quot;, 38, &quot;http://www.tianmao.com/image.jpg&quot;, &quot;Spring是一个开放源代码的设计层面框架，他解决的是业务逻辑层和其他各层的松耦合问题，因此它将面向接口的编程思想贯穿整个系统应用。Spring是于2003 年兴起的一个轻量级的Java 开发框架，由Rod Johnson创建。简单来说，Spring是一个分层的JavaSE/EE full-stack(一站式) 轻量级开源框架&quot;));</span><br><span class="line">        books.add(new Book(5, &quot;springCloud微服务实战&quot;, 42, &quot;http://www.yamaxun.com/image.jpg&quot;, &quot;Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。Spring Cloud并没有重复制造轮子，它只是将目前各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。&quot;));</span><br><span class="line">        books.add(new Book(5, &quot;JavaScript高级&quot;, 71, &quot;http://www.tianmao.com/image.jpg&quot;, &quot;JavaScript 是属于网络的脚本语言 JavaScript 被数百万计的网页用来改进设计、验证表单、检测浏览器、创建cookies，以及更多的应用。&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; doc = new HashMap&lt;&gt;();</span><br><span class="line">        doc.put(&quot;文件名称&quot;, &quot;fileName&quot;);</span><br><span class="line">        doc.put(&quot;文件大小&quot;, &quot;fileSize&quot;);</span><br><span class="line">        doc.put(&quot;文件路径&quot;, &quot;filePath&quot;);</span><br><span class="line">        doc.put(&quot;文件内容&quot;, &quot;fileContent&quot;);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; book = new HashMap&lt;&gt;();</span><br><span class="line">        book.put(&quot;商品ID&quot;, &quot;book_id&quot;);</span><br><span class="line">        book.put(&quot;商品名称&quot;, &quot;name&quot;);</span><br><span class="line">        book.put(&quot;商品价格&quot;, &quot;price&quot;);</span><br><span class="line">        book.put(&quot;商品图片地址&quot;, &quot;picture&quot;);</span><br><span class="line">        book.put(&quot;商品描述&quot;, &quot;description&quot;);</span><br><span class="line"></span><br><span class="line">        long start = System.currentTimeMillis();</span><br><span class="line">//        createIndex();</span><br><span class="line">//        indexSearch(&quot;description:spring&quot;);</span><br><span class="line">        logger.info(&quot;一共花费了:&#123;&#125;毫秒!&quot;, (System.currentTimeMillis() - start));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void createIndex() throws IOException &#123;</span><br><span class="line">        // 将采集到的数据封装到Document对象中</span><br><span class="line">        List&lt;Document&gt; docList = new ArrayList&lt;&gt;();</span><br><span class="line">        Document document;</span><br><span class="line">        for (Book book : books) &#123;</span><br><span class="line">            document = new Document();</span><br><span class="line">            // store:如果是yes，则说明存储到文档域中</span><br><span class="line"></span><br><span class="line">            // 图书ID</span><br><span class="line">            Field bookId = new TextField(&quot;book_id&quot;, Integer.toString(book.getBookId()), Field.Store.YES);</span><br><span class="line">            // 图书名称</span><br><span class="line">            Field name = new TextField(&quot;name&quot;, book.getName(), Field.Store.YES);</span><br><span class="line">            // 图书价格</span><br><span class="line">            Field price = new TextField(&quot;price&quot;, Float.toString(book.getPrice()), Field.Store.YES);</span><br><span class="line">            // 图书图片地址</span><br><span class="line">            Field picture = new TextField(&quot;picture&quot;, book.getPicture(), Field.Store.YES);</span><br><span class="line">            // 图书描述</span><br><span class="line">            Field description = new TextField(&quot;description&quot;, book.getDescription(), Field.Store.YES);</span><br><span class="line">            // 将field域设置到Document对象中</span><br><span class="line">            document.add(bookId);</span><br><span class="line">            document.add(name);</span><br><span class="line">            document.add(price);</span><br><span class="line">            document.add(picture);</span><br><span class="line">            document.add(description);</span><br><span class="line">            docList.add(document);</span><br><span class="line">        &#125;</span><br><span class="line">        // 创建分词器，标准分词器</span><br><span class="line">        Analyzer analyzer = new StandardAnalyzer();</span><br><span class="line">        // 创建IndexWriter</span><br><span class="line">        IndexWriterConfig cfg = new IndexWriterConfig(analyzer);</span><br><span class="line">        // 指定索引库的地址</span><br><span class="line">        Directory directory = FSDirectory.open(FileSystems.getDefault().getPath(indexPath));</span><br><span class="line">        // 创建索引writer</span><br><span class="line">        IndexWriter writer = new IndexWriter(directory, cfg);</span><br><span class="line">        // 清除以前的index</span><br><span class="line">        writer.deleteAll();</span><br><span class="line">        // 通过IndexWriter对象将Document写入到索引库中</span><br><span class="line">        for (Document doc : docList) &#123;</span><br><span class="line">            writer.addDocument(doc);</span><br><span class="line">        &#125;</span><br><span class="line">        // 关闭writer</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param query</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    private static void searchDocument(Query query, Map&lt;String, String&gt; map) throws IOException &#123;</span><br><span class="line">        // 1.创建DirectoryJDK 1.7以后 open只能接收Path</span><br><span class="line">        Directory directory = FSDirectory.open(FileSystems.getDefault().getPath(indexPath));</span><br><span class="line">        IndexReader reader = DirectoryReader.open(directory);</span><br><span class="line">        IndexSearcher searcher = new IndexSearcher(reader);</span><br><span class="line">        // 通过searcher来搜索索引库,第二个参数指定需要显示的顶部记录的N条</span><br><span class="line">        TopDocs topDocs = searcher.search(query, 10);</span><br><span class="line"></span><br><span class="line">        // 根据查询条件匹配出的记录总数</span><br><span class="line">        int count = topDocs.totalHits;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;匹配出的记录总数:[ &quot; + count + &quot; ]\n==========================&quot;);</span><br><span class="line">        // 根据查询条件匹配出的记录</span><br><span class="line">        ScoreDoc[] scoreDocs = topDocs.scoreDocs;</span><br><span class="line">        for (ScoreDoc scoreDoc : scoreDocs) &#123;</span><br><span class="line">            // 获取文档的ID</span><br><span class="line">            int docId = scoreDoc.doc;</span><br><span class="line">            // 通过ID获取文档</span><br><span class="line">            Document doc = searcher.doc(docId);</span><br><span class="line">            for (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">                System.out.println(entry.getKey() + &quot;:&quot; + doc.get(entry.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(&quot;==========================&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        // 关闭资源</span><br><span class="line">        reader.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void indexSearch(String name, Map&lt;String, String&gt; map) throws Exception &#123;</span><br><span class="line">        // 创建query对象</span><br><span class="line">        Analyzer analyzer = new StandardAnalyzer();</span><br><span class="line">        // 使用QueryParser搜索时，需要指定分词器，搜索时的分词器要和索引时的分词器一致,第一个参数：默认搜索的域的名称</span><br><span class="line">        QueryParser parser = new QueryParser(&quot;description&quot;, analyzer);</span><br><span class="line">        // 参数：输入的lucene的查询语句(关键字一定要大写)</span><br><span class="line">        Query query = parser.parse(name);</span><br><span class="line">        searchDocument(query, map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/Lucene/" data-id="cjrqbftye000nakc488nqt7u3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/linux/" class="article-date">
  <time datetime="2019-02-04T12:16:13.955Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h1><h2 id="linux-简介"><a href="#linux-简介" class="headerlink" title="linux 简介"></a>linux 简介</h2><h3 id="什么是linux"><a href="#什么是linux" class="headerlink" title="什么是linux"></a>什么是linux</h3><p>Linux是一种自由和开放源代码的类UNIX操作系统。该操作系统的内核由林纳斯·托瓦兹在1991年10月5日首次发布，在加上用户空间的应用程序之后，成为Linux操作系统。Linux也是自由软件和开放源代码软件发展中最著名的例子。只要遵循GNU通用公共许可证（GPL），任何个人和机构都可以自由地使用Linux的所有底层源代码，也可以自由地修改和再发布。大多数Linux系统还包括像提供GUI的X Window之类的程序。除了一部分专家之外，大多数人都是直接使用Linux发行版，而不是自己选择每一样组件或自行设置。</p>
<p>Linux严格来说是单指操作系统的内核，因操作系统中包含了许多用户图形接口和其他实用工具。如今Linux常用来指基于Linux的完整操作系统，内核则改以Linux内核称之。由于这些支持用户空间的系统工具和库主要由理查德·斯托曼于1983年发起的GNU计划提供，自由软件基金会提议将其组合系统命名为GNU/Linux，但Linux不属于GNU计划，这个名称并没有得到社群的一致认同。</p>
<p>Linux最初是作为支持英特尔x86架构的个人计算机的一个自由操作系统。当前Linux已经被移植到更多的计算机硬件平台，远远超出其他任何操作系统。Linux可以运行在服务器和其他大型平台之上，如大型计算机和超级计算机。世界上500个最快的超级计算机90％以上运行Linux发行版或变种，包括最快的前10名超级计算机运行的都是基于Linux内核的操作系统。Linux也广泛应用在嵌入式系统上，如手机（Mobile Phone）、平板电脑（Tablet）、路由器（Router）、电视（TV）和电子游戏机等。在移动设备上广泛使用的Android操作系统就是创建在Linux内核之上。</p>
<p>通常情况下，Linux被打包成供个人计算机和服务器使用的Linux发行版，一些流行的主流Linux发布版，包括Debian（及其派生版本Ubuntu、Linux Mint）、Fedora（及其相关版本Red Hat Enterprise Linux、CentOS）和openSUSE等。Linux发行版包含Linux内核和支撑内核的实用程序和库，通常还带有大量可以满足各类需求的应用程序。个人计算机使用的Linux发行版通常包含X Window和一个相应的桌面环境，如GNOME或KDE。桌面Linux操作系统常用的应用程序，包括Firefox网页浏览器、LibreOffice办公软件、GIMP图像处理工具等。由于Linux是自由软件，任何人都可以创建一个匹配自己需求的Linux发行版。</p>
<h3 id="发展现状"><a href="#发展现状" class="headerlink" title="发展现状"></a>发展现状</h3><p>1994年3月，Linux1.0版正式发布，Marc Ewing成立Red Hat软件公司，成为最著名的Linux经销商之一。早期Linux的引导管理程序（boot loader）使用LILO（Linux Loader），早期的LILO存在着一些难以容忍的缺陷，例如无法识别1024柱面以后的硬盘空间，后来的GRUB（GRand Unified Bootloader）克服这些缺点，具有‘动态搜索内核文件’的功能，可以让用户在引导的时候，自行编辑引导设置系统文件，透过ext2或ext3文件系统中加载Linux Kernel（GRUB通过不同的文件系统驱动可以识别几乎所有Linux支持的文件系统，因此可以使用很多文件系统来格式化内核文件所在的扇区，并不局限于ext文件系统）。</p>
<p>今天由Linus Torvalds带领下，众多开发共同参与开发和维护Linux内核。理查德·斯托曼领导的自由软件基金会，继续提供大量支持Linux内核的GNU组件。一些个人和企业开发的第三方的非GNU组件也提供对Linux内核的支持，这些第三方组件包括大量的作品，有内核模块和用户应用程序和库等内容。Linux社区或企业都推出一些重要的Linux发行版，包括Linux内核、GNU组件、非GNU组件，以及其他形式的软件包管理系统软件</p>
<h3 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h3><p>Linux内核支持各种硬件架构，为软件（包括可能的专有软件）提供公共平台。<br>基于Linux的系统是一个模块化的类Unix操作系统。Linux操作系统的大部分设计思想来源于20世纪70年代到80年代的Unix操作系统所创建的基本设计思想。Linux系统使用宏内核，由Linux内核负责处理进程控制、网络，以及外围设备和文件系统的访问。在系统运行的时候，设备驱动程序要么与内核直接集成，要么以加载模块形式添加。</p>
<p>Linux具有设备独立性，它内核具有高度适应能力，从而给系统提供了更高级的功能。GNU用户界面组件是大多数Linux操作系统的重要组成部分，提供常用的C函数库，Shell，还有许多常见的Unix实用工具，可以完成许多基本的操作系统任务。大多数Linux系统使用的图形用户界面创建在X窗口系统之上，由X窗口(XWindow)系统通过软件工具及架构协议来创建操作系统所用的图形用户界面。</p>
<p>已安装Linux操作系统包含的一些组件：</p>
<ul>
<li><p>启动程序：例如GRUB或LILO。该程序在计算机开机启动的时候运行，并将Linux内核加载到内存中。</p>
</li>
<li><p>init程序：init是由Linux内核创建的第一个进程，称为根进程，所有的系统进程都是它的子进程，即所有的进程都是通过init启动。init启动的进程如系统服务和登录提示（图形或终端模式的选择）。</p>
</li>
<li><p>软件库包含代码：可以通过运行的进程在Linux系统上使用ELF格式来执行文件，负责管理库使用的动态链接器是“ld-linux.so”。Linux系统上最常用的软件库是GNU C库。<br>用户界面程序：如命令行Shell或窗口环境</p>
</li>
</ul>
<h3 id="Linux发行版"><a href="#Linux发行版" class="headerlink" title="Linux发行版"></a>Linux发行版</h3><p>Ubuntu是一个流行的桌面Linux发行版。<br>Linux发行版指的就是通常所说的“Linux操作系统”，它一般是由一些组织、团体、公司或者个人制作并发行的。Linux内核主要作为Linux发行版的一部分而使用。通常来讲，一个Linux发行版包括Linux内核，以及将整个软件安装到计算机上的一套安装工具，还有各种GNU软件，和其他的一些自由软件，在一些Linux发行版中可能会包含一些专有软件。发行版为许多不同的目的而制作，包括对不同计算机硬件结构的支持，对普通用户或开发者使用方式的调整，针对实时应用或嵌入式系统的开发等等。当前，超过三百个发行版被积极的开发，最普遍被使用的发行版有大约十二个。较为知名的有Debian、Ubuntu、Fedora和openSUSE等。</p>
<p>一个典型的发行版包括：Linux内核，GNU库和各种系统工具，命令行Shell，图形界面底层的X窗口系统和上层的桌面环境等。桌面环境有如KDE或GNOME等，并包含数千种从办公包，编译器，文本编辑器，小游戏，儿童教育软件，到科学工具的应用软件。</p>
<p>很多发行版含有LiveCD的方式，就是不需要安装，放入系统光盘或其它介质进行启动，就能够在不改变现有系统的情况下使用。比较著名的有Damn Small Linux，Knoppix等。LiveCD的相关技术进步至此，很多的发行版本身的安装光盘也有LiveCD的功能。</p>
<h3 id="Linux的应用"><a href="#Linux的应用" class="headerlink" title="Linux的应用"></a>Linux的应用</h3><p>今天各种场合都有使用各种Linux发行版，从嵌入式设备到超级计算机（Super Computer），并且在服务器领域确定了地位，通常服务器使用LAMP组合。在家庭与企业中使用Linux发行版的情况越来越多。并且在政府中也很受欢迎，巴西联邦政府由于支持Linux而世界闻名。有新闻报道俄罗斯军队自己制造的Linux发行版的，做为G.H.ost项目已经获取成果.印度的喀拉拉邦计划在向全联邦的高中推广使用Linux。中华人民共和国为获取技术独立，在龙芯过程中排他性地使用Linux。 在西班牙的一些地区开发了自己的Linux发行版，并且在政府与教育领域广泛使用，如埃斯特雷马杜拉地区的gnuLinEx和安达卢西亚地区的Guadalinex。葡萄牙同样使用自己的Linux发行版Caixa Mágica，用于Magalh?es笔记本电脑和e-escola政府软件。法国和德国同样开始逐步采用Linux。</p>
<p>传统的Linux用户一般都是专业人士。他们愿意安装并设置自己的操作系统，往往比其他操作系统的用户花更多的时间在安装并设置自己的操作系统。这些用户有时被称作“黑客”或是“极客”。</p>
<p>使用Linux主要的成本为移植、培训和学习的费用，早期由于会使用Linux的人较少，并且在软件设计时并未考虑非专业者的使用，导致这方面费用极高。但这方面的费用已经随着Linux的日益普及和Linux上的软件越来越多、越来越方便而降低，但专业仍是使用Linux的主要成本。</p>
<p>然而随着Linux慢慢开始流行，有些原始设备制造商（OEM）开始在其销售的计算机上预装上Linux，Linux的用户中也有了普通计算机用户，Linux系统也开始慢慢出现在个人计算机操作系统市场。Linux在欧洲、美国和日本的流进程度较高，欧美地区还发行Linux平台的游戏和其他家用软件。Linux开源社群方面也是以欧洲、美国、日本等发达国家的人士居多。</p>
<p>每个孩子一台笔记本电脑这一项目正在催生新的更为庞大的Linux用户群，计划将包括发展中国家的几亿学童、他们的家庭和社区。在2007年，已经有六个国家订购了至少每个国家一百万台以上免费发放给学生。Google、Red Hat和eBay是该项目的主要支持者。</p>
<p>基于其低廉成本与高度可设置性，Linux常常被应用于嵌入式系统，例如机顶盒、移动电话及移动设备等。在移动电话上，Linux已经成为IOS的主要竞争者；而在移动设备上，则成为Windows CE与Palm OS外之另一个选择。当前流行的TiVo数字摄影机使用了经过定制后的Linux。此外，有不少硬件式的网络防火墙及路由器，例如部分LinkSys的产品，其内部都是使用Linux来驱动、并采用了操作系统提供的防火墙及路由功能。</p>
<h3 id="Linux的起源"><a href="#Linux的起源" class="headerlink" title="Linux的起源"></a>Linux的起源</h3><p><strong>Unix的历史</strong></p>
<p>Unix系统于1969年在AT&amp;T的贝尔实验室诞生，20世纪70年代，它逐步盛行，这期间，又产生了一个比较重要的分支，就是大约1977年诞生的BSD（Berkeley Software Distribution）系统。从BSD系统开始，各大厂商及商业公司开始了根据自身公司的硬件架构，并以BSD系统为基础进行Unix系统的研发，从而产生了各种版本的Unix系统，如：SUN公司的solaris，IBM公司的AIX，HP公司的HP UNIX等。Unix系统诞生、发展的时间及版本分支，Linux系统诞生于1991年左右，因此，可以说Linux是从Unix发展而来的。</p>
<p><strong>Unix的五大优秀特性</strong></p>
<ul>
<li><p>技术成熟，可靠性高<br>使用Unix系统时，即时运行若干年也无需重启，它依然可以工作得非常好。毫不夸张地说，只要计算机硬件不坏，Unix就很难出问题。</p>
</li>
<li><p>极强的可伸缩性<br>Unix支持的CPU处理器体系架构非常多，包括Intel/AMD及HP-PA、MIPS、PowerPC、UltraSPARC、ALPHA等RISC芯片，以及SMP、MPP等技术。</p>
</li>
<li><p>强大的网络功能<br>Internet互联最重要的协议TCP/IP就是在Unix上开发和发展起来的。此外，Unix还支持非常多的常用网络通信协议，如NFS、DCE、IPX/SPX、SLIP、PPP等。</p>
</li>
<li><p>强大的数据库支持能力<br>Oracle、DB2、Sybase、Informix等大型数据库，都把Unix作为其主要的数据库开发和运行平台，一直到目前为止，依然如此。</p>
</li>
<li><p>强大的开发功能<br>正是Unix促使了C语言的诞生，并相互促进与发展，成为当时工程师的首选操作系统和开发环境。互联网早期有重大意义的软件新技术的出现几乎都在Unix上，例如：TCP/IP、WWW、JAVA、XML等。</p>
</li>
</ul>
<p><strong>Unix操作系统革命</strong></p>
<p>70年代中后期，由于各厂商和商业公司开发的Unix及内置软件都是针对自己公司特定的硬件，因此在其他公司的硬件上基本无法直接运行，而且当时没有人对开发基于x86架构的CPU的系统感兴趣。另外，70年代末，Unix又面临了突如其来的被AT&amp;T回收版权的重大问题，特别是要求禁止对学生群体提供Unix系统源代码，这样的问题一度引起了当时Unix业界的恐慌，也因此产生了商业纠纷。</p>
<p>由于Unix面临版权回收问题，以及代码不开源等的问题，这直接或间接的导致了新的类Unix系统的诞生以及自由软件运动的建立和发展。</p>
<p>1984年，Richard Stallman发起了开发自由软件的运动，并成立了自由软件基金会（Free Software Foundation，FSF）和GNU项目。当时发起这个自由软件运动和创建GNU项目的目的其实很简单，就是想开发一个类似Unix系统、并且是自由软件的完整操作系统，也就是要解决70年代末Unix版权问题以及软件源代码面临闭源的问题，这个系统叫做GNU操作系统。</p>
<p>也是在80年代初期，同样是由于之前的Unix系统版权和源代码限制等问题，使得当时大学里教学Unix系统的束缚很大。因此，当时的一个大学的教授，名字为Andrw Tanenbaum（谭邦宁），于大概1984年开始着手编写新的用于教学的Unix系统，目标是开发新的Unix系统尽可能和原来的Unix系统兼容，并且可以运行与x86 PC平台，这个系统的名字为Minix。</p>
<p><strong>Linux的诞生</strong></p>
<p>Linux系统的诞生开始于芬兰赫尔辛基大学的一位计算机系的学生，名字为Linus Torvalds。在大学期间，他接触到了学校的Unix系统，但是当时的Unix系统仅为一台主机，且对应了多个终端，使用时存在操作等待时间很长等一些不爽的问题，无法满足年轻的Linus Torvalds的使用需求。因此他就萌生了自己开发一个Unix的想法，于是不久，他就找到了前文提到的谭邦宁教授开发的用于教学的Minix操作系统，他把Minix安装到了他的I386个人计算机上。此后，Torvalds又开始陆续阅读了Minix系统的源代码，从Minix系统中学到了很多重要的系统核心程序设计理念和设计思想，从而逐步开始了Linux系统雏形的设计和开发。</p>
<p>linux的发展历程简介</p>
<p>1、1984年，Andrew S.Tanenbaum开发了用于教学的Unix系统，命名为MINIX。</p>
<p>2、1989年，Andrew S.Tanenbaum将MINIX系统运行与x86的PC计算机平台。</p>
<p>3、1990年，芬兰赫尔辛基大学学生Linus Torvalds首次接触MINIX系统。</p>
<p>4、1991年，Linus Torvalds开始在MINIX上编写各种驱动程序等操作系统内核组件。</p>
<p>5、1991年底，Linus Torvalds公开了Linux内核源代码00.2版（<a href="http://www.kernel.org）。" target="_blank" rel="noopener">http://www.kernel.org）。</a></p>
<p>6、1993年，Linux1.0版发行，Linux转向GPL版权协议。</p>
<p>7、1994年，Linux的第一个商业发行版Slackware问世。</p>
<p>8、1996年，美国国家标准技术局的计算机系统实验室确认Linux版本1.2.13（由Open Linux公司打包）符合POSIX标准。</p>
<p>9、1999年，Linux的简体中文发行版问世。</p>
<p>10、2000年后，Linux系统日趋成熟，涌现大量基于Linux服务器平台的应用，并广泛应用于基于ARM技术的嵌入式系统中。</p>
<p>注意：Linux Torvalds公开的Linux内核源码并不是我们现在使用的Linux系统的全部，而仅仅是Linux内核kernel部分的代码。</p>
<h2 id="Linux核心概念"><a href="#Linux核心概念" class="headerlink" title="Linux核心概念"></a>Linux核心概念</h2><h3 id="自由软件与FSF"><a href="#自由软件与FSF" class="headerlink" title="自由软件与FSF"></a>自由软件与FSF</h3><p><strong>自由软件</strong></p>
<p>简单地理解，自由软件的核心就是没有商业化软件版权制约，源代码开放，可无约束自由传播。</p>
<p><strong>自由软件基金会FSF</strong></p>
<p>FSF（Free Software Foundation）的中文意思是自由软件基金会，是Richard Stallman与1984年发起和创办的。FSF的主要项目是GNU项目。它的目标是建立自由发布和可移植的类Unix操作系统产品。GNU项目本身产生的主要软件包括：Emacs编辑软件、gcc编译软件、bash命令解释程序和编程语言，以及gawk（GNU’s awk）等。</p>
<p><strong>GNU介绍</strong></p>
<p>GNU的全称为GNU’s not unix，意思是”GNU不是UNIX”，GNU计划，又称革奴计划，是由Richard Stallman在1984年公开发起的，是FSF的主要项目。这个项目的目标是建立一套完全自由的和可移植的类Unix操作系统。</p>
<p>GNU类Unix操作系统是由一系列应用程序、系统库和开发工具构成的软件集合，例如：Emacs编辑软件、gcc编译软件、bash命令解释程序和编程语言，以及gawk（GNU’s awk）等，并加上了用于资源分配和硬件管理的内核。</p>
<p>但是GNU自己的内核Hurd仍在开发中，离实用还有一定的距离。因此，这个GNU系统并没有流行起来。现在的GNU系统通常是使用Linux系统的内核、加上GNU项目贡献的一些组件，以及其他相关程序组成的，这样的组合被称为GNU/Linux操作系统。</p>
<p>到1991年Linux内核发布的时候，GNU项目已经完成了除系统内核之外的各种必备软件的开发。在Linux Torvalds和其他开发人员的努力下，GNU项目的部分组件又运行到了Linux内核之上，例如：GNU项目里的Emacs、gcc、bash、gawk等，至今都是Linux系统中很重要的基础软件。</p>
<p><strong>GPL介绍</strong></p>
<p>GPL全称为General Public License，中文名为通用公共许可，是一个最著名的开源许可协议，开源社区最著名的Linux内核就是在GPL许可下发布的。GPL许可是由自由软件基金会（Free Software foundation）创建的。</p>
<p>1984年，Richard Stallman发起开发自由软件的运动后不久，在其他人的协作下，他创立了通用公共许可证（GPL），这对推动自由软件的发展起来至关重要的作用，那么，这个GPL到底是什么意思呢？</p>
<p>简单的理解，GPL许可的核心，是保证任何人有共享和修改自由软件的自由，任何人有权取得、修改和重新发布自由软件的源代码权利，但都必须同时给出具体更改的源代码。</p>
<p>虽然这个Linux内核是基于GNU通用公共许可的，但是Linux内核并不是GNU计划的一部分。</p>
<p><strong>Linux系统组成</strong></p>
<p>Linux操作系统的核心为Linus Torvalds开发的Kernel，Linux内核之上的组件分为几部分：一部分是GNU的组件，如Emacs、gcc、bash、gawk等；另一些重要组成部分则来自加利福利亚大学Berkeley分校的BSD Unix项目和麻省理工学院的X Windows系统项目，以后在这之后成千上万的程序员开发的应用程序等（见表1-1）。正式Linux内核与GNU项目、BSD Unix以及MIT的X11（X Windows）的结合，才使得整个Linux操作系统得以很快形成，并得到了发展，进而组成了今天优秀的Linux系统。</p>
<p>表Linux系统各组成部分的贡献人员</p>
<table>
<thead>
<tr>
<th>Linux内核</th>
<th>GNU组件（gcc、bash</th>
<th>其他应用程</th>
</tr>
</thead>
<tbody>
<tr>
<td>开发者Linux Torvalds</td>
<td>项目发起人Richard Stallman</td>
<td>BSD Unix和X Windows以及成千上万的程序员</td>
</tr>
</tbody>
</table>
<h2 id="Linux的特点"><a href="#Linux的特点" class="headerlink" title="Linux的特点"></a>Linux的特点</h2><p><strong>Linux为什么受欢迎？</strong></p>
<p>Linux系统之所以受到广大计算机爱好者的喜爱，主要原因有两个：</p>
<p>一、Linux属于自由软件，用于不用支付任何费用就可以获得系统和系统的源代码，并且可以根据自己的需要对源代码进行必要的修改，无偿使用，无约束地自由传播。</p>
<p>二、Linux具有Unix的全部优秀特性，任何使用Unix操作系统或想要学习Unix操作系统的人，都可以通过学习Linux来了解Unix，同样可以获得Unix中的几乎所有优秀功能，并且，Linux系统更开放，社区开发和全世界的使用者也更活跃。</p>
<p><strong>Linux更多特点介绍</strong></p>
<ul>
<li><p>可以说Linux是Unix在PC计算机上的克隆版，仿Unix内核构建，同Unix指令集向下几乎完全兼容。</p>
</li>
<li><p>是一个完善的多用户、多任务，支持多进程、多CPU的系统。</p>
</li>
<li><p>具有很高的系统稳定性与可靠性。</p>
</li>
<li><p>具有很高的系统安全性。</p>
</li>
<li><p>有完善的网络服务，支持HTTP、FTP、SMTP、POP、SAMBA、SNMP、DNS、DHCP、SSH、TELNET等。</p>
</li>
<li><p>是基于GNU许可，自由开放的系统。</p>
</li>
<li><p>有大量第三方免费应用程序。</p>
</li>
<li><p>得到了众多业界厂商支持，如IBM、ORACLE、INTEL、HP、MOTO、Google等。</p>
</li>
<li><p>有完善的大型数据库平台，包括Oracle、DB2、Sybase、MySQL、Postgres等。</p>
</li>
<li><p>有完善的图形用户界面，包括GNOME、KDE等。</p>
</li>
<li><p>有完善的开发平台，包括C/C++、Java、Perl等，支持各类图形界面API，如GTK+、QT等。</p>
</li>
</ul>
<h3 id="3-Linux几大模块"><a href="#3-Linux几大模块" class="headerlink" title="3.Linux几大模块"></a>3.Linux几大模块</h3><pre><code>* 文件管理

* 用户管理

* 磁盘与挂载

* 软件相关

* 压缩编译

* 网络管理
$ ntpdate -u ntp.api.bz 同步时间（后面的IP是中国时间服务器）

* 进程管理

* 服务相关

* 启动过程

* shell
</code></pre><h2 id="linux常用软件详解"><a href="#linux常用软件详解" class="headerlink" title="linux常用软件详解"></a>linux常用软件详解</h2><h3 id="vim-详解"><a href="#vim-详解" class="headerlink" title="vim 详解"></a>vim 详解</h3><p>vi编辑器是所有Unix及Linux系统下标准的编辑器，它的强大不逊色于任何最新的文本编辑器，这里只是简单地介绍一下它的用法和一小部分指令。由于对Unix及Linux系统的任何版本，vi编辑器是完全相同的，因此您可以在其他任何介绍vi的地方进一步了解它。Vi也是Linux中最基本的文本编辑器，学会它后，您将在Linux的世界里畅行无阻。 </p>
<p><strong>vi的基本概念</strong></p>
<p>基本上vi可以分为三种状态，分别是命令模式（command mode）、插入模式（Insert mode）和底行模式（last line mode）</p>
<ul>
<li>命令行模式 command mode</li>
</ul>
<p>控制屏幕光标的移动，字符、字或行的删除，移动复制某区段及进入Insert mode下，或者到 底行模式 last line mode。 </p>
<ul>
<li>插入模式（Insert mode） </li>
</ul>
<p>只有在Insert mode下，才可以做文字输入，按「ESC」键可回到命令行模式。</p>
<ul>
<li>底行模式（last line mode） </li>
</ul>
<p>将文件保存或退出vi，也可以设置编辑环境，如寻找字符串、列出行号……等。<br>不过一般我们在使用时把vi简化成两个模式，就是将底行模式（last line mode）也算入命令行模式command mode）。 </p>
<p><strong>vi的基本操作</strong></p>
<h3 id="linux终端快捷命令"><a href="#linux终端快捷命令" class="headerlink" title="linux终端快捷命令"></a>linux终端快捷命令</h3><table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Tab</td>
<td style="text-align:left">自动补全</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+a</td>
<td style="text-align:left">光标移动到开始位置</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+e</td>
<td style="text-align:left">光标移动到最末尾</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+k</td>
<td style="text-align:left">删除此处至末尾的所有内容//剪切命令行中光标所在处之后的所有字符（包括自身)</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+u</td>
<td style="text-align:left">删除此处至开始的所有内容//剪切命令行中光标所在处之前的所有字符（不包括自身）</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+d</td>
<td style="text-align:left">删除当前字符</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+h</td>
<td style="text-align:left">删除当前字符前一个字符</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+w</td>
<td style="text-align:left">删除此处到左边的单词 //剪切光标所在处之前的一个词（以空格、标点等为分隔符)</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+y</td>
<td style="text-align:left">粘贴由 Ctrl+u ， Ctrl+d ， Ctrl+w 删除的单词</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+l</td>
<td style="text-align:left">相当于clear，即清屏</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+r</td>
<td style="text-align:left">查找历史命令</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+b</td>
<td style="text-align:left">向回移动光标</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+f</td>
<td style="text-align:left">向前移动光标</td>
</tr>
<tr>
<td style="text-align:left">Esc+b</td>
<td style="text-align:left">移动到当前单词的开头</td>
</tr>
<tr>
<td style="text-align:left">Esc+f</td>
<td style="text-align:left">移动到当前单词的结尾</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+t</td>
<td style="text-align:left">将光标位置的字符和前一个字符进行位置交换</td>
</tr>
<tr>
<td style="text-align:left">Alt+t</td>
<td style="text-align:left">交换当前与以前单词的位置</td>
</tr>
<tr>
<td style="text-align:left">Alt+u</td>
<td style="text-align:left">把当前词转化为大写(光标在词首)</td>
</tr>
<tr>
<td style="text-align:left">Alt+l</td>
<td style="text-align:left">把当前词转化为小写(光标在词首)</td>
</tr>
<tr>
<td style="text-align:left">Alt+c</td>
<td style="text-align:left">把当前词汇变成首字符大写</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+&amp;</td>
<td style="text-align:left">恢复 ctrl+h 或者 ctrl+d 或者 ctrl+w 删除的内容</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+S</td>
<td style="text-align:left">暂停屏幕输出</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+Q</td>
<td style="text-align:left">继续屏幕输出</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+Left-Arrow</td>
<td style="text-align:left">光标移动到上一个单词的词首</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+Right-Arrow</td>
<td style="text-align:left">光标移动到下一个单词的词尾</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+p</td>
<td style="text-align:left">向上显示缓存命令</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+n</td>
<td style="text-align:left">向下显示缓存命令</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+d</td>
<td style="text-align:left">关闭终端</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+xx</td>
<td style="text-align:left">在EOL和当前光标位置移动</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+x@</td>
<td style="text-align:left">显示可能hostname补全</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+c</td>
<td style="text-align:left">终止进程/命令</td>
</tr>
<tr>
<td style="text-align:left">Shift +上或下</td>
<td style="text-align:left">终端上下滚动</td>
</tr>
<tr>
<td style="text-align:left">Shift+PgUp/PgDn</td>
<td style="text-align:left">终端上下翻页滚动</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+Shift+n</td>
<td style="text-align:left">新终端</td>
</tr>
<tr>
<td style="text-align:left">alt+F2</td>
<td style="text-align:left">输入gnome-terminal打开终端</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+T</td>
<td style="text-align:left">打开新的标签页</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+W</td>
<td style="text-align:left">关闭标签页</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+C</td>
<td style="text-align:left">复制</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+V</td>
<td style="text-align:left">粘贴</td>
</tr>
<tr>
<td style="text-align:left">Alt+数字</td>
<td style="text-align:left">切换至对应的标签页</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+N</td>
<td style="text-align:left">打开新的终端窗口</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+Q</td>
<td style="text-align:left">管壁终端窗口</td>
</tr>
<tr>
<td style="text-align:left">Shift+Ctrl+PgUp/PgDn</td>
<td style="text-align:left">左移右移标签页</td>
</tr>
<tr>
<td style="text-align:left">Ctrl+PgUp/PgDn</td>
<td style="text-align:left">切换标签页</td>
</tr>
<tr>
<td style="text-align:left">F1</td>
<td style="text-align:left">打开帮助指南</td>
</tr>
<tr>
<td style="text-align:left">F10</td>
<td style="text-align:left">激活菜单栏</td>
</tr>
<tr>
<td style="text-align:left">F11</td>
<td style="text-align:left">全屏切换</td>
</tr>
<tr>
<td style="text-align:left">Alt+F</td>
<td style="text-align:left">打开 “文件” 菜单（file）</td>
</tr>
<tr>
<td style="text-align:left">Alt+E</td>
<td style="text-align:left">打开 “编辑” 菜单（edit）</td>
</tr>
<tr>
<td style="text-align:left">Alt+V</td>
<td style="text-align:left">打开 “查看” 菜单（view）</td>
</tr>
<tr>
<td style="text-align:left">Alt+S</td>
<td style="text-align:left">打开 “搜索” 菜单（search）</td>
</tr>
<tr>
<td style="text-align:left">Alt+T</td>
<td style="text-align:left">打开 “终端” 菜单（terminal）</td>
</tr>
<tr>
<td style="text-align:left">Alt+H</td>
<td style="text-align:left">打开 “帮助” 菜单（help）</td>
</tr>
</tbody>
</table>
<p>另外一些小技巧包括：在终端窗口命令提示符下，连续按两次 Tab 键、或者连续按三次 Esc 键、或者按 Ctrl+i 组合键，<br>将显示所有的命令及工具名称。Application 键即位置在键盘上右 Ctrl 键左边的那个键，作用相当于单击鼠标右键。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/linux/" data-id="cjrqbftzf0019akc4d4n06vi0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Kafka" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/Kafka/" class="article-date">
  <time datetime="2019-02-04T12:16:13.944Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="kafka"><a href="#kafka" class="headerlink" title="kafka"></a>kafka</h1><h2 id="kafka-核心概念"><a href="#kafka-核心概念" class="headerlink" title="kafka 核心概念"></a>kafka 核心概念</h2><h3 id="什么是kafka"><a href="#什么是kafka" class="headerlink" title="什么是kafka"></a>什么是kafka</h3><p>Kafka是由Apache软件基金会开发的一个开源流处理平台，由Scala和Java编写。该项目的目标是为处理实时数据提供一个统一、高吞吐、低延迟的平台。其持久化层本质上是一个“按照分布式事务日志架构的大规模发布/订阅消息队列”，这使它作为企业级基础设施来处理流式数据非常有价值。此外，Kafka可以通过Kafka Connect连接到外部系统（用于数据输入/输出），并提供了Kafka Streams——一个Java流式处理库。该设计受事务日志的影响较大。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>Kafka是一个分布式数据流平台，可以运行在单台服务器上，也可以在多台服务器上部署形成集群。它提供了发布和订阅功能，使用者可以发送数据到Kafka中，也可以从Kafka中读取数据（以便进行后续的处理）。Kafka具有高吞吐、低延迟、高容错等特点。下面介绍一下Kafka中常用的基本概念：</p>
<ul>
<li><p>Broker<br>消息队列中常用的概念，在Kafka中指部署了Kafka实例的服务器节点。</p>
</li>
<li><p>Topic<br>用来区分不同类型信息的主题。比如应用程序A订阅了主题t1，应用程序B订阅了主题t2而没有订阅t1，那么发送到主题t1中的数据将只能被应用程序A读到，而不会被应用程序B读到。</p>
</li>
<li><p>Partition<br>每个topic可以有一个或多个partition（分区）。分区是在物理层面上的，不同的分区对应着不同的数据文件。Kafka使用分区支持物理上的并发写入和读取，从而大大提高了吞吐量。</p>
</li>
<li><p>Record<br>实际写入Kafka中并可以被读取的消息记录。每个record包含了key、value和timestamp。</p>
</li>
<li><p>Producer<br>生产者，用来向Kafka中发送数据（record）。</p>
</li>
<li><p>Consumer<br>消费者，用来读取Kafka中的数据（record）。</p>
</li>
<li><p>Consumer Group<br>一个消费者组可以包含一个或多个消费者。使用多分区+多消费者方式可以极大提高数据下游的处理速度。</p>
</li>
</ul>
<h3 id="kafka-核心名词解释"><a href="#kafka-核心名词解释" class="headerlink" title="kafka 核心名词解释"></a>kafka 核心名词解释</h3><ul>
<li>Topic(主题): 每一条发送到kafka集群的消息都可以有一个类别，这个类别叫做topic,不同的消息会进行分开存储，如果topic很大，可以分布到多个broker上，也可以这样理解：topic被认为是一个队列，每一条消息都必须指定它的topic，可以说我们需要明确把消息放入哪一个队列。对于传统的message queue而言，一般会删除已经被消费的消息，而Kafka集群会保留所有的消息，无论其被消费与否。当然，因为磁盘限制，不可能永久保留所有数据（实际上也没必要），因此Kafka提供两种策略删除旧数据。一是基于时间，二是基于Partition文件大小。</li>
</ul>
<ul>
<li><p>Broker(代理): 一台kafka服务器就可以称之为broker.一个集群由多个broker组成，一个broker可以有多个topic</p>
</li>
<li><p>Partition(分区): 为了使得kafka吞吐量线性提高，物理上把topic分成一个或者多个分区，每一个分区是一个有序的队列。且每一个分区在物理上都对应着一个文件夹，该文件夹下存储这个分区所有消息和索引文件。<br>分区的表示: topic名字-分区的id每个日志文件都是一个Log Entry序列，每个Log Entry包含一个4字节整型数值（值为M+5），1个字节的”magic value”，4个字节的CRC校验码，然后跟M个字节的消息这个log entries并非由一个文件构成，而是分成多个segment，每个segment以该segment第一条消息的offset命名并以“.kafka”为后缀。另外会有一个索引文件，它标明了每个segment下包含的log entry的offset范围分区中每条消息都有一个当前Partition下唯一的64字节的offset，它指明了这条消息的起始位置，Kafka只保证一个分区的数据顺序发送给消费者，而不保证整个topic里多个分区之间的顺序</p>
</li>
<li><p>Replicas（副本）: 试想：一旦某一个Broker宕机，则其上所有的Partition数据都不可被消费，所以需要对分区备份。其中一个宕机后其它Replica必须要能继续服务并且即不能造成数据重复也不能造成数据丢失。<br>如果没有一个Leader，所有Replica都可同时读/写数据，那就需要保证多个Replica之间互相（N×N条通路）同步数据，数据的一致性和有序性非常难保证，大大增加了Replication实现的复杂性，同时也增加了出现异常的几率。而引入Leader后，只有Leader负责数据读写，Follower只向Leader顺序Fetch数据（N条通路），系统更加简单且高效。<br>每一个分区，根据复制因子N，会有N个副本，比如在broker1上有一个topic，分区为topic-1, 复制因子为2，那么在两个broker的数据目录里，就都有一个topic-1,其中一个是leader，一个replicas同一个Partition可能会有多个Replica，而这时需要在这些Replication之间选出一个Leader，Producer和Consumer只与这个Leader交互，其它Replica作为Follower从Leader中复制数据</p>
</li>
<li><p>Producer: Producer将消息发布到指定的topic中，同时，producer还需要指定该消息属于哪个partition</p>
</li>
<li><p>Consumer: 本质上kafka只支持topic，每一个consumer属于一个consumer group，每个consumer group可以包含多个consumer。发送到topic的消息只会被订阅该topic的每个group中的一个consumer消费。如果所有的consumer都具有相同的group，这种情况和queue很相似，消息将会在consumer之间均衡分配；如果所有的consumer都在不同的group中，这种情况就是广播模式，消息会被发送到所有订阅该topic的group中，那么所有的consumer都会消费到该消息。kafka的设计原理决定，对于同一个topic，同一个group中consumer的数量不能多于partition的数量，否则就会有consumer无法获取到消息。</p>
</li>
<li><p>Offset: Offset专指Partition以及User Group而言，记录某个user group在某个partiton中当前已经消费到达的位置。</p>
</li>
</ul>
<h3 id="kafka使用场景"><a href="#kafka使用场景" class="headerlink" title="kafka使用场景"></a>kafka使用场景</h3><p>目前主流使用场景基本如下：</p>
<ul>
<li><p>消息队列（MQ）<br>在系统架构设计中，经常会使用消息队列（Message Queue）——MQ。MQ是一种跨进程的通信机制，用于上下游的消息传递，使用MQ可以使上下游解耦，消息发送上游只需要依赖MQ，逻辑上和物理上都不需要依赖其他下游服务。MQ的常见使用场景如流量削峰、数据驱动的任务依赖等等。在MQ领域，除了Kafka外还有传统的消息队列如ActiveMQ和RabbitMQ等。</p>
</li>
<li><p>追踪网站活动<br>Kafka最出就是被设计用来进行网站活动（比如PV、UV、搜索记录等）的追踪。可以将不同的活动放入不同的主题，供后续的实时计算、实时监控等程序使用，也可以将数据导入到数据仓库中进行后续的离线处理和生成报表等。</p>
</li>
<li><p>Metrics<br>Kafka经常被用来传输监控数据。主要用来聚合分布式应用程序的统计数据，将数据集中后进行统一的分析和展示等。</p>
</li>
<li><p>日志聚合<br>很多人使用Kafka作为日志聚合的解决方案。日志聚合通常指将不同服务器上的日志收集起来并放入一个日志中心，比如一台文件服务器或者HDFS中的一个目录，供后续进行分析处理。相比于Flume和Scribe等日志聚合工具，Kafka具有更出色的性能。</p>
</li>
</ul>
<h2 id="kafka-集群搭建"><a href="#kafka-集群搭建" class="headerlink" title="kafka 集群搭建"></a>kafka 集群搭建</h2><h3 id="安装kefka集群"><a href="#安装kefka集群" class="headerlink" title="安装kefka集群"></a>安装kefka集群</h3><p>由于kafka依赖zookeeper环境所以先安装zookeeper，<a href="https://blog.csdn.net/fooelliot/article/details/85196423" target="_blank" rel="noopener">zk安装</a></p>
<p>安装环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ContSO-7.5_x64</span><br><span class="line">jdk1.8.0_191</span><br><span class="line">zookeeper3.4.10</span><br><span class="line">kafka_2.11-2.0.1</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 下载</span><br><span class="line">wget http://mirrors.hust.edu.cn/apache/kafka/2.1.0/kafka_2.11-2.1.0.tgz</span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">tar -zxvf kafka_2.11-2.1.0.tgz -C /xxx/xxx</span><br><span class="line"></span><br><span class="line"># 编辑配置文件修改一下几个配置</span><br><span class="line">vim $KAFKA_HOME/config/server.properties</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 每台服务器的broker.id都不能相同只能是数字</span><br><span class="line">broker.id=1</span><br><span class="line"></span><br><span class="line"># 修改为你的服务器的ip或主机名</span><br><span class="line">advertised.listeners=PLAINTEXT://node-1:9092</span><br><span class="line"></span><br><span class="line">#设置zookeeper的连接端口,将下面的ip修改为你的IP称或主机名</span><br><span class="line">zookeeper.connect=node-1:2181,node-2:2181,node-3:2181</span><br></pre></td></tr></table></figure>
<h3 id="启动Kafka集群并测试"><a href="#启动Kafka集群并测试" class="headerlink" title="启动Kafka集群并测试"></a>启动Kafka集群并测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cd $KAFKA_HOME</span><br><span class="line"></span><br><span class="line"># 分别在每个节点启动kafka服务</span><br><span class="line">bin/kafka-server-start.sh config/server.properties</span><br><span class="line"></span><br><span class="line"># 创建Topic</span><br><span class="line">bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 2 --partitions 1 --topic order</span><br><span class="line"></span><br><span class="line">#解释</span><br><span class="line">--replication-factor 2  #复制两份</span><br><span class="line">--partitions 1          #创建1个分区</span><br><span class="line">--topic                 #主题为 order</span><br><span class="line"></span><br><span class="line"># 查看topic</span><br><span class="line">bin/kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class="line"></span><br><span class="line"># 查看topic状态</span><br><span class="line">bin/kafka-topics.sh --describe --zookeeper localhost:2181 --topic order</span><br><span class="line"></span><br><span class="line"># 在一台服务器上创建一个 producer (生产者)</span><br><span class="line">bin/kafka-console-producer.sh --broker-list node-1:9092,node-2:9092,node-3:9092 --topic order</span><br><span class="line"></span><br><span class="line"># 在一台服务器上创建一个 consumer (消费者)</span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server node-2:9092,node-3:9092,node-4:9092 --topic order --from-beginning</span><br><span class="line"></span><br><span class="line"># 现在可以在生产者的控制台输入任意字符就可以看到消费者端有消费消息。</span><br></pre></td></tr></table></figure>
<h2 id="java-客户端连接kafka"><a href="#java-客户端连接kafka" class="headerlink" title="java 客户端连接kafka"></a>java 客户端连接kafka</h2><h3 id="普通java形式"><a href="#普通java形式" class="headerlink" title="普通java形式"></a>普通java形式</h3><p>pom:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;kafka_2.11&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.1.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.25&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.7.25&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br></pre></td></tr></table></figure></p>
<p>Consumer:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.kafka.clients.consumer.ConsumerRebalanceListener;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecords;</span><br><span class="line">import org.apache.kafka.clients.consumer.KafkaConsumer;</span><br><span class="line">import org.apache.kafka.clients.producer.Producer;</span><br><span class="line">import org.apache.kafka.common.TopicPartition;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.util.Collection;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">public class JavaKafkaConsumer &#123;</span><br><span class="line"></span><br><span class="line">    private static Logger logger = LoggerFactory.getLogger(JavaKafkaConsumer.class);</span><br><span class="line"></span><br><span class="line">    private static Producer&lt;String, String&gt; producer;</span><br><span class="line"></span><br><span class="line">    private final static String TOPIC = &quot;TEST-TOPIC&quot;;</span><br><span class="line"></span><br><span class="line">    private static Properties properties;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        properties = new Properties();</span><br><span class="line">        //此处配置的是kafka的端口</span><br><span class="line">        properties.put(&quot;bootstrap.servers&quot;, &quot;node-2:9092,node-3:9092,node-3:9094&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        properties.put(&quot;group.id&quot;, &quot;test&quot;);</span><br><span class="line">        properties.put(&quot;enable.auto.commit&quot;, &quot;true&quot;);</span><br><span class="line">        properties.put(&quot;auto.commit.interval.ms&quot;, &quot;1000&quot;);</span><br><span class="line">        properties.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);</span><br><span class="line">        properties.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);</span><br><span class="line"></span><br><span class="line">        final KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(properties);</span><br><span class="line">        consumer.subscribe(Collections.singletonList(TOPIC), new ConsumerRebalanceListener() &#123;</span><br><span class="line"></span><br><span class="line">            public void onPartitionsRevoked(Collection&lt;TopicPartition&gt; collection) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            public void onPartitionsAssigned(Collection&lt;TopicPartition&gt; collection) &#123;</span><br><span class="line">                //将偏移设置到最开始</span><br><span class="line">                consumer.seekToBeginning(collection);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);</span><br><span class="line">            for (ConsumerRecord&lt;String, String&gt; record : records) &#123;</span><br><span class="line">                logger.info(&quot;offset = &#123;&#125;, key = &#123;&#125;, value = &#123;&#125;&quot;, record.offset(), record.key(), record.value());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Producer:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line">import org.apache.kafka.clients.producer.Producer;</span><br><span class="line">import org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line">import java.util.Properties;</span><br><span class="line">import java.util.UUID;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-12-26</span><br><span class="line"> **/</span><br><span class="line">public class JavaKafkaProducer &#123;</span><br><span class="line"></span><br><span class="line">    private static Logger logger = LoggerFactory.getLogger(JavaKafkaProducer.class);</span><br><span class="line"></span><br><span class="line">    private static Producer&lt;String, String&gt; producer;</span><br><span class="line"></span><br><span class="line">    private final static String TOPIC = &quot;TEST-TOPIC&quot;;</span><br><span class="line"></span><br><span class="line">    private static Properties properties;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        properties = new Properties();</span><br><span class="line">        //此处配置的是kafka的端口</span><br><span class="line">        properties.put(&quot;bootstrap.servers&quot;, &quot;node-2:9092,node-3:9092,node-3:9094&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        properties.put(&quot;acks&quot;, &quot;all&quot;);</span><br><span class="line">        properties.put(&quot;retries&quot;, 0);</span><br><span class="line">        properties.put(&quot;batch.size&quot;, 16384);</span><br><span class="line">        properties.put(&quot;linger.ms&quot;, 1);</span><br><span class="line">        properties.put(&quot;buffer.memory&quot;, 33554432);</span><br><span class="line">        properties.put(&quot;key.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</span><br><span class="line">        properties.put(&quot;value.serializer&quot;, &quot;org.apache.kafka.common.serialization.StringSerializer&quot;);</span><br><span class="line">        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties);</span><br><span class="line">        for (int i = 0; i &lt; 100; i++) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                Thread.sleep(1000);</span><br><span class="line">            &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            String uuid = UUID.randomUUID().toString();</span><br><span class="line">            producer.send(new ProducerRecord&lt;&gt;(TOPIC, Integer.toString(i), uuid));</span><br><span class="line">            logger.info(&quot;send message success key:&#123;&#125;, value:&#123;&#125;&quot;, i, uuid);</span><br><span class="line">        &#125;</span><br><span class="line">        producer.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>log4j.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Global logging configuration 开发时候建议使用 debug</span><br><span class="line">log4j.rootLogger=info, stdout</span><br><span class="line"># Console output...</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br></pre></td></tr></table></figure></p>
<h3 id="基于spirngboot整合kafka"><a href="#基于spirngboot整合kafka" class="headerlink" title="基于spirngboot整合kafka"></a>基于spirngboot整合kafka</h3><p>pom:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;spring-boot-kafka&lt;/artifactId&gt;</span><br><span class="line">    &lt;groupId&gt;com.andy&lt;/groupId&gt;</span><br><span class="line">    &lt;version&gt;1.0.7.RELEASE&lt;/version&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;io.spring.platform&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;platform-bom&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;Cairo-SR5&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.0.3.RELEASE&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;!--&lt;mainClass&gt;$&#123;start-class&#125;&lt;/mainClass&gt;--&gt;</span><br><span class="line">                    &lt;layout&gt;ZIP&lt;/layout&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure></p>
<p>application.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: spring-jms</span><br><span class="line">  kafka:</span><br><span class="line">    bootstrap-servers: node-2:9092,node-3:9092,node-4:9092</span><br><span class="line">    producer:</span><br><span class="line">      retries:</span><br><span class="line">      batch-size: 16384</span><br><span class="line">      buffer-memory: 33554432</span><br><span class="line">      compressionType: snappy</span><br><span class="line">      acks: all</span><br><span class="line">    consumer:</span><br><span class="line">      group-id: 0</span><br><span class="line">      auto-offset-reset: earliest</span><br><span class="line">      enable-auto-commit: true</span><br></pre></td></tr></table></figure></p>
<p>message:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-12-26</span><br><span class="line"> **/</span><br><span class="line">@ToString</span><br><span class="line">public class Message&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private Long id;</span><br><span class="line"></span><br><span class="line">    private T message;</span><br><span class="line"></span><br><span class="line">    private Date time;</span><br><span class="line"></span><br><span class="line">    public Long getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setId(Long id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public T getMessage() &#123;</span><br><span class="line">        return message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMessage(T message) &#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getTime() &#123;</span><br><span class="line">        return time;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTime(Date time) &#123;</span><br><span class="line">        this.time = time;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>controller<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import com.andy.jms.kafka.service.KafkaSender;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt; </span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-12-26</span><br><span class="line"> **/</span><br><span class="line">@Slf4j</span><br><span class="line">@RestController</span><br><span class="line">public class KafkaController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private KafkaSender kafkaSender;</span><br><span class="line"></span><br><span class="line">    @GetMapping(&quot;/kafka/&#123;topic&#125;&quot;)</span><br><span class="line">    public String send(@PathVariable(&quot;topic&quot;) String topic, @RequestParam String message) &#123;</span><br><span class="line">        kafkaSender.send(topic, message);</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>KafkaReceiver:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.kafka.clients.consumer.ConsumerRecord;</span><br><span class="line">import org.springframework.kafka.annotation.KafkaListener;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Optional;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt; </span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-12-26</span><br><span class="line"> **/</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class KafkaReceiver &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @KafkaListener(topics = &#123;&quot;order&quot;&#125;)</span><br><span class="line">    public void listen(ConsumerRecord&lt;?, ?&gt; record) &#123;</span><br><span class="line">        Optional&lt;?&gt; kafkaMessage = Optional.ofNullable(record.value());</span><br><span class="line">        if (kafkaMessage.isPresent()) &#123;</span><br><span class="line">            Object message = kafkaMessage.get();</span><br><span class="line">            log.info(&quot;record:&#123;&#125;&quot;, record);</span><br><span class="line">            log.info(&quot;message:&#123;&#125;&quot;, message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>KafkaSender:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import com.andy.jms.kafka.commen.Message;</span><br><span class="line">import com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line">import com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.kafka.core.KafkaTemplate;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-12-26</span><br><span class="line"> **/</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class KafkaSender &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @param topic</span><br><span class="line">     * @param body</span><br><span class="line">     */</span><br><span class="line">    public void send(String topic, Object body) &#123;</span><br><span class="line">        Message&lt;String&gt; message = new Message&lt;&gt;();</span><br><span class="line">        message.setId(System.currentTimeMillis());</span><br><span class="line">        message.setMessage(body.toString());</span><br><span class="line">        message.setTime(new Date());</span><br><span class="line">        String content = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            content = objectMapper.writeValueAsString(message);</span><br><span class="line">        &#125; catch (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        kafkaTemplate.send(topic, content);</span><br><span class="line">        log.info(&quot;send &#123;&#125; to &#123;&#125; success!&quot;, message, topic);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>main:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Leone</span><br><span class="line"> * @since 2018-04-10</span><br><span class="line"> **/</span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class JmsApplication &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(JmsApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/janlle/spring-boot-examples" target="_blank" rel="noopener">github地址</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/Kafka/" data-id="cjrqbftz0000yakc40dzmg7hx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-jvm" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/jvm/" class="article-date">
  <time datetime="2019-02-04T12:16:13.942Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: JVM<br>date: 2018-01-05 11:31:12<br>tags: [linux, 大数据, jvm, java]<br>categories: jvm</p>
<h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><h2 id="jvm-简介"><a href="#jvm-简介" class="headerlink" title="jvm 简介"></a>jvm 简介</h2><h3 id="什么是jvm"><a href="#什么是jvm" class="headerlink" title="什么是jvm"></a>什么是jvm</h3><p>Java虚拟机概貌<br>Java虚拟机（英语：Java Virtual Machine，缩写为JVM），一种能够运行Java bytecode的虚拟机，以堆栈结构机器来进行实做。最早由太阳微系统所研发并实现第一个实现版本，是Java平台的一部分，能够运行以Java语言写作的软件程序。</p>
<p>Java虚拟机有自己完善的硬体架构，如处理器、堆栈、寄存器等，还具有相应的指令系统。JVM屏蔽了与具体操作系统平台相关的信息，使得Java程序只需生成在Java虚拟机上运行的目标代码（字节码），就可以在多种平台上不加修改地运行。通过对中央处理器（CPU）所执行的软件实现，实现能执行编译过的Java程序码（Applet与应用程序）。</p>
<p>作为一种编程语言的虚拟机，实际上不只是专用于Java语言，只要生成的编译文件匹配JVM对加载编译文件格式要求，任何语言都可以由JVM编译运行。此外，除了甲骨文，也有其他开源或闭源的实现。</p>
<h3 id="jvm-种类"><a href="#jvm-种类" class="headerlink" title="jvm 种类"></a>jvm 种类</h3><p><strong>HotSpot VM</strong></p>
<p>HotSpot VM是绝对的主流。大家用它的时候很可能就没想过还有别的选择，或者是为了迁就依赖了Oracle/Sun JDK某些具体实现的烂代码而选择用HotSpot VM省点心。</p>
<p>Oracle / Sun JDK、OpenJDK的各种变种（例如IcedTea、Zulu），用的都是相同核心的HotSpot VM。<br>从Java SE 7开始，HotSpot VM就是Java规范的“参考实现”（RI，Reference Implementation）。把它叫做“标准JVM”完全不为过。</p>
<p>当大家说起“Java性能如何如何”、“Java有多少种GC”、“JVM如何调优”等等，经常默认说的就是特指HotSpot VM。可见其“主流性”。<br>（其实这不是件好事；具体到JVM实现才可以讨论的问题还是应该指明讨论是基于哪个实现）</p>
<p>JDK8的HotSpot VM已经是以前的HotSpot VM与JRockit VM的合并版，也就是传说中的“HotRockit”，只是产品里名字还是叫HotSpot VM。<br>这个合并并不是要把JRockit的部分代码插进HotSpot里，而是把前者一些有价值的功能在后者里重新实现一遍。移除PermGen、Java Flight Recorder、jcmd等都属于合并项目的一部分。</p>
<p>不过要留意的是，这里我说的HotSpot VM特指“正常配置”版，而不包括“Zero / Shark”版。Wikipedia那个页面上把后者称为“Zero Port”。用这个版本的人应该相当少，很多时候它的release版都build不成功…</p>
<p><strong>J9 VM</strong></p>
<p>J9是IBM开发的一个高度模块化的JVM。</p>
<p>在许多平台上，IBM J9 VM都只能跟IBM产品一起使用。这不是技术限制，而是许可证限制。<br>例如说在Windows上IBM JDK不是免费公开的，而是要跟IBM其它产品一起捆绑发布的；使用IBM Rational、IBM WebSphere的话都有机会用到J9 VM（也可以自己选择配置使用别的Java SE JVM）。<br>根据许可证，这种捆绑在产品里的J9 VM不应该用于运行别的Java程序，但是大家自己“偷偷的”拿来跑别的程序，IBM也没力气管。而在一些IBM的硬件平台上，很少客户是只买硬件不买配套软件的，IBM给一整套解决方案，里面可能就包括了IBM JDK。这样自然而然就用上了J9 VM。所以J9 VM得算在主流里，虽然很少是大家主动选择的首选。</p>
<p>J9 VM的性能水平大致跟HotSpot VM是一个档次的。有时HotSpot快些，有时J9快些。不过J9 VM有一些HotSpot VM在JDK8还不支持的功能，最显著的一个就是J9支持AOT编译和更强大的class data sharing。</p>
<p><strong>JRockit</strong></p>
<p>以前Java SE的主流JVM中还有JRockit，跟HotSpot与J9一起并称三大主流JVM。这三家的性能水平基本都在一个水平上，竞争很激烈。<br>自从Oracle把BEA和Sun都收购了之后，Java SE JVM只能二选一，JRockit就炮灰了。JRockit最后发布的大版本是R28，只到JDK6；原本在开发中的R29及JDK7的对应功能都没来得及完成项目就被终止了。</p>
<p>想在.NET上使用某些流行的Java库，或者干脆在.NET上运行完整的Java程序不？那<a href="http://IKVM.NET是不二之选。" target="_blank" rel="noopener">http://IKVM.NET是不二之选。</a></p>
<p>主流就说这么几个吧。其它支持Java SE的JVM还有好多，但是难说是主流。</p>
<p>要比惨的话，Apache Harmony里的DRLVM可能算是最惨之一。背后有IBM和Intel的强力支持，本来有望成为F/OSS系的主流JVM，奈何被Sun狠狠的捅了一刀，不让它跑JCK；使它不能名正言顺的使用Java™，更不能说自己是符合规范的JVM。然后Sun自己赶紧开源了自己的JDK，一直拖到硬把Harmony项目逼死了。</p>
<p>Java SE Embedded</p>
<p>这是Oracle造出来的比较新的概念。硬件发展得很快，现在很多所谓“嵌入式”场景用的机器其实跟普通台式机的配置没差多少，完全足以运行Java SE，侵蚀了以前高端Java ME（例如Java ME CDC Profile）的地盘。</p>
<p>Oracle Java SE Embedded里带的JVM自然还是HotSpot VM，不过是Java SE Embedded定制版：简化了JVM内的某些部件，尽可能在支持完整的Java SE功能的前提下向着减少内存消耗的方向优化；只留下了Client Compiler（C1）而去掉了Server Compiler（C2）；GC以前好像是只留下了Serial GC但后来有没有支持更多GC种类。</p>
<p>IBM在这个领域照样可以用J9 VM应对。</p>
<p>其它还算主流Java SE Embedded JVM的话，可能JamVM可以算进来吧。它是一个小巧的、能支持完全OpenJDK类库和Java SE规范的JVM。</p>
<h3 id="jvm-的组成"><a href="#jvm-的组成" class="headerlink" title="jvm 的组成"></a>jvm 的组成</h3><p><strong>栈 Stack（线程独占）</strong></p>
<p>Java虚拟机栈（Java Virtual Machine Stacks）是线程私有的，它的生命周期与线程相同。虚拟机栈描述的是Java方法执行的内存模型：每个方法被执行的时候都会同时创建一个栈帧（Stack Frame）用于存储局部变量表、操作栈、动态链接、方法出口等信息。每一个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。 </p>
<p>局部变量表存放了编译期可知的各种基本数据类型（boolean、byte、char、short、int、float、long、double）、对象引用（reference类型，它不等同于对象本身，根据不同的虚拟机实现，它可能是一个指向对象起始地址的引用指针，也可能指向一个代表对象的句柄或者其他与此对象相关的位置）和returnAddress类型（指向了一条字节码指令的地址）。</p>
<p>其中64位长度的long和double类型的数据会占用2个局部变量空间（Slot），其余的数据类型只占用1个。局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。</p>
<p>在Java虚拟机规范中，对这个区域规定了两种异常状况：如果线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError异常；如果虚拟机栈可以动态扩展（当前大部分的Java虚拟机都可动态扩展，只不过Java虚拟机规范中也允许固定长度的虚拟机栈），当扩展时无法申请到足够的内存时会抛出OutOfMemoryError异常。</p>
<p><strong>堆 Heap（线程共享）</strong></p>
<p>java堆是和应用程序关系最为密切的内存空间，几乎所有的对象都存放在堆上。并且java堆是完全自动化管理的，通过垃圾回收机制，垃圾对象会被自动清理，而不需要显示的释放。<br>根据java回收机制的不同，java堆有可能拥有不同的结构。最为常见的一种构成是将整个java堆分为新生代和老年代。其中新生代存放新生对象或者年龄不大的对象，老年代则存放老年对象。新生代有可能分为eden区、s0区、s1区，s0区和s1区也被称为from和to区，他们是两块大小相同、可以互换角色的内存空间。</p>
<p><strong>方法区 Method Area（线程共享）</strong></p>
<p>主要用于存储Class Data和Meta Data，简单地说，Java类加载器将Java类加载到JVM中后，类的信息会保存在方法区，比如类的静态成员，构造器，方法等。一般情况下，java.lang.OutOfMemoryError: PermGen space异常就是由于该区空间耗尽而引起的，方法区由多个线程共享。</p>
<p><strong>程序计数器 Program Counter Register（线程独享）</strong></p>
<p>程序计数器（Program Counter Register）是一块较小的内存空间，它的作用可以看做是当前线程所执行的字节码的行号指示器。在虚拟机的概念模型里（仅是概念模型，各种虚拟机可能会通过一些更高效的方式去实现），字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成。<br>由于Java虚拟机的多线程是通过线程轮流切换并分配处理器执行时间的方式来实现的，在任何一个确定的时刻，一个处理器（对于多核处理器来说是一个内核）只会执行一条线程中的指令。因此，为了线程切换后能恢复到正确的执行位置，每条线程都需要有一个独立的程序计数器，各条线程之间的计数器互不影响，独立存储，我们称这类内存区域为“线程私有”的内存。<br>如果线程正在执行的是一个Java方法，这个计数器记录的是正在执行的虚拟机字节码指令的地址；如果正在执行的是Natvie方法，这个计数器值则为空（Undefined）。</p>
<p><strong>本地方法栈 Native Method Stacks（线程独享）</strong></p>
<p>本地方法栈（Native Method Stacks）与虚拟机栈所发挥的作用是非常相似的，其区别不过是虚拟机栈为虚拟机执行Java方法（也就是字节码）服务，而本地方法栈则是为虚拟机使用到的Native方法服务。虚拟机规范中对本地方法栈中的方法使用的语言、使用方式与数据结构并没有强制规定，因此具体的虚拟机可以自由实现它。甚至有的虚拟机（譬如Sun HotSpot虚拟机）直接就把本地方法栈和虚拟机栈合二为一。与虚拟机栈一样，本地方法栈区域也会抛出StackOverflowError和OutOfMemoryError异常。</p>
<h2 id="GC-垃圾回收器"><a href="#GC-垃圾回收器" class="headerlink" title="GC(垃圾回收器)"></a>GC(垃圾回收器)</h2><p>Java的内存分配与回收全部由JVM垃圾回收进程自动完成。与C语言不同，Java开发者不需要自己编写代码实现垃圾回收。这是Java深受大家欢迎的众多特性之一，能够帮助程序员更好地编写Java程序。</p>
<p><strong>常见的java垃圾回收器</strong></p>
<ul>
<li><p>串行垃圾回收器（Serial Garbage Collector）</p>
<blockquote>
<p>串行垃圾回收器通过持有应用程序所有的线程进行工作。它为单线程环境设计，只使用一个单独的线程进行垃圾回收，通过冻结所有应用程序线程进行工作，所以可能不适合服务器环境。它最适合的是简单的命令行程序。d通过JVM参数-XX:+UseSerialGC可以使用串行垃圾回收器。</p>
</blockquote>
</li>
<li><p>并行垃圾回收器（Parallel Garbage Collector）</p>
<blockquote>
<p>并行垃圾回收器也叫做 throughput collector 。它是JVM的默认垃圾回收器。与串行垃圾回收器不同，它使用多线程进行垃圾回收。相似的是，它也会冻结所有的应用程序线程当执行垃圾回收的时候</p>
</blockquote>
</li>
<li><p>并发标记扫描垃圾回收器（CMS Garbage Collector）</p>
<blockquote>
<p>并发标记垃圾回收使用多线程扫描堆内存，标记需要清理的实例并且清理被标记过的实例。并发标记垃圾回收器只会在下面两种情况持有应用程序所有线程。<br>1.当标记的引用对象在tenured区域；<br>2.在进行垃圾回收的时候，堆内存的数据被并发的改变。<br>相比并行垃圾回收器，并发标记扫描垃圾回收器使用更多的CPU来确保程序的吞吐量。如果我们可以为了更好的程序性能分配更多的CPU，那么并发标记上扫描垃圾回收器是更好的选择相比并发垃圾回收器。<br>通过JVM参数 XX:+USeParNewGC 打开并发标记扫描垃圾回收器。</p>
</blockquote>
</li>
<li><p>G1垃圾回收器（G1 Garbage Collector）</p>
<blockquote>
<p>G1垃圾回收器适用于堆内存很大的情况，他将堆内存分割成不同的区域，并且并发的对其进行垃圾回收。G1也可以在回收内存之后对剩余的堆内存空间进行压缩。并发扫描标记垃圾回收器在STW情况下压缩内存。G1垃圾回收会优先选择第一块垃圾最多的区域<br>通过JVM参数 –XX:+UseG1GC 使用G1垃圾回收器</p>
</blockquote>
</li>
</ul>
<p><strong>Java 8 的新特性</strong></p>
<p>在使用G1垃圾回收器的时候，通过 JVM参数 -XX:+UseStringDeduplication 。 我们可以通过删除重复的字符串，只保留一个char[]来优化堆内存。这个选择在Java 8 u 20被引入。</p>
<p>我们给出了全部的四种Java垃圾回收器，需要根据应用场景，硬件性能和吞吐量需求来决定使用哪一种。</p>
<p><strong>垃圾回收的JVM配置</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">配置</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">-XX:+UseSerialGC</td>
<td style="text-align:left">串行垃圾回收器</td>
</tr>
<tr>
<td style="text-align:left">-XX:+UseParallelGC</td>
<td style="text-align:left">并行垃圾回收器</td>
</tr>
<tr>
<td style="text-align:left">-XX:+UseConcMarkSweepGC</td>
<td style="text-align:left">并发标记扫描垃圾回收器</td>
</tr>
<tr>
<td style="text-align:left">-XX:ParallelCMSThreads</td>
<td style="text-align:left">并发标记扫描垃圾回收器 =为使用的线程数量</td>
</tr>
<tr>
<td style="text-align:left">-XX:+UseG1GC</td>
<td style="text-align:left">G1垃圾回收器</td>
</tr>
</tbody>
</table>
<h3 id="jvm常见参数调优"><a href="#jvm常见参数调优" class="headerlink" title="jvm常见参数调优"></a>jvm常见参数调优</h3><h1 id="最大JVM可用内存"><a href="#最大JVM可用内存" class="headerlink" title="最大JVM可用内存"></a>最大JVM可用内存</h1><p>-Xmx1024m</p>
<h1 id="最小JVM可用内存"><a href="#最小JVM可用内存" class="headerlink" title="最小JVM可用内存"></a>最小JVM可用内存</h1><p>-Xms2g</p>
<h1 id="年轻代内存大小"><a href="#年轻代内存大小" class="headerlink" title="年轻代内存大小"></a>年轻代内存大小</h1><p>-Xmn512m</p>
<h1 id="设置新生代最小空间大小。"><a href="#设置新生代最小空间大小。" class="headerlink" title="设置新生代最小空间大小。"></a>设置新生代最小空间大小。</h1><p>-XX:NewSize</p>
<h1 id="设置新生代最大空间大小。"><a href="#设置新生代最大空间大小。" class="headerlink" title="设置新生代最大空间大小。"></a>设置新生代最大空间大小。</h1><p>-XX:MaxNewSize</p>
<h1 id="PermSize：永久代内存大小，该值太大会导致fullGC时间过长，太小将增加fullGC频率"><a href="#PermSize：永久代内存大小，该值太大会导致fullGC时间过长，太小将增加fullGC频率" class="headerlink" title="PermSize：永久代内存大小，该值太大会导致fullGC时间过长，太小将增加fullGC频率"></a>PermSize：永久代内存大小，该值太大会导致fullGC时间过长，太小将增加fullGC频率</h1><p>-XX:PermSize=128m</p>
<p>-XX:MaxPermSize设置永久代最大空间大小。</p>
<h1 id="线程栈大小，太大将导致JVM可建的线程数量减少，例：-Xss256k"><a href="#线程栈大小，太大将导致JVM可建的线程数量减少，例：-Xss256k" class="headerlink" title="线程栈大小，太大将导致JVM可建的线程数量减少，例：-Xss256k"></a>线程栈大小，太大将导致JVM可建的线程数量减少，例：-Xss256k</h1><p>-Xss256k</p>
<p>禁止手动fullGC，如果配置，则System.gc()将无效，比如在为DirectByteBuffer分配空间过程中发现直接内存不足时会显式调用System.gc()<br>-XX:+DisableExplicitGC</p>
<h1 id="一般PermGen是不会被GC，如果希望PermGen永久代也能被GC，则需要配置该参数"><a href="#一般PermGen是不会被GC，如果希望PermGen永久代也能被GC，则需要配置该参数" class="headerlink" title="一般PermGen是不会被GC，如果希望PermGen永久代也能被GC，则需要配置该参数"></a>一般PermGen是不会被GC，如果希望PermGen永久代也能被GC，则需要配置该参数</h1><p>-XX:+UseConcMarkSweepGC</p>
<h1 id="GC进行时标记可回收对象时可以并行remark-XX-UseCMSCompactAtFullCollection-表示在fullGC之后进行压缩，CMS默认不压缩空间"><a href="#GC进行时标记可回收对象时可以并行remark-XX-UseCMSCompactAtFullCollection-表示在fullGC之后进行压缩，CMS默认不压缩空间" class="headerlink" title="GC进行时标记可回收对象时可以并行remark-XX:+UseCMSCompactAtFullCollection 表示在fullGC之后进行压缩，CMS默认不压缩空间"></a>GC进行时标记可回收对象时可以并行remark-XX:+UseCMSCompactAtFullCollection 表示在fullGC之后进行压缩，CMS默认不压缩空间</h1><p>-XX:+CMSParallelRemarkEnabled</p>
<h1 id="为java堆内存设置内存页大小"><a href="#为java堆内存设置内存页大小" class="headerlink" title="为java堆内存设置内存页大小"></a>为java堆内存设置内存页大小</h1><p>-XX:LargePageSizeInBytes=128m</p>
<h1 id="对原始类型进行快速优化"><a href="#对原始类型进行快速优化" class="headerlink" title="对原始类型进行快速优化"></a>对原始类型进行快速优化</h1><p>-XX:+UseFastAccessorMethods</p>
<h1 id="关闭预期开始的晋升率的统计"><a href="#关闭预期开始的晋升率的统计" class="headerlink" title="关闭预期开始的晋升率的统计"></a>关闭预期开始的晋升率的统计</h1><p>-XX:+UseCMSInitiatingOccupancyOnly</p>
<h1 id="使用cms作为垃圾回收，并设置GC百分比，例（使用70％后开始CMS收集）"><a href="#使用cms作为垃圾回收，并设置GC百分比，例（使用70％后开始CMS收集）" class="headerlink" title="使用cms作为垃圾回收，并设置GC百分比，例（使用70％后开始CMS收集）"></a>使用cms作为垃圾回收，并设置GC百分比，例（使用70％后开始CMS收集）</h1><p>-XX:CMSInitiatingOccupancyFraction=70</p>
<h1 id="打印GC的详细信息"><a href="#打印GC的详细信息" class="headerlink" title="打印GC的详细信息"></a>打印GC的详细信息</h1><p>-XX:+PrintGintGCDateStamp</p>
<h1 id="指定GC文件路径"><a href="#指定GC文件路径" class="headerlink" title="指定GC文件路径"></a>指定GC文件路径</h1><p>-Xloggc</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/jvm/" data-id="cjrqbftyn000vakc4uia1osj0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/java/" class="article-date">
  <time datetime="2019-02-04T12:16:13.939Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/java/" data-id="cjrqbftwm0000akc4oowhrejc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Hive" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/Hive/" class="article-date">
  <time datetime="2019-02-04T12:16:13.924Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h1><h2 id="hive简介和基本概念"><a href="#hive简介和基本概念" class="headerlink" title="hive简介和基本概念"></a>hive简介和基本概念</h2><h3 id="什么是hive"><a href="#什么是hive" class="headerlink" title="什么是hive"></a>什么是hive</h3><p>hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。</p>
<p>最初，Hive是由Facebook开发，后来由Apache软件基金会开发，并作为进一步将它作为名义下Apache Hive为一个开源项目。Hive 没有专门的数据格式。 Hive 可以很好的工作在 Thrift 之上，控制分隔符，也允许用户指定数据格式。Hive不适用于在线事务处理。 它最适用于传统的数据仓库任务。</p>
<h3 id="Hive的的优点及应用场景"><a href="#Hive的的优点及应用场景" class="headerlink" title="Hive的的优点及应用场景"></a>Hive的的优点及应用场景</h3><ul>
<li><p>Hive可以自由的扩展集群的规模，一般情况下不需要重启服务。</p>
</li>
<li><p>Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</p>
</li>
<li><p>良好的容错性，节点出现问题SQL仍可完成执行。</p>
</li>
<li><p>操作接口采用类SQL语法，提供快速开发的能力(简单、容易上手);</p>
</li>
<li><p>避免了去写MapReduce，减少开发人员的学习成本;</p>
</li>
<li><p>统一的元数据管理，可与impala/spark等共享元数据;</p>
</li>
<li><p>易扩展(HDFS+MapReduce：可以扩展集群规模；支持自定义函数);</p>
</li>
<li><p>数据的离线处理；比如：日志分析，海量结构化数据离线分析;</p>
</li>
<li><p>Hive的执行延迟比较高，因此hive常用于数据分析的，对实时性要求 不高的场合;</p>
</li>
<li><p>Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执 行延迟比较高;</p>
</li>
</ul>
<h3 id="数据仓库概念"><a href="#数据仓库概念" class="headerlink" title="数据仓库概念"></a>数据仓库概念</h3><p>数据仓库（Data Warehouse）是一个面向主题的（Subject Oriented）、集成的（Integrated）、相对稳定的（Non-Volatile）、反应历史变化（Time Variant）的数据集合，用于支持管理决策。数据仓库体系结构通常含四个层次：数据源、数据存储和管理、数据服务、数据应用。</p>
<ul>
<li><p>数据源：是数据仓库的数据来源，含外部数据、现有业务系统和文档资料等；</p>
</li>
<li><p>数据集成：完成数据的抽取、清洗、转换和加载任务，数据源中的数据采用ETL（Extract-Transform-Load）工具以固定的周期加载到数据仓库中。</p>
</li>
<li><p>数据存储和管理：此层次主要涉及对数据的存储和管理，含数据仓库、数据集市、数据仓库检测、运行与维护工具和元数据管理等。</p>
</li>
<li><p>数据服务：为前端和应用提供数据服务，可直接从数据仓库中获取数据供前端应用使用，也可通过OLAP（OnLine Analytical Processing，联机分析处理）服务器为前端应用提供负责的数据服务。</p>
</li>
<li><p>数据应用：此层次直接面向用户，含数据查询工具、自由报表工具、数据分析工具、数据挖掘工具和各类应用系统。</p>
</li>
</ul>
<h3 id="Hive中表的分类"><a href="#Hive中表的分类" class="headerlink" title="Hive中表的分类"></a>Hive中表的分类</h3><p>内部表：什么是内部表需要对比外部表来看删表时数据和表一起删除。</p>
<p>外部表：数据已经存在于HDFS，外部表只是走一个过程，加载数据和创建表同时完成，不会移动到数据仓库目录中，仅仅是和数据建立了一个连接，删表数据不会删除数据。</p>
<p>分区表：在Hive Select查询中，一般会扫描整个表内容，会消耗很多时间做没必要的工作。 分区表指的是在创建表时，指定partition的分区空间。扫描时可以只扫描某一个分区的数据，分区表存储时分局所设立的分区分别存储数据（分区字段就是一个文件夹的标识）分区表可以是内部表也可以是外部表。</p>
<p>分桶表：对于每一个表（table）或者分区，Hive可以进一步组织成桶，也就是说捅是更为细粒度的数据范困划分。分桶表是对列值取哈希值的方式，将不同数据放到不同文件中存储,一个文件对应一个桶由列的哈希值除以桶的个数来决定每条数据划分在哪个桶中</p>
<h3 id="Hive架构体系"><a href="#Hive架构体系" class="headerlink" title="Hive架构体系"></a>Hive架构体系</h3><ul>
<li><p>用户接口主要有三个：CLI，Client 和 WUI。其中最常用的是CLI，Cli启动的时候，会同时启动一个Hive副本。Client是Hive的客户端，用户连接至Hive Server。在启动 Client模式的时候，需要指出Hive Server所在节点，并且在该节点启动Hive Server。 WUI是通过浏览器访问Hive。</p>
</li>
<li><p>Hive将元数据存储在数据库中，如mysql、derby。Hive中的元数据包括表的名字，表的列和分区及其属性，表的属性（是否为外部表等），表的数据所在目录等。</p>
</li>
<li><p>解释器、编译器、优化器完成HQL查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在HDFS中，并在随后有MapReduce调用执行。</p>
</li>
<li><p>Hive的数据存储在HDFS中，大部分的查询计算由MapReduce完成（包含<em>的查询，比如select </em> from table不会生成MapRedcue任务），Hive将元数据存储在RDBMS中，</p>
</li>
</ul>
<h3 id="Hive核心组件"><a href="#Hive核心组件" class="headerlink" title="Hive核心组件"></a>Hive核心组件</h3><p><strong>Driver</strong></p>
<p>实现了session handler，在JDBC/ODBC接口上实现了执行和获取信息的API。</p>
<p><strong>Compiler</strong></p>
<p>该组件用于对不同的查询表达式做解析查询，语义分析，最终会根据从metastore中查询到的表和分区元数据生成一个execution plain。</p>
<p><strong>Execution Egine</strong></p>
<p>该组件会执行由compiler创建的execution。其中plan从数据结构上来看，是一个DAG，该组件会管理plan的不同stage与组件中执行这些plan之间的依赖。</p>
<p><strong>Metastore</strong></p>
<p>Hive的metastore组件是hive元数据集中存放地。该组件存储了包括变量表中列和列类型等结构化的信息以及数据仓库中的分区信息（包括列和列类型信息，读写数据时必要的序列化和反序列化信息，数据被存储在HDFS文件中的位置）。Metastore组件包括两个部分：metastore services和Meta storage database。</p>
<h3 id="hive的特点"><a href="#hive的特点" class="headerlink" title="hive的特点"></a>hive的特点</h3><ul>
<li><p>通过SQL轻松访问数据的工具，从而实现数据仓库任务（如提取/转换/加载（ETL），报告和数据分析）。</p>
</li>
<li><p>一种对各种数据格式施加结构的机制</p>
</li>
<li><p>访问直接存储在Apache HDFS或其他数据存储系统（如Apache HBase）中的文件</p>
</li>
<li><p>通过Apache Tez，Apache Spark或MapReduce执行查询</p>
</li>
<li><p>程序语言与HPL-SQL</p>
</li>
<li><p>通过Hive LLAP，Apache YARN和Apache Slider进行亚秒级查询检索。</p>
</li>
</ul>
<h3 id="Hive与Hadoop生态系统中其他组件的关系"><a href="#Hive与Hadoop生态系统中其他组件的关系" class="headerlink" title="Hive与Hadoop生态系统中其他组件的关系"></a>Hive与Hadoop生态系统中其他组件的关系</h3><ul>
<li><p>Hive依赖于HDFS存储数据，依赖MR处理数据；</p>
</li>
<li><p>Pig可作为Hive的替代工具，是一种数据流语言和运行环境，适合用于在Hadoop平台上查询半结构化数据集，用于与ETL过程的一部分，即将外部数据装载到Hadoop集群中，转换为用户需要的数据格式；</p>
</li>
<li><p>HBase是一个面向列的、分布式可伸缩的数据库，可提供数据的实时访问功能，而Hive只能处理静态数据，主要是BI报表数据，Hive的初衷是为减少复杂MR应用程序的编写工作，HBase则是为了实现对数据的实时访问</p>
</li>
</ul>
<h2 id="hive-安装和客户端操作"><a href="#hive-安装和客户端操作" class="headerlink" title="hive 安装和客户端操作"></a>hive 安装和客户端操作</h2><h3 id="hive的安装"><a href="#hive的安装" class="headerlink" title="hive的安装"></a>hive的安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># 首先需要安装hadoop、mysql[参见](http://wwww.baidu.com)</span><br><span class="line"></span><br><span class="line"># 下载</span><br><span class="line">wget http://mirror.bit.edu.cn/apache/hive/hive-2.1.1/apache-hive-2.1.1-bin.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">tar -zxvf apache-hive-2.1.1-bin.tar.gz </span><br><span class="line"></span><br><span class="line">cp $HIVE_HOME/conf/hive-env.sh.template hive-env.sh</span><br><span class="line"></span><br><span class="line"># 新增两行</span><br><span class="line">export HADOOP_HOME=$HADOOP_HOME</span><br><span class="line">export HIVE_CONF_DIR=$HIVE_HOME/conf</span><br><span class="line"></span><br><span class="line">## 新增hive-site.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;&lt;!--</span><br><span class="line">   Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="line">   contributor license agreements.  See the NOTICE file distributed with</span><br><span class="line">   this work for additional information regarding copyright ownership.</span><br><span class="line">   The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="line">   (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="line">   the License.  You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">       http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">   Unless required by applicable law or agreed to in writing, software</span><br><span class="line">   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line">   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">   See the License for the specific language governing permissions and</span><br><span class="line">   limitations under the License.</span><br><span class="line">--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;jdbc:mysql://ip:3306/hive?createDatabaseIfNotExist=true&amp;amp;useSSL=false&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;root&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;password&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line"> &lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># 拷贝mysql的驱动到$HIVE_HOME/lib下</span><br><span class="line"></span><br><span class="line"># 初始化hive</span><br><span class="line">$HIVE_HOME/bin/schematool -dbType mysql -initSchema</span><br><span class="line"></span><br><span class="line"># 检测hive是否安装成功</span><br><span class="line">$HIVE_HOME/bin/hive</span><br><span class="line"></span><br><span class="line"># 启动hive服务</span><br><span class="line">$HIVE_HOME/bin/hiveserver2</span><br><span class="line"></span><br><span class="line"># 第一种连接 hivesever 的方式</span><br><span class="line">$HIVE_HOME/bin/beenline</span><br><span class="line"></span><br><span class="line"># 输入用户名:你主机的用户 密码:直接输入回车</span><br><span class="line">!connect jdbc:hive2://ip:10000</span><br><span class="line"></span><br><span class="line"># 第二种连接 hiveServer 的方式</span><br><span class="line">$HIVE_HOME/bin/beenline -u jdbc:hive2://ip:10000 -u root</span><br></pre></td></tr></table></figure>
<h3 id="hive-命令行操作"><a href="#hive-命令行操作" class="headerlink" title="hive 命令行操作"></a>hive 命令行操作</h3><blockquote>
<p>hive的sql操作和mysql差不多</p>
</blockquote>
<ul>
<li>查看所有数据库</li>
</ul>
<p><code>show databases;</code></p>
<ul>
<li>创建数据库</li>
</ul>
<p><code>create database db1;</code></p>
<ul>
<li>使用指定数据</li>
</ul>
<p><code>use db1;</code></p>
<ul>
<li>创内部建表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(id int, name string, sex string, age int,</span><br><span class="line"> department string)row format delimited fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除表</li>
</ul>
<p><code>drop table t_user;</code></p>
<ul>
<li>插入数据</li>
</ul>
<p><code>insert into t_user values(95013,&quot;老王&quot;,&quot;男&quot;,18,&quot;IS&quot;);</code></p>
<ul>
<li>查询表中的数据</li>
</ul>
<p><code>select * from t_user limit 1;</code></p>
<ul>
<li>创建外部表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(id int, name string, sex string, age int, </span><br><span class="line">    department string)row format delimited fields terminated by</span><br><span class="line">     &apos;,&apos; location &apos;/app-log/data&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建分区表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create external table t_user(id int, name string, sex string, </span><br><span class="line">    age int, department string) partitioned by (create_time string) </span><br><span class="line">row format delimited fields terminated by &apos;,&apos; location &apos;/app-log&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>分区表从本地文件系统加载数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &apos;/root/2018-12-02.log&apos; into table t_user partition(create_time=20181202);</span><br></pre></td></tr></table></figure>
<ul>
<li>insert单条插入的方式往分区表中插入数据：</li>
</ul>
<p><code>insert into t_user partition (create_time=&quot;20181201&quot;) values(95019,&quot;老王&quot;,&quot;男&quot;,18,&quot;IS&quot;);</code></p>
<ul>
<li>删除Hive分区表中的分区</li>
</ul>
<p><code>alter table t_user drop partition(create_time=&quot;20181203&quot;);</code></p>
<ul>
<li>创建临时表TEMPORARY代表这是一个临时表。</li>
</ul>
<p><code>create temporary table t_temp(id int,name string);</code></p>
<ul>
<li>创建多级分区表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_user2(id int, content string)</span><br><span class="line">partitioned by (day int,hour int)</span><br><span class="line">row fromat delimited fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>多级分区表插入数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_user2 partition(day=9,hour=1) values(1,&quot;leone&quot;),(2,&quot;tom&quot;),(3,&quot;jandy&quot;),(4,&quot;jack&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>添加分区</li>
</ul>
<p><code>alter table t_user2 add partition (day=5, hour=9);</code></p>
<ul>
<li>分桶表 (开启hive的分桶表开关set hive.enforce.bucketing=true;)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_user3(id int, name string, age int) </span><br><span class="line">clustered by (age) into 4 buckets row format delimited </span><br><span class="line">fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>分桶表插入数据只可以使用insert</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t_user3 values(1, &quot;james&quot;, 19),(2, &quot;andy&quot;, 35),(3, &quot;tom&quot;, 18),</span><br><span class="line">(4, &quot;jerry&quot;, 23),(5, &quot;leone&quot;, 25),(6, &quot;kobe&quot;, 45),(7, &quot;justin&quot;, 29),(8, &quot;colin&quot;, 13);</span><br></pre></td></tr></table></figure>
<h3 id="hive-java客户端操作"><a href="#hive-java客户端操作" class="headerlink" title="hive java客户端操作"></a>hive java客户端操作</h3><p>pom:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hive-jdbc&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hive-exec&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br></pre></td></tr></table></figure></p>
<p>java：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.Statement;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt; jdbc连接hive</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-06-17</span><br><span class="line"> **/</span><br><span class="line">public class HiveClientTest &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 1,123.25.51.81,https://www.google.com,2019-01-21</span><br><span class="line">     * 2,123.25.51.82,https://www.youku.com,2019-01-22</span><br><span class="line">     * 3,123.25.51.83,https://www.taobao.com,2019-01-23</span><br><span class="line">     * 4,123.25.51.84,https://www.baidu.com,2019-01-24</span><br><span class="line">     * 5,123.25.51.85,https://www.jd.com,2019-01-26</span><br><span class="line">     * 6,123.25.51.86,https://www.tianmao.com,2019-01-27</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private Connection connection;</span><br><span class="line"></span><br><span class="line">    private Statement statement;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws Exception &#123;</span><br><span class="line">        Class.forName(&quot;org.apache.hive.jdbc.HiveDriver&quot;);</span><br><span class="line">        connection = DriverManager.getConnection(&quot;jdbc:hive2://node-1:10000/db1&quot;, &quot;root&quot;, &quot;&quot;);</span><br><span class="line">        statement = connection.createStatement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询表数据</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void selectTest() throws Exception &#123;</span><br><span class="line">        ResultSet result = statement.executeQuery(&quot;select * from t_log&quot;);</span><br><span class="line">        System.out.println(&quot;-----------------------------------------------------&quot;);</span><br><span class="line">        System.out.println(&quot;id\tip\turl\ttime&quot;);</span><br><span class="line">        System.out.println(&quot;-----------------------------------------------------&quot;);</span><br><span class="line">        while (result.next()) &#123;</span><br><span class="line">            int id = result.getInt(1);</span><br><span class="line">            String ip = result.getString(2);</span><br><span class="line">            String url = result.getString(3);</span><br><span class="line">            String time = result.getString(4);</span><br><span class="line">            System.out.println(&quot;|&quot; + id + &quot;\t&quot; + ip + &quot;\t&quot; + url + &quot;\t&quot; + time + &quot;|&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;-----------------------------------------------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建表</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void dropTableTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;drop table if exists t_log&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除数据库</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void dropDatabaseTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;drop database if exists db1&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建表</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void createTableTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;create table t_log(id int, ip string, url string, time string)&quot; +</span><br><span class="line">                &quot; row format delimited fields terminated by &apos;,&apos;&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有表</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void showTablesTest() throws Exception &#123;</span><br><span class="line">        ResultSet resultSet = statement.executeQuery(&quot;show tables&quot;);</span><br><span class="line">        while (resultSet.next()) &#123;</span><br><span class="line">            System.out.println(resultSet.getString(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载数据</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void loadDataTest() throws Exception &#123;</span><br><span class="line">        String filePath = &quot;/root/app.log&quot;;</span><br><span class="line"></span><br><span class="line">        String sql = &quot;load data local inpath &apos;&quot; + filePath + &quot;&apos; overwrite into table t_log&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 统计查询（会运行 mapReduce 作业）</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void countDataTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;select count(1) from t_log&quot;;</span><br><span class="line">        ResultSet resultSet = statement.executeQuery(sql);</span><br><span class="line">        while (resultSet.next()) &#123;</span><br><span class="line">            System.out.println(resultSet.getInt(1));</span><br><span class="line">        &#125;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/Hive/" data-id="cjrqbftyz000xakc4i3c71c3m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/04/Crontab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/CentOS-7.5-init/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/bash/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/awk/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/后台项目技术规范/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>