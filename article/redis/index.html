<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          Redis - leone | Blog
        
    </title>

    <link rel="canonical" href="http://www.wealip.cn/article/redis/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_header.png')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#数据库" title="数据库">数据库</a>
                            
                              <a class="tag" href="/tags/#redis" title="redis">redis</a>
                            
                              <a class="tag" href="/tags/#缓存" title="缓存">缓存</a>
                            
                        </div>
                        <h1>Redis</h1>
                        <h2 class="subheading">Redis 简介及原理入门实战</h2>
                        <span class="meta">
                            Posted by leone on
                            2018-08-09
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">leone</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="redis">Redis</span></h1>
<h2><span id="redis简介及原理">Redis简介及原理</span></h2>
<h3><span id="什么是redis">什么是redis</span></h3>
<p>Redis是由意大利人Salvatore Sanfilippo开发的一款内存高速缓存数据库。Redis本质上是一种键值数据库，但是它在保持键值数据库简单快捷特点的同时，又吸收了部分关系型数库的优点。从而使它的位置处于关系数据库和键值数据库之间。Redis不仅能保存String类型的数据，还能保持lists类型（有序）和Sets类型（无序）的数据，而且还能完成排序（sort）等高级功能，在实现INCR，SETNX等功能的时候，保证了其操作的原子性，除此之外，还支持主从复制功能。</p>
<p>Redis是一款开源的、高性能的键-值存储（key-value store）。它常被称作是一款数据结构服务器（data structure server）。</p>
<p>Redis的键值可以包括字符串（strings）类型，同时它还包括哈希（hashes）、列表（lists）、集合（sets）和 有序集合（sorted sets）等数据类型。 对于这些数据类型，你可以执行原子操作。例如：对字符串进行附加操作（append）；递增哈希中的值；向列表中增加元素；计算集合的交集、并集与差集等。</p>
<p>为了获得优异的性能，Redis采用了内存中（in-memory）数据集（dataset）的方式。同时，Redis支持数据的持久化，你可以每隔一段时间将数据集转存到磁盘上（snapshot），或者在日志尾部追加每一条操作命令（append only file,aof）。</p>
<p>Redis同样支持主从复制（master-slave replication），并且具有非常快速的非阻塞首次同步（ non-blocking first synchronization）、网络断开自动重连等功能。同时Redis还具有其它一些特性，其中包括简单的事物支持、发布订阅 （ pub/sub）、管道（pipeline）和虚拟内存（vm）等 。<br>
Redis具有丰富的客户端，支持现阶段流行的大多数编程语言。</p>
<h3><span id="nosql数据库">NoSQL数据库</span></h3>
<p>在过去几年中，NoSQL数据库一度成为高并发、海量数据存储解决方案的代名词，与之相应的产品也如同雨后春笋般出现，然而在众多产品中，能够脱颖而出的却　　屈指可数，如Redis、MongoDB、BerkeleyDB和CouchDB等。由于每种产品所拥有的特性不同，因此它们的应用场景也存在着一定差异。</p>
<p>BerkeleyDB是一种极为流行的开源嵌入式数据库，在更多情况下可用于存储引擎，比如BerlkeyDB再被Oracle收购之前曾作为MySQL的存储引擎，由此可见，该产品拥有极好的并发伸缩性，支持事物及嵌套事物，海量数据存储等重要特性，在用于存储实时数据方面具有极高的可用价值。</p>
<p>MongDB定义为Oriented-Document数据库服务器，和BerkeleyDB不同的是，该数据库可以像其他关系型数据库服务器那样独立的运行并提供相关的数据服务。MongoDB主要适用于论坛或博客等类型的网站，这些网站具有并发访问量高、多读少些、数据量大、逻辑关系简单、以文档数据作为主要数据源等特点，适合用MongoDB提供数据服务。</p>
<p>Memcahced，数据缓存服务器。在使用方式上，它和Redis最为相似，它们之间最大的区别是，memcached只是提供了数据缓存服务，而没有提供任何形式的数据持久化功能，而Redis则提供了这样的功能。一旦Memcached服务器宕机，之前在内存中缓存的数据也将全部消失。再有就是，Redis提供了更为丰富的数据存储结构</p>
<p>Redis，典型的NoSQL数据库服务器。与BerkeleyDB相比，它可以作为服务程序独立运行于自己的服务器主机。Redis除了Key/Value之外还支持List、Hash、Set和Ordered Set等数据结构，因此它的用途也更广泛。</p>
<h3><span id="redis特点">redis特点</span></h3>
<ul>
<li>
<p>速度快，因为数据存在内存中，类似于HashMap，HashMap的优势就是查找和操作的时间复杂度都是O(1)。Redis用c语言编写，以内存作为数据存储介质，所以读写数据的效率极高，以设置和获取一个256字节字符串为例，它的读取速度可高达110000次/s，写速度高达81000次/s。</p>
</li>
<li>
<p>支持丰富数据类型：string（字符串），hash（哈希），list（列表），set（集合）及zset(sorted set：有序集合)。</p>
</li>
<li>
<p>支持事务：Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</p>
</li>
<li>
<p>丰富的特性：可用于缓存，消息，按key设置过期时间，过期后将会自动删除</p>
</li>
<li>
<p>Redis支持主从模式：可以配置集群，这样更利于支撑大型的项目</p>
</li>
<li>
<p>丰富的特性： Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p>
</li>
<li>
<p>存储在Redis中的数据是持久化的，断电或重启后，数据也不会丢失。因为Redis的存储分为内存存储、硬盘存储和log文件三部分。重启后，Redis可以从磁盘重新将数据加载到内存中，保证数据不会丢失</p>
</li>
</ul>
<h2><span id="redis安装">Redis安装</span></h2>
<p>下载安装redis</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://download.redis.io/releases/redis-5.0.3.tar.gz</span><br><span class="line"></span><br><span class="line">$ tar -zxvf redis-5.0.3.tar.gz</span><br><span class="line"></span><br><span class="line">$ cd redis-5.0.3</span><br><span class="line"></span><br><span class="line">$ make </span><br><span class="line"></span><br><span class="line">$ cd src</span><br><span class="line"></span><br><span class="line">$ make test</span><br><span class="line"></span><br><span class="line"># make test 报错 You need tcl 8.5 or newer in order to run the Redis test</span><br><span class="line">$ yum install tcl</span><br><span class="line"></span><br><span class="line">$ make install PREFIX=/usr/local/redis</span><br><span class="line"></span><br><span class="line"># 拷贝redis的配置文件到etc目录</span><br><span class="line">cp redis.conf /etc/redis/6379.conf</span><br><span class="line"></span><br><span class="line"># 拷贝redis启动脚本到系统服务目录</span><br><span class="line">$ cp utils/redis_init_script /etc/init.d/redis</span><br><span class="line"></span><br><span class="line"># 修改redis启动脚本把这两行修改为你安装redis的路下的文件</span><br><span class="line">$ vim /etc/init.d/redis</span><br><span class="line"></span><br><span class="line">EXEC=/usr/local/redis/bin/redis-server</span><br><span class="line">CLIEXEC=/usr/local/redis/bin/redis-cli</span><br><span class="line"></span><br><span class="line"># 启动redis</span><br><span class="line">$ service redis start</span><br><span class="line"></span><br><span class="line"># 如果发现redis启动成功但是无法使用客户端远程连接需要修改redis的配置文件</span><br><span class="line">`bind 127.0.0.1`改为`bind 0.0.0.0`</span><br></pre></td></tr></table></figure>
<h2><span id="redis-配置详解">Redis 配置详解</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"># Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"># 当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis_6379.pid文件，可以通过pidfile指定</span><br><span class="line">pidfile /var/run/redis_$&#123;REDISPORT&#125;.pid</span><br><span class="line"></span><br><span class="line"># 指定Redis监听端口，默认端口为6379，作者在自己的一篇博文中解释了为什么选用6379作为默认端口，因为6379在手机按键上MERZ对应的号码，而MERZ取自意大利歌女Alessia Merz的名字</span><br><span class="line">port 6379</span><br><span class="line"></span><br><span class="line"># 绑定的主机地址</span><br><span class="line">bind 127.0.0.1</span><br><span class="line"></span><br><span class="line"># 当 客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能</span><br><span class="line">timeout 300</span><br><span class="line"></span><br><span class="line"># 指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</span><br><span class="line">loglevel verbose</span><br><span class="line"></span><br><span class="line"># 日志记录方式，默认为标准输出，如果配置Redis为守护进程方式运行，而这里又配置为日志记录方式为标准输出，则日志将会发送给/dev/null</span><br><span class="line">logfile stdout</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 设置数据库的数量，默认数据库为0，可以使用SELECT &lt;dbid&gt;命令在连接上指定数据库id</span><br><span class="line">databases 16</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span><br><span class="line"></span><br><span class="line">save &lt;seconds&gt; &lt;changes&gt;</span><br><span class="line">Redis 默认配置文件中提供了三个条件：</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line"></span><br><span class="line">分别表示900秒（15分钟）内有1个更改，300秒（5分钟）内有10个更改以及60秒内有10000个更改。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大 </span><br><span class="line">rdbcompression yes</span><br><span class="line"></span><br><span class="line"># 指定本地数据库文件名，默认值为dump.rdb</span><br><span class="line">dbfilename dump.rdb</span><br><span class="line"></span><br><span class="line"># 指定本地数据库存放目录</span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line"># 设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</span><br><span class="line">slaveof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line"></span><br><span class="line"># 当master服务设置了密码保护时，slav服务连接master的密码</span><br><span class="line">masterauth &lt;master-password&gt;</span><br><span class="line"></span><br><span class="line"># 设置Redis连接密码，如果配置了连接密码，客户端在连接Redis时需要通过AUTH &lt;password&gt;命令提供密码，默认关闭</span><br><span class="line">requirepass foobared</span><br><span class="line"></span><br><span class="line"># 设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，如果设置 maxclients 0，表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息</span><br><span class="line">maxclients 128</span><br><span class="line"></span><br><span class="line"># 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key，当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区</span><br><span class="line">maxmemory &lt;bytes&gt;</span><br><span class="line"></span><br><span class="line"># 指定是否在每次更新操作后进行日志记录，Redis在默认情况下是异步的把数据写入磁盘，如果不开启，可能会在断电时导致一段时间内的数据丢失。因为 redis本身同步数据文件是按上面save条件来同步的，所以有的数据会在一段时间内只存在于内存中。默认为no</span><br><span class="line">appendonly no</span><br><span class="line"></span><br><span class="line"># 指定更新日志文件名，默认为appendonly.aof</span><br><span class="line">appendfilename appendonly.aof</span><br><span class="line"></span><br><span class="line"># 指定更新日志条件，共有3个可选值 no：表示等操作系统进行数据缓存同步到磁盘（快）always：表示每次更新操作后手动调用fsync()将数据写到磁盘（慢，安全everysec：表示每秒同步一次（折衷，默认值）</span><br><span class="line">appendfsync everysec</span><br><span class="line"></span><br><span class="line"># 指定是否启用虚拟内存机制，默认值为no，简单的介绍一下，VM机制将数据分页存放，由Redis将访问量较少的页即冷数据swap到磁盘上，访问多的页面由磁盘自动换出到内存中（在后面的文章我会仔细分析Redis的VM机制）</span><br><span class="line">vm-enabled no</span><br><span class="line"></span><br><span class="line"># 虚拟内存文件路径，默认值为/tmp/redis.swap，不可多个Redis实例共享</span><br><span class="line">vm-swap-file /tmp/redis.swap</span><br><span class="line"></span><br><span class="line"># 将所有大于vm-max-memory的数据存入虚拟内存,无论vm-max-memory设置多小,所有索引数据都是内存存储的(Redis的索引数据 就是keys),也就是说,当vm-max-memory设置为0的时候,其实是所有value都存在于磁盘。默认值为0</span><br><span class="line">vm-max-memory 0</span><br><span class="line"></span><br><span class="line"># Redis swap文件分成了很多的page，一个对象可以保存在多个page上面，但一个page上不能被多个对象共享，vm-page-size是要根据存储的 数据大小来设定的，作者建议如果存储很多小对象，page大小最好设置为32或者64bytes；如果存储很大大对象，则可以使用更大的page，如果不 确定，就使用默认值</span><br><span class="line">vm-page-size 32</span><br><span class="line"></span><br><span class="line"># 设置swap文件中的page数量，由于页表（一种表示页面空闲或使用的bitmap）是在放在内存中的，，在磁盘上每8个pages将消耗1byte的内存。</span><br><span class="line">vm-pages 134217728</span><br><span class="line"></span><br><span class="line"># 设置访问swap文件的线程数,最好不要超过机器的核数,如果设置为0,那么所有对swap文件的操作都是串行的，可能会造成比较长时间的延迟。默认值为4</span><br><span class="line">vm-max-threads 4</span><br><span class="line"></span><br><span class="line"># 设置在向客户端应答时，是否把较小的包合并为一个包发送，默认为开启</span><br><span class="line">glueoutputbuf yes</span><br><span class="line"></span><br><span class="line"># 指定在超过一定的数量或者最大的元素超过某一临界值时，采用一种特殊的哈希算法</span><br><span class="line">hash-max-zipmap-entries 64</span><br><span class="line">hash-max-zipmap-value 512</span><br><span class="line"></span><br><span class="line"># 指定是否激活重置哈希，默认为开启</span><br><span class="line">activerehashing yes</span><br><span class="line"></span><br><span class="line"># 指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</span><br><span class="line">include /path/to/local.conf</span><br></pre></td></tr></table></figure>
<h2><span id="redis数据类型">Redis数据类型</span></h2>
<ul>
<li>String</li>
</ul>
<p>Strings 数据结构是简单的key-value类型，value其实不仅是String，也可以是数字.<br>
常用命令:  set,get,decr,incr,mget 等。</p>
<p>应用场景：String是最常用的一种数据类型，普通的key/ value 存储都可以归为此类.即可以完全实现目前 Memcached 的功能，并且效率更高。还可以享受Redis的定时持久化，操作日志及 Replication等功能。</p>
<ul>
<li>Hash</li>
</ul>
<p>常用命令：hget,hset,hgetall 等。</p>
<p>应用场景：在Memcached中，我们经常将一些结构化的信息打包成HashMap，在客户端序列化后存储为一个字符串的值，比如用户的昵称、年龄、性别、积分等，这时候在需要修改其中某一项时，通常需要将所有值取出反序列化后，修改某一项的值，再序列化存储回去。这样不仅增大了开销，也不适用于一些可能并发操作的场合（比如两个并发的操作都需要修改积分）。而Redis的Hash结构可以使你像在数据库中Update一个属性一样只修改某一项属性值。我们简单举个实例来描述下Hash的应用场景，比如我们要存储一个用户信息对象数据，包含以下信息：用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息，</p>
<ul>
<li>List</li>
</ul>
<p>常用命令：lpush,rpush,lpop,rpop,lrange等。</p>
<p>应用场景：Redis list的应用场景非常多，也是Redis最重要的数据结构之一，比如twitter的关注列表，粉丝列表等都可以用Redis的list结构来实现。Lists 就是链表，相信略有数据结构知识的人都应该能理解其结构。使用Lists结构，我们可以轻松地实现最新消息排行等功能。Lists的另一个应用就是消息队列，<br>
可以利用Lists的PUSH操作，将任务存在Lists中，然后工作线程再用POP操作将任务取出进行执行。Redis还提供了操作Lists中某一段的api，你可以直接查询，删除Lists中某一段的元素。</p>
<ul>
<li>Set</li>
</ul>
<p>常用命令：sadd,spop,smembers,sunion 等。</p>
<p>应用场景：Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</p>
<p>Sets 集合的概念就是一堆不重复值的组合。利用Redis提供的Sets数据结构，可以存储一些集合性的数据，比如在微博应用中，可以将一个用户所有的关注人存在一个集合中，将其所有粉丝存在一个集合。Redis还为集合提供了求交集、并集、差集等操作，可以非常方便的实现如共同关注、共同喜好、二度好友等功能，对上面的所有集合操作，你还可以使用不同的命令选择将结果返回给客户端还是存集到一个新的集合中。</p>
<ul>
<li>Sorted Set</li>
</ul>
<p>常用命令：zadd,zrange,zrem,zcard等</p>
<p>使用场景：Redis sorted set的使用场景与set类似，区别是set不是自动有序的，而sorted set可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。当你需要一个有序的并且不重复的集合列表，那么可以选择sorted set数据结构，比如twitter 的public timeline可以以发表时间作为score来存储，这样获取时就是自动按时间排好序的。</p>
<p>另外还可以用Sorted Sets来做带权重的队列，比如普通消息的score为1，重要消息的score为2，然后工作线程可以选择按score的倒序来获取工作任务。让重要的任务优先执行。</p>
<h2><span id="redis的持久化方式rdb和aof">Redis的持久化方式RDB和AOF</span></h2>
<p><strong>二者的区别</strong></p>
<p>RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是fork一个子进程，先将数据集写入临时文件，写入成功后，再替换之前的文件，用二进制压缩存储。</p>
<p>AOF持久化以日志的形式记录服务器所处理的每一个写、删除操作，查询操作不会记录，以文本的方式记录，可以打开文件看到详细的操作记录。</p>
<p><strong>二者优缺点</strong></p>
<p>RDB存在哪些优势呢？<br>
1). 一旦采用该方式，那么你的整个Redis数据库将只包含一个文件，这对于文件备份而言是非常完美的。比如，你可能打算每个小时归档一次最近24小时的数据，同时还要每天归档一次最近30天的数据。通过这样的备份策略，一旦系统出现灾难性故障，我们可以非常容易的进行恢复。</p>
<p>2). 对于灾难恢复而言，RDB是非常不错的选择。因为我们可以非常轻松的将一个单独的文件压缩后再转移到其它存储介质上。</p>
<p>3). 性能最大化。对于Redis的服务进程而言，在开始持久化时，它唯一需要做的只是fork出子进程，之后再由子进程完成这些持久化的工作，这样就可以极大的避免服务进程执行IO操作了。</p>
<p>4). 相比于AOF机制，如果数据集很大，RDB的启动效率会更高。</p>
<p>RDB又存在哪些劣势呢？</p>
<p>1). 如果你想保证数据的高可用性，即最大限度的避免数据丢失，那么RDB将不是一个很好的选择。因为系统一旦在定时持久化之前出现宕机现象，此前没有来得及写入磁盘的数据都将丢失。</p>
<p>2). 由于RDB是通过fork子进程来协助完成数据持久化工作的，因此，如果当数据集较大时，可能会导致整个服务器停止服务几百毫秒，甚至是1秒钟。</p>
<p>AOF的优势有哪些呢？<br>
1). 该机制可以带来更高的数据安全性，即数据持久性。Redis中提供了3中同步策略，即每秒同步、每修改同步和不同步。事实上，每秒同步也是异步完成的，其效率也是非常高的，所差的是一旦系统出现宕机现象，那么这一秒钟之内修改的数据将会丢失。而每修改同步，我们可以将其视为同步持久化，即每次发生的数据变化都会被立即记录到磁盘中。可以预见，这种方式在效率上是最低的。至于无同步，无需多言，我想大家都能正确的理解它。</p>
<p>2). 由于该机制对日志文件的写入操作采用的是append模式，因此在写入过程中即使出现宕机现象，也不会破坏日志文件中已经存在的内容。然而如果我们本次操作只是写入了一半数据就出现了系统崩溃问题，不用担心，在Redis下一次启动之前，我们可以通过redis-check-aof工具来帮助我们解决数据一致性的问题。</p>
<p>3). 如果日志过大，Redis可以自动启用rewrite机制。即Redis以append模式不断的将修改数据写入到老的磁盘文件中，同时Redis还会创建一个新的文件用于记录此期间有哪些修改命令被执行。因此在进行rewrite切换时可以更好的保证数据安全性。</p>
<p>4). AOF包含一个格式清晰、易于理解的日志文件用于记录所有的修改操作。事实上，我们也可以通过该文件完成数据的重建。</p>
<p>AOF的劣势有哪些呢？</p>
<p>1). 对于相同数量的数据集而言，AOF文件通常要大于RDB文件。RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。</p>
<p>2). 根据同步策略的不同，AOF在运行效率上往往会慢于RDB。总之，每秒同步策略的效率是比较高的，同步禁用策略的效率和RDB一样高效。</p>
<p>二者选择的标准，就是看系统是愿意牺牲一些性能，换取更高的缓存一致性（aof），还是愿意写操作频繁的时候，不启用备份来换取更高的性能，待手动运行save的时候，再做备份（rdb）。rdb这个就更有些 eventually consistent的意思了。</p>
<p><strong>Redis持久化常用配置</strong></p>
<p>RDB持久化配置</p>
<p>Redis会将数据集的快照dump到dump.rdb文件中。此外，我们也可以通过配置文件来修改Redis服务器dump快照的频率，在打开6379.conf文件之后，我们搜索save，可以看到下面的配置信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># RDB持久化配置</span><br><span class="line"></span><br><span class="line">save 900 1             #在900秒(15分钟)之后，如果至少有1个key发生变化，则dump内存快照。</span><br><span class="line"></span><br><span class="line">save 300 10            #在300秒(5分钟)之后，如果至少有10个key发生变化，则dump内存快照。</span><br><span class="line"></span><br><span class="line">save 60 10000          #在60秒(1分钟)之后，如果至少有10000个key发生变化，则dump内存快照。</span><br><span class="line"></span><br><span class="line"># AOF持久化配置,在Redis的配置文件中存在三种同步方式，它们分别是：</span><br><span class="line"></span><br><span class="line">appendfsync always     #每次有数据修改发生时都会写入AOF文件。</span><br><span class="line"></span><br><span class="line">appendfsync everysec   #每秒钟同步一次，该策略为AOF的缺省策略。</span><br><span class="line"></span><br><span class="line">appendfsync no          #从不同步。高效但是数据不会被持久化。</span><br></pre></td></tr></table></figure>
<h2><span id="主从复制">主从复制</span></h2>
<p><strong>机器规划</strong></p>
<p>需要准备三台安装好redis linux服务器我这里用的是CentOS7.5</p>
<p>192.168.79.15    master<br>
192.168.79.16    slave1<br>
192.168.79.17    slave1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 编辑salve1、slave2 的配置文件</span><br><span class="line"></span><br><span class="line">$ vim /etc/redis/6379.conf</span><br><span class="line"></span><br><span class="line"># 添加如下配置(新版本的redis 使用 replicaof 代替了 slaveof)</span><br><span class="line">replicaof 192.168.79.15 6379</span><br><span class="line"></span><br><span class="line"># 配置完成后启动redis集群,查看redis的角色</span><br><span class="line"></span><br><span class="line">&gt; info replication</span><br><span class="line"></span><br><span class="line"># 模拟主节点挂掉后，手动将slave1子节点升级为Master</span><br><span class="line"># 在 master redis 客户端执行</span><br><span class="line">&gt; shutdown</span><br><span class="line"></span><br><span class="line"># 在是 slave redis 客户度执行</span><br><span class="line">&gt; slaveof no one</span><br></pre></td></tr></table></figure>
<h2><span id="redis哨兵sentinel模式">Redis哨兵（Sentinel）模式</span></h2>
<p><strong>哨兵模式概述</strong></p>
<p>Sentinel(哨兵)进程是用于监控redis集群中Master主服务器工作的状态，在Master主服务器发生故障的时候，可以实现Master和Slave服务器的切换，保证系统的高可用，其已经被集成在redis2.6+的版本中，Redis的哨兵模式到了2.8版本之后就稳定了下来。一般在生产环境也建议使用Redis的2.8版本的以后版本。哨兵(Sentinel) 是一个分布式系统，你可以在一个架构中运行多个哨兵(sentinel) 进程，这些进程使用流言协议(gossipprotocols)来接收关于Master主服务器是否下线的信息，并使用投票协议(Agreement Protocols)来决定是否执行自动故障迁移,以及选择哪个Slave作为新的Master。每个哨兵(Sentinel)进程会向其它哨兵(Sentinel)、Master、Slave定时发送消息，以确认对方是否”活”着，如果发现对方在指定配置时间(可配置的)内未得到回应，则暂时认为对方已掉线，也就是所谓的”主观认为宕机” ，英文名称：Subjective Down，简称SDOWN。有主观宕机，肯定就有客观宕机。当“哨兵群”中的多数Sentinel进程在对Master主服务器做出 SDOWN 的判断，并且通过 SENTINEL is-master-down-by-addr 命令互相交流之后，得出的Master Server下线判断，这种方式就是“客观宕机”，英文名称是：Objectively Down， 简称 ODOWN。通过一定的vote算法，从剩下的slave从服务器节点中，选一台提升为Master服务器节点，然后自动修改相关配置，并开启故障转移（failover）。</p>
<p>哨兵(sentinel) 虽然有一个单独的可执行文件 redis-sentinel ,但实际上它只是一个运行在特殊模式下的 Redis 服务器，你可以在启动一个普通 Redis 服务器时通过给定 --sentinel 选项来启动哨兵(sentinel)，哨兵(sentinel) 的一些设计思路和zookeeper非常类似。</p>
<p>Sentinel集群之间会互相通信，沟通交流redis节点的状态，做出相应的判断并进行处理，这里的主观下线状态和客观下线状态是比较重要的状态，它们决定了是否进行故障转移，可以 通过订阅指定的频道信息，当服务器出现故障得时候通知管理员，客户端可以将 Sentinel 看作是一个只提供了订阅功能的 Redis 服务器，你不可以使用 PUBLISH 命令向这个服务器发送信息，但你可以用 SUBSCRIBE 命令或者 PSUBSCRIBE 命令， 通过订阅给定的频道来获取相应的事件提醒。一个频道能够接收和这个频道的名字相同的事件。 比如说， 名为 +sdown 的频道就可以接收所有实例进入主观下线（SDOWN）状态的事件。</p>
<p><strong>Sentinel（哨兵）进程的作用：</strong></p>
<p>1.监控(Monitoring): 哨兵(sentinel) 会不断地检查你的Master和Slave是否运作正常。</p>
<p>2.提醒(Notification)：当被监控的某个Redis节点出现问题时, 哨兵(sentinel) 可以通过 API 向管理员或者其他应用程序发送通知。</p>
<p>3.自动故障迁移(Automatic failover)：当一个Master不能正常工作时，哨兵(sentinel) 会开始一次自动故障迁移操作，它会将失效Master的其中一个Slave升级为新的Master, 并让失效Master的其他Slave改为复制新的Master；当客户端试图连接失效的Master时，集群也会向客户端返回新Master的地址，使得集群可以使用现在的Master替换失效Master。Master和Slave服务器切换后，Master的redis.conf、Slave的redis.conf和sentinel.conf的配置文件的内容都会发生相应的改变，即，Master主服务器的redis.conf配置文件中会多一行slaveof的配置，sentinel.conf的监控目标会随之调换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 拷贝redis解压目录中的哨兵(sentinel.conf)配置文件</span><br><span class="line">$ cp sentinel.conf /etc/redis</span><br><span class="line"></span><br><span class="line"># 主要修改一下配置文件其他默认即可</span><br><span class="line"></span><br><span class="line"># 哨兵进程的端口</span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"># 后台运行</span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"># 监听的节点</span><br><span class="line">sentinel monitor mymaster 192.168.79.15 6379 1</span><br><span class="line"></span><br><span class="line"># 哨兵的日志文件</span><br><span class="line">logfile &quot;/export/logs/redis/sentinel.log&quot;</span><br><span class="line"></span><br><span class="line"># redis 的密码</span><br><span class="line">sentinel auth-pass mymaster &quot;123456&quot;</span><br></pre></td></tr></table></figure>
<p><strong>redis 哨兵模式java客户端调用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt; redis 哨兵集群</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2019-01-29</span><br><span class="line"> **/</span><br><span class="line">public class RedisSentinelTest &#123;</span><br><span class="line"></span><br><span class="line">    @SuppressWarnings(&quot;deprecation&quot;)</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        Set&lt;String&gt; sentinels = new HashSet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        sentinels.add(&quot;192.168.79.15:26379&quot;);</span><br><span class="line">        sentinels.add(&quot;192.168.79.16:26379&quot;);</span><br><span class="line">        sentinels.add(&quot;192.168.79.17:26379&quot;);</span><br><span class="line"></span><br><span class="line">        String clusterName = &quot;mymaster&quot;;</span><br><span class="line">        String password = &quot;123456&quot;;</span><br><span class="line"></span><br><span class="line">        JedisSentinelPool redisSentinelPool = new JedisSentinelPool(clusterName, sentinels, password);</span><br><span class="line"></span><br><span class="line">        Jedis jedis = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            jedis = redisSentinelPool.getResource();</span><br><span class="line">            jedis.set(&quot;k10&quot;, &quot;v10&quot;);</span><br><span class="line">            System.out.println(jedis.get(&quot;k10&quot;));</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            redisSentinelPool.returnBrokenResource(jedis);</span><br><span class="line">        &#125;</span><br><span class="line">        redisSentinelPool.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="发布订阅pubsub">发布订阅(pub/sub)</span></h2>
<p>特性介绍：</p>
<p>什么是redis的发布订阅（pub/sub）? Pub/Sub功能（means Publish, Subscribe）即发布及订阅功能。基于事件的系统中，Pub/Sub是目前广泛使用的通信模型，它采用事件作为基本的通信机制，提供大规模系统所要求的松散耦合的交互模式：订阅者(如客户端)以事件订阅的方式表达出它有兴趣接收的一个事件或一类事件；发布者(如服务器)可将订阅者感兴趣的事件随时通知相关订阅者。熟悉设计模式的朋友应该了解这与23种设计模式中的观察者模式极为相似。</p>
<p>同样,Redis的pub/sub是一种消息通信模式，主要的目的是解除消息发布者和消息订阅者之间的耦合,  Redis作为一个pub/sub的server, 在订阅者和发布者之间起到了消息路由的功能。</p>
<p>简单来讲，这里面还有个channel的概念，这里就是频道的意思，比如你订阅了银行的频道，当你的资金发生变动时，银行就会通过它的频道给你发送信息，在这里，你是属于被动接收的，而不是向银行索要信息，这个例子中，你就是sub（订阅者），而银行就是pub（发布者）。</p>
<h3><span id="代码示例">代码示例</span></h3>
<ul>
<li>Subscriber.java</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import redis.clients.jedis.JedisPubSub;</span><br><span class="line"></span><br><span class="line">public class Subscriber extends JedisPubSub &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 收到消息会调用</span><br><span class="line">     *</span><br><span class="line">     * @param channel</span><br><span class="line">     * @param message</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String channel, String message) &#123;</span><br><span class="line">        System.out.println(String.format(&quot;receive redis published message, channel: %s, message: %s&quot;, channel, message));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 订阅了频道会调用</span><br><span class="line">     *</span><br><span class="line">     * @param channel</span><br><span class="line">     * @param subscribedChannels</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void onSubscribe(String channel, int subscribedChannels) &#123;</span><br><span class="line">        System.out.println(String.format(&quot;subscribe redis channel success, channel: %s, subscribedChannels: %d&quot;, channel, subscribedChannels));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 取消订阅 会调用</span><br><span class="line">     *</span><br><span class="line">     * @param channel</span><br><span class="line">     * @param subscribedChannels</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    public void onUnsubscribe(String channel, int subscribedChannels) &#123;</span><br><span class="line">        System.out.println(String.format(&quot;unsubscribe redis channel, channel: %s, subscribedChannels: %d&quot;, channel, subscribedChannels));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>SubThread.java</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line">public class SubThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">    private final JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    private final Subscriber subscriber = new Subscriber();</span><br><span class="line"></span><br><span class="line">    private final String channel = &quot;channel1&quot;;</span><br><span class="line"></span><br><span class="line">    public SubThread(JedisPool jedisPool) &#123;</span><br><span class="line">        super(&quot;SubThread&quot;);</span><br><span class="line">        this.jedisPool = jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(String.format(&quot;subscribe redis, channel %s, thread will be blocked&quot;, channel));</span><br><span class="line">        Jedis jedis = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 取出一个连接</span><br><span class="line">            jedis = jedisPool.getResource();</span><br><span class="line">            // 通过subscribe 的api去订阅，入参是订阅者和频道名</span><br><span class="line">            jedis.subscribe(subscriber, channel);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            System.out.println(String.format(&quot;subscribe channel error, %s&quot;, e));</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Publisher.java</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import redis.clients.jedis.Jedis;</span><br><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line"></span><br><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line">public class Publisher extends Thread &#123;</span><br><span class="line"></span><br><span class="line">    private final JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    public Publisher(JedisPool jedisPool) &#123;</span><br><span class="line">        this.jedisPool = jedisPool;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        BufferedReader reader = new BufferedReader(new InputStreamReader(System.in));</span><br><span class="line">        // 连接池中取出一个连接</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            String line;</span><br><span class="line">            try &#123;</span><br><span class="line">                line = reader.readLine();</span><br><span class="line">                if (!&quot;quit&quot;.equals(line)) &#123;</span><br><span class="line">                    // 从 channel1 的频道上推送消息</span><br><span class="line">                    jedis.publish(&quot;channel1&quot;, line);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>RedisPubSubTest.java</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import redis.clients.jedis.JedisPool;</span><br><span class="line">import redis.clients.jedis.JedisPoolConfig;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2019-01-29</span><br><span class="line"> **/</span><br><span class="line">public class RedisPubSubTest &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 连接池配置对象 (config, host + port + timeout + password + db)</span><br><span class="line">        JedisPool jedisPool = new JedisPool(new JedisPoolConfig(), &quot;192.168.79.17&quot;, 6379, 5000, &quot;123456&quot;, 1);</span><br><span class="line"></span><br><span class="line">        System.out.println(String.format(&quot;redis pool is starting, redis ip %s, redis port %d&quot;, &quot;127.0.0.1&quot;, 6379));</span><br><span class="line"></span><br><span class="line">        // 订阅者</span><br><span class="line">        SubThread subThread = new SubThread(jedisPool);</span><br><span class="line">        subThread.start();</span><br><span class="line"></span><br><span class="line">        // 发布者</span><br><span class="line">        Publisher publisher = new Publisher(jedisPool);</span><br><span class="line">        publisher.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="redis-javaapi">Redis javaAPI</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br></pre></td><td class="code"><pre><span class="line">import org.junit.Test;</span><br><span class="line">import redis.clients.jedis.*;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-12-19</span><br><span class="line"> **/</span><br><span class="line">public class RedisClient &#123;</span><br><span class="line"></span><br><span class="line">    private static final String HOST = &quot;127.0.0.1&quot;;</span><br><span class="line"></span><br><span class="line">    private static final Integer PORT = 6379;</span><br><span class="line"></span><br><span class="line">    private static final Integer TIME_OUT = 15000;</span><br><span class="line"></span><br><span class="line">    private static Jedis jedis;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static final JedisPool jedisPool;</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        JedisPoolConfig config = new JedisPoolConfig();</span><br><span class="line">        // 最大连接数</span><br><span class="line">        config.setMaxTotal(32);</span><br><span class="line">        // 闲置最大连接数</span><br><span class="line">        config.setMaxIdle(6);</span><br><span class="line">        // 闲置最小连接数</span><br><span class="line">        config.setMinIdle(0);</span><br><span class="line">        // 到达最大连接数后，调用者阻塞时间</span><br><span class="line">        config.setMaxWaitMillis(15000);</span><br><span class="line">        // 连接空闲的最小时间，可能被移除</span><br><span class="line">        config.setMinEvictableIdleTimeMillis(300000);</span><br><span class="line">        // 连接空闲的最小时间，多余最小闲置连接的将被移除</span><br><span class="line">        config.setSoftMinEvictableIdleTimeMillis(-1);</span><br><span class="line">        // 设置每次检查闲置的个数</span><br><span class="line">        config.setNumTestsPerEvictionRun(3);</span><br><span class="line">        // 申请连接时，是否检查连接有效</span><br><span class="line">        config.setTestOnBorrow(false);</span><br><span class="line">        // 返回连接时，是否检查连接有效</span><br><span class="line">        config.setTestOnReturn(false);</span><br><span class="line">        // 空闲超时,是否执行检查有效</span><br><span class="line">        config.setTestWhileIdle(false);</span><br><span class="line">        // 空闲检查时间</span><br><span class="line">        config.setTimeBetweenEvictionRunsMillis(60000);</span><br><span class="line">        // 当连接数耗尽，是否阻塞</span><br><span class="line">        config.setBlockWhenExhausted(true);</span><br><span class="line">        // 连接池配置对象 (host + port + timeout + password + db)</span><br><span class="line">        jedisPool = new JedisPool(config, HOST, PORT, TIME_OUT, null, 1);</span><br><span class="line">        jedis = jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * set and get string</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testString() &#123;</span><br><span class="line">        System.out.println(&quot;----------------redis-String-----------------&quot;);</span><br><span class="line">        // set:返回操作结果</span><br><span class="line">        System.out.println(&quot;name=&gt;wsy:&quot; + jedis.set(&quot;name&quot;, &quot;wsy&quot;));</span><br><span class="line"></span><br><span class="line">        // get:value</span><br><span class="line">        System.out.println(&quot;name:&quot; + jedis.get(&quot;name&quot;));</span><br><span class="line"></span><br><span class="line">        // append:字符串长度</span><br><span class="line">        System.out.println(&quot;append:&quot; + jedis.append(&quot;name&quot;, &quot;_ss&quot;));</span><br><span class="line"></span><br><span class="line">        // strLength:字符串长度</span><br><span class="line">        System.out.println(&quot;strLength:&quot; + jedis.strlen(&quot;name&quot;));</span><br><span class="line"></span><br><span class="line">        // getrange:返回不包括起始坐标的值</span><br><span class="line">        System.out.println(&quot;getrange:&quot; + jedis.getrange(&quot;name&quot;, 10, 13));</span><br><span class="line"></span><br><span class="line">        // setrange:从起始坐标考试替换，未替换的保持</span><br><span class="line">        System.out.println(&quot;setRange:&quot; + jedis.setrange(&quot;name&quot;, 10, &quot;#&quot;));</span><br><span class="line"></span><br><span class="line">        // mset:批量设置，返回批量设置结果</span><br><span class="line">        System.out.println(&quot;mset:&quot; + jedis.mset(&quot;name&quot;, &quot;wsy&quot;, &quot;age&quot;, &quot;29&quot;));</span><br><span class="line"></span><br><span class="line">        // mget:返回数组</span><br><span class="line">        System.out.println(&quot;mget:&quot; + jedis.mget(&quot;name&quot;, &quot;age&quot;));</span><br><span class="line"></span><br><span class="line">        // incr:value自增1后，返回value</span><br><span class="line">        System.out.println(&quot;incr:&quot; + jedis.incr(&quot;age&quot;));</span><br><span class="line"></span><br><span class="line">        // incr:value自增传参值后，返回value</span><br><span class="line">        System.out.println(&quot;incrBy:&quot; + jedis.incrBy(&quot;age&quot;, 3));</span><br><span class="line"></span><br><span class="line">        // decr:value自减1，返回value</span><br><span class="line">        System.out.println(&quot;decr:&quot; + jedis.decr(&quot;age&quot;));</span><br><span class="line"></span><br><span class="line">        // decrBy:value自减入参值，返回value</span><br><span class="line">        System.out.println(&quot;decrBy:&quot; + jedis.decrBy(&quot;age&quot;, 3));</span><br><span class="line"></span><br><span class="line">        // setex:设置key值+有效时间，如果key存在则覆盖value</span><br><span class="line">        System.out.println(&quot;setex:&quot; + jedis.setex(&quot;phone&quot;, 10, &quot;13600000001&quot;));</span><br><span class="line"></span><br><span class="line">        // setnx:当key不存在时，设置才成功</span><br><span class="line">        System.out.println(&quot;setnx:&quot; + jedis.setnx(&quot;address&quot;, &quot;china&quot;));</span><br><span class="line"></span><br><span class="line">        // del:删除对应key</span><br><span class="line">        System.out.println(&quot;del:&quot; + jedis.del(&quot;address1&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;----------------redis-String-----------------\n&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * redis中hash类型常用操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testHash() &#123;</span><br><span class="line">        System.out.println(&quot;----------------redis-HashMap-----------------&quot;);</span><br><span class="line">        // hset:返回值为key为新返回1，为旧覆盖旧值返回0</span><br><span class="line">        System.out.println(&quot;hset:&quot; + jedis.hset(&quot;user&quot;, &quot;name&quot;, &quot;wangshaoyi&quot;));</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        map.put(&quot;name&quot;, &quot;wsy&quot;);</span><br><span class="line">        map.put(&quot;age&quot;, &quot;29&quot;);</span><br><span class="line"></span><br><span class="line">        // hmset:map对象</span><br><span class="line">        System.out.println(&quot;hmset:&quot; + jedis.hmset(&quot;user&quot;, map));</span><br><span class="line"></span><br><span class="line">        // hexists:判断hashmap中key是否存在</span><br><span class="line">        System.out.println(&quot;hexists:&quot; + jedis.hexists(&quot;user&quot;, &quot;age&quot;));</span><br><span class="line"></span><br><span class="line">        // hget:获取map中key对应的value</span><br><span class="line">        System.out.println(&quot;hget:&quot; + jedis.hget(&quot;user&quot;, &quot;name&quot;));</span><br><span class="line"></span><br><span class="line">        // hgetAll:获取map中所有对象</span><br><span class="line">        System.out.println(&quot;hgetAll:&quot; + jedis.hgetAll(&quot;user&quot;));</span><br><span class="line"></span><br><span class="line">        // hkeys:获取map中所有key</span><br><span class="line">        System.out.println(&quot;hkeys:&quot; + jedis.hkeys(&quot;user&quot;));</span><br><span class="line"></span><br><span class="line">        // hvals:获取map中所有value</span><br><span class="line">        System.out.println(&quot;hvals:&quot; + jedis.hvals(&quot;user&quot;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // hmget:批量获取keys的对象，返回List</span><br><span class="line">        System.out.println(&quot;hmget:&quot; + jedis.hmget(&quot;user&quot;, &quot;age&quot;, &quot;name&quot;));</span><br><span class="line"></span><br><span class="line">        // hlen:map的大小</span><br><span class="line">        System.out.println(&quot;hlen:&quot; + jedis.hlen(&quot;user&quot;));</span><br><span class="line"></span><br><span class="line">        // hdel:删除map中对应key,正确删除返回1</span><br><span class="line">        System.out.println(&quot;hdel:&quot; + jedis.hdel(&quot;user&quot;, &quot;age0&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;----------------redis-HashMap-----------------\n&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * redis中 list 类型常用操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testList() &#123;</span><br><span class="line">        System.out.println(&quot;----------------redis-List-----------------&quot;);</span><br><span class="line">        jedis.del(&quot;contacts&quot;);</span><br><span class="line">        jedis.del(&quot;contacts_old&quot;);</span><br><span class="line"></span><br><span class="line">        // lpush:批量头部插入，返回List的size</span><br><span class="line">        System.out.println(&quot;lpush:&quot; + jedis.lpush(&quot;contacts&quot;, &quot;xx&quot;, &quot;yy&quot;, &quot;zz&quot;));</span><br><span class="line"></span><br><span class="line">        // lpushx:单个头部插入，返回List的size</span><br><span class="line">        System.out.println(&quot;lpushx:&quot; + jedis.lpushx(&quot;contacts&quot;, &quot;aa&quot;));</span><br><span class="line"></span><br><span class="line">        // linsert:指定对象位置(前or后)插入</span><br><span class="line">        System.out.println(&quot;linsert:&quot; + jedis.linsert(&quot;contacts&quot;, BinaryClient.LIST_POSITION.BEFORE, &quot;zz&quot;, &quot;bb&quot;));</span><br><span class="line"></span><br><span class="line">        // lset:将指定的位置设置值（替换旧值）</span><br><span class="line">        System.out.println(&quot;lset:&quot; + jedis.lset(&quot;contacts&quot;, 2, &quot;cc&quot;));</span><br><span class="line"></span><br><span class="line">        // lpop:链表头的对象</span><br><span class="line">        System.out.println(&quot;lpop:&quot; + jedis.lpop(&quot;contacts&quot;));</span><br><span class="line"></span><br><span class="line">        // lrange:获取list指定start、end位置value</span><br><span class="line">        System.out.println(&quot;lrange:&quot; + jedis.lrange(&quot;contacts&quot;, 1, 3));</span><br><span class="line"></span><br><span class="line">        // ltrim:只剩start\end中list值，其余删除</span><br><span class="line">        System.out.println(&quot;ltrim:&quot; + jedis.ltrim(&quot;contacts&quot;, 1, 3));</span><br><span class="line"></span><br><span class="line">        // lrem:删除list指定值（次数指定），返回删除个数</span><br><span class="line">        System.out.println(&quot;lrem:&quot; + jedis.lrem(&quot;contacts&quot;, 2, &quot;yy&quot;));</span><br><span class="line"></span><br><span class="line">        // rpoplpush:将源list尾部对象移到目标list对象头部</span><br><span class="line">        System.out.println(&quot;rpoplpush:&quot; + jedis.rpoplpush(&quot;contacts&quot;, &quot;contacts_old&quot;));</span><br><span class="line"></span><br><span class="line">        // rpush:在list尾部对象添加值</span><br><span class="line">        System.out.println(&quot;rpush:&quot; + jedis.rpush(&quot;contacts&quot;, &quot;aa&quot;, &quot;bb&quot;));</span><br><span class="line"></span><br><span class="line">        // rpop:移除在list尾部值，返回移除的对象</span><br><span class="line">        System.out.println(&quot;rpop:&quot; + jedis.rpop(&quot;contacts&quot;));</span><br><span class="line"></span><br><span class="line">        // brpop:阻塞尾部对象抛出，指定超时时间，返回抛出值</span><br><span class="line">        System.out.println(&quot;brpop:&quot; + jedis.brpop(1, &quot;contacts&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;blpop:&quot; + jedis.blpop(1, &quot;contacts&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;blpop（阻塞1秒返回）:&quot; + jedis.blpop(1, &quot;contacts&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;----------------redis-List-----------------\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * redis中 set 类型常用操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSet() &#123;</span><br><span class="line">        System.out.println(&quot;----------------redis-Set-----------------&quot;);</span><br><span class="line">        jedis.del(&quot;phones&quot;);</span><br><span class="line">        jedis.del(&quot;phones_old&quot;);</span><br><span class="line">        jedis.del(&quot;phones_old_1&quot;);</span><br><span class="line">        jedis.del(&quot;phones_new&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // sadd:集合添加元素,返回添加成功后数据</span><br><span class="line">        System.out.println(&quot;sadd:&quot; + jedis.sadd(&quot;phones&quot;, &quot;13600000001&quot;, &quot;13300000001&quot;));</span><br><span class="line">        System.out.println(&quot;sadd:&quot; + jedis.sadd(&quot;phones&quot;, &quot;13600000002&quot;, &quot;13300000002&quot;));</span><br><span class="line"></span><br><span class="line">        // scard:返回集合中元素数</span><br><span class="line">        System.out.println(&quot;scard:&quot; + jedis.scard(&quot;phones&quot;));</span><br><span class="line"></span><br><span class="line">        jedis.sadd(&quot;phones_old&quot;, &quot;13600000002&quot;);</span><br><span class="line">        jedis.sadd(&quot;phones_old_1&quot;, &quot;13300000001&quot;);</span><br><span class="line"></span><br><span class="line">        // sdiff:首set与其他set之间的差集，返回差集值</span><br><span class="line">        System.out.println(&quot;sdiff:&quot; + jedis.sdiff(&quot;phones&quot;, &quot;phones_old&quot;, &quot;phones_old_1&quot;));</span><br><span class="line"></span><br><span class="line">        // sdiffstore:首set与其他set之间的差集保存至新set，返回差集数</span><br><span class="line">        System.out.println(&quot;sdiffstore:&quot; + jedis.sdiffstore(&quot;phones_new&quot;, &quot;phones&quot;, &quot;phones_old&quot;));</span><br><span class="line"></span><br><span class="line">        // sinter:返回集合的交集</span><br><span class="line">        System.out.println(&quot;sinter:&quot; + jedis.sinter(&quot;phones&quot;, &quot;phones_new&quot;));</span><br><span class="line"></span><br><span class="line">        // sismember:判断value是否为set的值</span><br><span class="line">        System.out.println(&quot;sismember:&quot; + jedis.sismember(&quot;phones&quot;, &quot;13600000001&quot;));</span><br><span class="line"></span><br><span class="line">        // smembers:返回集合中成员</span><br><span class="line">        System.out.println(&quot;smembers:&quot; + jedis.smembers(&quot;phones&quot;));</span><br><span class="line"></span><br><span class="line">        // smove:将首源set中元素移动目标set，返回移动数</span><br><span class="line">        System.out.println(&quot;smove:&quot; + jedis.smove(&quot;phones&quot;, &quot;phones_new&quot;, &quot;13600000002&quot;));</span><br><span class="line"></span><br><span class="line">        // spop:随机移除set的一元素，返回移除元素</span><br><span class="line">        System.out.println(&quot;spop:&quot; + jedis.spop(&quot;phones&quot;));</span><br><span class="line"></span><br><span class="line">        // srandmember:随机取出集合中一个元素</span><br><span class="line">        System.out.println(&quot;srandmember:&quot; + jedis.srandmember(&quot;phones_new&quot;));</span><br><span class="line"></span><br><span class="line">        // srem:删除集合中指定元素</span><br><span class="line">        System.out.println(&quot;srem:&quot; + jedis.srem(&quot;phones_new&quot;, &quot;13600000002&quot;));</span><br><span class="line"></span><br><span class="line">        // sunion:集合中并集</span><br><span class="line">        System.out.println(&quot;sunion:&quot; + jedis.sunion(&quot;phones&quot;, &quot;phones_new&quot;, &quot;phones_old&quot;));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;----------------redis-Set-----------------\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * redis中 SortedSet 类型常用操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSortedSet() &#123;</span><br><span class="line">        System.out.println(&quot;----------------redis-SortedSet-----------------&quot;);</span><br><span class="line">        jedis.del(&quot;scores&quot;);</span><br><span class="line">        jedis.del(&quot;scores_1&quot;);</span><br><span class="line">        jedis.del(&quot;scores_total&quot;);</span><br><span class="line">        jedis.del(&quot;score_inter&quot;);</span><br><span class="line">        jedis.del(&quot;score_max&quot;);</span><br><span class="line"></span><br><span class="line">        // zadd:sortedSet添加元素</span><br><span class="line">        System.out.println(&quot;zadd:&quot; + jedis.zadd(&quot;scores&quot;, 610.5, &quot;xx&quot;));</span><br><span class="line">        jedis.zadd(&quot;scores&quot;, 630, &quot;yy&quot;);</span><br><span class="line"></span><br><span class="line">        // zcard:返回sortedset中元素数</span><br><span class="line">        System.out.println(&quot;zcard:&quot; + jedis.zcard(&quot;scores&quot;));</span><br><span class="line"></span><br><span class="line">        // zcount:返回指定分值（包括）的元素数</span><br><span class="line">        System.out.println(&quot;zcount:&quot; + jedis.zcount(&quot;scores&quot;, 610, 620));</span><br><span class="line"></span><br><span class="line">        // zincrby:将指定值分数加分，返回加后的分数</span><br><span class="line">        System.out.println(&quot;zincrby:&quot; + jedis.zincrby(&quot;scores&quot;, 10, &quot;xx&quot;));</span><br><span class="line"></span><br><span class="line">        // zrange:返回指定坐标的值</span><br><span class="line">        System.out.println(&quot;zrange:&quot; + jedis.zrange(&quot;scores&quot;, 0, 1));</span><br><span class="line"></span><br><span class="line">        // zrangeByScore:返回指定分数范围内的对象</span><br><span class="line">        System.out.println(&quot;zrangeByScore:&quot; + jedis.zrangeByScore(&quot;scores&quot;, 600, 700));</span><br><span class="line"></span><br><span class="line">        // zrank:返回指定值的位置（分数低-&gt;高，0开始）</span><br><span class="line">        System.out.println(&quot;zrank:&quot; + jedis.zrank(&quot;scores&quot;, &quot;yy&quot;));</span><br><span class="line"></span><br><span class="line">        // zrevrank:返回指定值的位置（分数高-&gt;低，0开始）</span><br><span class="line">        System.out.println(&quot;zrevrank:&quot; + jedis.zrevrank(&quot;scores&quot;, &quot;yy&quot;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // zrem:删除，其中还有zremrangeByRank\zremrangeByScore</span><br><span class="line">        System.out.println(&quot;zrem:&quot; + jedis.zrem(&quot;scores&quot;, &quot;yy&quot;));</span><br><span class="line"></span><br><span class="line">        jedis.zadd(&quot;scores&quot;, 630, &quot;yy&quot;);</span><br><span class="line">        jedis.zadd(&quot;scores&quot;, 640, &quot;zz&quot;);</span><br><span class="line">        // zrevrange：获取指定位置数据（分数从高-&gt;低）</span><br><span class="line">        System.out.println(&quot;:&quot; + jedis.zrevrange(&quot;scores&quot;, 0, 1));</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;zrangeByScoreWithScores:&quot; + jedis.zrangeByScoreWithScores(&quot;scores&quot;, 600, 700));</span><br><span class="line"></span><br><span class="line">        // zscore:获取指定分数</span><br><span class="line">        System.out.println(&quot;zscore:&quot; + jedis.zscore(&quot;scores&quot;, &quot;xx&quot;));</span><br><span class="line">        jedis.zadd(&quot;scores_1&quot;, 630.5, &quot;xx&quot;);</span><br><span class="line">        jedis.zadd(&quot;scores_1&quot;, 610.5, &quot;bb&quot;);</span><br><span class="line">        jedis.zadd(&quot;scores_1&quot;, 622.5, &quot;cc&quot;);</span><br><span class="line"></span><br><span class="line">        // zunionstore:sortedset集合的并集并保存,如果集合中元素相同，则分数相加</span><br><span class="line">        System.out.println(&quot;zunionstore:&quot; + jedis.zunionstore(&quot;score_total&quot;, &quot;scores&quot;, &quot;scores_1&quot;));</span><br><span class="line"></span><br><span class="line">        ZParams zParams = new ZParams();</span><br><span class="line">        zParams.aggregate(ZParams.Aggregate.MAX);// 指定分数操作：+，最小，最大</span><br><span class="line">        zParams.weightsByDouble(1, 0.1);// 分数中的乘法因子</span><br><span class="line">        System.out.println(&quot;zunionstore:&quot; + jedis.zunionstore(&quot;score_max&quot;, zParams, &quot;scores&quot;, &quot;scores_1&quot;));</span><br><span class="line"></span><br><span class="line">        // zinterstore:集合元素取交集，相同元素值相加(默认)</span><br><span class="line">        System.out.println(&quot;zinterstore:&quot; + jedis.zinterstore(&quot;score_inter&quot;, &quot;scores&quot;, &quot;scores_1&quot;));</span><br><span class="line">        System.out.println(&quot;----------------redis-SortedSet-----------------\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/Spark-Core/" data-toggle="tooltip" data-placement="top" title="Spark Core">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/Spark/" data-toggle="tooltip" data-placement="top" title="Spark">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text"><span id="redis">Redis</span></span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text"><span id="redis&#x7B80;&#x4ECB;&#x53CA;&#x539F;&#x7406;">Redis&#x7B80;&#x4ECB;&#x53CA;&#x539F;&#x7406;</span></span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text"><span id="&#x4EC0;&#x4E48;&#x662F;redis">&#x4EC0;&#x4E48;&#x662F;redis</span></span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text"><span id="nosql&#x6570;&#x636E;&#x5E93;">NoSQL&#x6570;&#x636E;&#x5E93;</span></span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text"><span id="redis&#x7279;&#x70B9;">redis&#x7279;&#x70B9;</span></span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text"><span id="redis&#x5B89;&#x88C5;">Redis&#x5B89;&#x88C5;</span></span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text"><span id="redis-&#x914D;&#x7F6E;&#x8BE6;&#x89E3;">Redis &#x914D;&#x7F6E;&#x8BE6;&#x89E3;</span></span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text"><span id="redis&#x6570;&#x636E;&#x7C7B;&#x578B;">Redis&#x6570;&#x636E;&#x7C7B;&#x578B;</span></span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text"><span id="redis&#x7684;&#x6301;&#x4E45;&#x5316;&#x65B9;&#x5F0F;rdb&#x548C;aof">Redis&#x7684;&#x6301;&#x4E45;&#x5316;&#x65B9;&#x5F0F;RDB&#x548C;AOF</span></span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text"><span id="&#x4E3B;&#x4ECE;&#x590D;&#x5236;">&#x4E3B;&#x4ECE;&#x590D;&#x5236;</span></span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text"><span id="redis&#x54E8;&#x5175;sentinel&#x6A21;&#x5F0F;">Redis&#x54E8;&#x5175;&#xFF08;Sentinel&#xFF09;&#x6A21;&#x5F0F;</span></span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text"><span id="&#x53D1;&#x5E03;&#x8BA2;&#x9605;pubsub">&#x53D1;&#x5E03;&#x8BA2;&#x9605;(pub/sub)</span></span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.8.1.</span> <span class="toc-nav-text"><span id="&#x4EE3;&#x7801;&#x793A;&#x4F8B;">&#x4EE3;&#x7801;&#x793A;&#x4F8B;</span></span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.9.</span> <span class="toc-nav-text"><span id="redis-javaapi">Redis javaAPI</span></span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#数据库" title="数据库">数据库</a>
                        
                          <a class="tag" href="/tags/#redis" title="redis">redis</a>
                        
                          <a class="tag" href="/tags/#缓存" title="缓存">缓存</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="http://blog.csdn.net/fooelliot" target="_blank">CSDN fooelliot</a></li>
                    
                        <li><a href="http://github.com/janlle" target="_blank">GitHub janlle</a></li>
                    
                        <li><a href="https://www.cnblogs.com/ruolin/" target="_blank">博客园 janlle</a></li>
                    
                        <li><a href="https://www.jianshu.com/u/2c8b6b4a6523" target="_blank">简书 janlle</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>








<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/janlle">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; leone 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://wealip.cn">leone</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=janlle&repo=blogs&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://www.wealip.cn/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'xxx';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="http://www.wealip.cn/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
