<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="title: flumedate: 2018-01-05 11:31:12tags: [linux, 大数据, flume]categories: flume flumeflume 简介及核心概念什么是flumeFlume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，目前是Apache的顶级项目。Flume支持在日志系统中定制各类数据发送方，用于收集数据；">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/02/04/flume/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="title: flumedate: 2018-01-05 11:31:12tags: [linux, 大数据, flume]categories: flume flumeflume 简介及核心概念什么是flumeFlume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，目前是Apache的顶级项目。Flume支持在日志系统中定制各类数据发送方，用于收集数据；">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-02-04T12:32:04.312Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="title: flumedate: 2018-01-05 11:31:12tags: [linux, 大数据, flume]categories: flume flumeflume 简介及核心概念什么是flumeFlume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，目前是Apache的顶级项目。Flume支持在日志系统中定制各类数据发送方，用于收集数据；">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-flume" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/flume/" class="article-date">
  <time datetime="2019-02-04T12:16:13.791Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: flume<br>date: 2018-01-05 11:31:12<br>tags: [linux, 大数据, flume]<br>categories: flume</p>
<h1 id="flume"><a href="#flume" class="headerlink" title="flume"></a>flume</h1><h2 id="flume-简介及核心概念"><a href="#flume-简介及核心概念" class="headerlink" title="flume 简介及核心概念"></a>flume 简介及核心概念</h2><h3 id="什么是flume"><a href="#什么是flume" class="headerlink" title="什么是flume"></a>什么是flume</h3><p>Flume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，目前是Apache的顶级项目。Flume支持在日志系统中定制各类数据发送方，用于收集数据；同时，Flume提供对数据进行简单处理，并写到各种数据接受方（可定制）的能力。</p>
<h3 id="flume-优点"><a href="#flume-优点" class="headerlink" title="flume 优点"></a>flume 优点</h3><p>1、可靠性<br>当节点出现故障时，日志能够被传送到其他节点上而不会丢失。Flume提供了三种级别的可靠性保障，从强到弱依次分别为：</p>
<ul>
<li>end-to-end（收到数据agent首先将event写到磁盘上，当数据传送成功后，再删除；如果数据发送失败，可以重新发送。），</li>
<li>Store on failure（这也是scribe采用的策略，当数据接收方crash时，将数据写到本地，待恢复后，继续发送），</li>
<li>Best effort（数据发送到接收方后，不会进行确认）。</li>
</ul>
<p>2、可扩展性<br>Flume采用了三层架构，分别为agent，collector和storage，每一层均可以水平扩展。<br>其中，所有agent和collector由master统一管理，这使得系统容易监控和维护，且master允许有多个（使用ZooKeeper进行管理和负载均衡），这就避免了单点故障问题。</p>
<p>3、可管理性</p>
<ul>
<li>所有agent和colletor由master统一管理，这使得系统便于维护。</li>
<li>多master情况，Flume利用ZooKeeper和gossip，保证动态配置数据的一致性。</li>
<li>用户可以在master上查看各个数据源或者数据流执行情况，且可以对各个数据源配置和动态加载。</li>
<li>Flume提供了web 和shell script command两种形式对数据流进行管理。</li>
</ul>
<p>4、功能可扩展性</p>
<ul>
<li>用户可以根据需要添加自己的agent，collector或者storage。</li>
<li>此外，Flume自带了很多组件，包括各种agent（file， syslog等），collector和storage（file，HDFS等）。</li>
</ul>
<p>5、文档丰富，社区活跃<br>Flume 已经成为 Hadoop 生态系统的标配，它的文档比较丰富，社区比较活跃，方便我们学习。</p>
<h3 id="flume-agent"><a href="#flume-agent" class="headerlink" title="flume agent"></a>flume agent</h3><p>Flume agent每个agent是一个独立的Java进程，从客户端（其他agent）接收数据然后转发到下一个destination（sink(沉槽) | agent）<br>Agent包含三个组件:</p>
<ul>
<li>A. Source（源）-&gt;生成数据的地方</li>
</ul>
<blockquote>
<p>从事件生成器接收数据，以event事件的形式传给一个或多个channel</p>
</blockquote>
<ul>
<li>B. Channel（通道）</li>
</ul>
<blockquote>
<p>从source中接受flume event，作为临时存放地，缓存到buffer中，直到sink<br>将其消费掉，是source和sink之间的桥梁<br>Channel是事务的，可以和多个source或sink协同</p>
</blockquote>
<ul>
<li>C.sink（沉槽）</li>
</ul>
<blockquote>
<p>存放数据到HDFS，从channel中消费event，并分发给destination，sink的<br>Destination 也可以是另一个agent或者HDFS，HBASE<br>注意：一个flume的agent，可以有多个source，channel，sink</p>
</blockquote>
<h3 id="flume核心组件介绍"><a href="#flume核心组件介绍" class="headerlink" title="flume核心组件介绍"></a>flume核心组件介绍</h3><p>Source： 完成对日志数据的收集，分成transtion 和 event 打入到channel之中， Flume提供了各种source的实现，包括Avro Source、 Exce Source、 Spooling<br>Directory Source、 NetCat Source、 Syslog Source、 Syslog TCP Source、Syslog UDP Source、 HTTP Source、 HDFS Source， etc。</p>
<p>Channel： Channel用于连接Source和Sink，Source将日志信息发送到Channel，Sink从Channel消费日志信息；Channel是中转日志信息的一个临时存储，保存有Source组件传递过来的日志信息。， flume提供了Memory Channel、 JDBC Chanel、 File Channel，etc</p>
<p>Sink： Flume Sink取出Channel中的数据，进行相应的存储文件系统，数据库，或者提交到远程服务器。包括HDFS sink、 Logger sink、 Avro sink、 File Roll sink、 Null sink、 HBasesink， etc。</p>
<h2 id="flume安装"><a href="#flume安装" class="headerlink" title="flume安装"></a>flume安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"># 下载</span><br><span class="line">get http://mirrors.tuna.tsinghua.edu.cn/apache/flume/1.8.0/apache-flume-1.8.0-bin.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">tar –zxvf apache-flume-1.8.0-bin.tar.gz</span><br><span class="line"></span><br><span class="line"># 添加配置文件（读取指定文件写入HDFS中）</span><br><span class="line"></span><br><span class="line"># Name the components on this agent</span><br><span class="line">a1.sources = r1</span><br><span class="line">a1.sinks = k1</span><br><span class="line">a1.channels = c1</span><br><span class="line"># Describe/configure the source</span><br><span class="line"></span><br><span class="line">a1.sources.r1.type = exec</span><br><span class="line">a1.sources.r1.command = tail -F /export/logs/web.log</span><br><span class="line"></span><br><span class="line"># Describe the sink</span><br><span class="line">a1.sinks.k1.type = hdfs</span><br><span class="line">a1.sinks.k1.hdfs.path =hdfs://node-1:9000/app_log/%y-%m-%d/%H-%M</span><br><span class="line"># 保存到HDFS上的前缀</span><br><span class="line">a1.sinks.k1.hdfs.filePrefix = weichat_log</span><br><span class="line">a1.sinks.k1.hdfs.fileSuffix = .dat</span><br><span class="line">a1.sinks.k1.hdfs.batchSize= 100</span><br><span class="line">a1.sinks.k1.hdfs.fileType = DataStream</span><br><span class="line">a1.sinks.k1.hdfs.writeFormat =Text</span><br><span class="line"></span><br><span class="line"># 配置存储在HDFS上的文件大小单位(bytes)</span><br><span class="line">a1.sinks.k1.hdfs.rollSize = 262144</span><br><span class="line"># 写入多少个event数据后滚动文件(事件个数)</span><br><span class="line">a1.sinks.k1.hdfs.rollCount = 10</span><br><span class="line"># 文件滚动之前的等待时间(秒)</span><br><span class="line">a1.sinks.k1.hdfs.rollInterval = 120</span><br><span class="line"></span><br><span class="line"># 1分钟就改目录（创建目录）</span><br><span class="line">a1.sinks.k1.hdfs.round = true</span><br><span class="line">a1.sinks.k1.hdfs.roundValue = 1</span><br><span class="line">a1.sinks.k1.hdfs.roundUnit = minute</span><br><span class="line"></span><br><span class="line">a1.sinks.k1.hdfs.useLocalTimeStamp = true</span><br><span class="line"></span><br><span class="line"># Use a channel which buffers events in memory</span><br><span class="line">a1.channels.c1.type = memory</span><br><span class="line">a1.channels.c1.capacity = 1000</span><br><span class="line">a1.channels.c1.transactionCapacity = 100</span><br><span class="line"></span><br><span class="line"># Bind the source and sink to the channel</span><br><span class="line">a1.sources.r1.channels = c1</span><br><span class="line">a1.sinks.k1.channel = c1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 添加配置文件（读取指定目录写入HDFS中）</span><br><span class="line"></span><br><span class="line">#定义三大组件的名称</span><br><span class="line">ag1.sources = source1</span><br><span class="line">ag1.sinks = sink1</span><br><span class="line">ag1.channels = channel1</span><br><span class="line"></span><br><span class="line"># 配置source组件</span><br><span class="line">ag1.sources.source1.type = spooldir</span><br><span class="line">ag1.sources.source1.spoolDir = /export/logs/</span><br><span class="line">ag1.sources.source1.fileSuffix=.FINISHED</span><br><span class="line">ag1.sources.source1.deserializer.maxLineLength=5120</span><br><span class="line"></span><br><span class="line"># 配置sink组件</span><br><span class="line">ag1.sinks.sink1.type = hdfs</span><br><span class="line">ag1.sinks.sink1.hdfs.path =hdfs://hdp-01:9000/access_log/%y-%m-%d/%H-%M</span><br><span class="line">ag1.sinks.sink1.hdfs.filePrefix = app_log</span><br><span class="line">ag1.sinks.sink1.hdfs.fileSuffix = .log</span><br><span class="line">ag1.sinks.sink1.hdfs.batchSize= 100</span><br><span class="line">ag1.sinks.sink1.hdfs.fileType = DataStream</span><br><span class="line">ag1.sinks.sink1.hdfs.writeFormat =Text</span><br><span class="line"></span><br><span class="line">## roll：滚动切换：控制写文件的切换规则</span><br><span class="line">## 按文件体积（字节）来切   </span><br><span class="line">ag1.sinks.sink1.hdfs.rollSize = 512000    </span><br><span class="line">## 按event条数切</span><br><span class="line">ag1.sinks.sink1.hdfs.rollCount = 1000000  </span><br><span class="line">## 按时间间隔切换文件</span><br><span class="line">ag1.sinks.sink1.hdfs.rollInterval = 60    </span><br><span class="line"></span><br><span class="line">## 控制生成目录的规则</span><br><span class="line">ag1.sinks.sink1.hdfs.round = true</span><br><span class="line">ag1.sinks.sink1.hdfs.roundValue = 10</span><br><span class="line">ag1.sinks.sink1.hdfs.roundUnit = minute</span><br><span class="line"></span><br><span class="line">ag1.sinks.sink1.hdfs.useLocalTimeStamp = true</span><br><span class="line"></span><br><span class="line"># channel组件配置</span><br><span class="line">ag1.channels.channel1.type = memory</span><br><span class="line">## event条数</span><br><span class="line">ag1.channels.channel1.capacity = 500000   </span><br><span class="line">##flume事务控制所需要的缓存容量600条event</span><br><span class="line">ag1.channels.channel1.transactionCapacity = 600  </span><br><span class="line"></span><br><span class="line"># 绑定source、channel和sink之间的连接</span><br><span class="line">ag1.sources.source1.channels = channel1</span><br><span class="line">ag1.sinks.sink1.channel = channel1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动flume</span><br><span class="line"></span><br><span class="line">$FLUME_HOME/bin/flume-ng agent -c conf -f conf/tail-hdfs.conf -n a1 -Dflume.root.logger=INFO,console</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/flume/" data-id="cjrqbftxu000dakc4ml7c3c9n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/04/Git/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2019/02/04/Docker/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/04/Crontab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/CentOS-7.5-init/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/bash/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/awk/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/后台项目技术规范/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>