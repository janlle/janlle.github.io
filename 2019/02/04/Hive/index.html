<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="hivehive简介和基本概念什么是hivehive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。 最初，Hive是由Facebook开发">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/2019/02/04/Hive/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="hivehive简介和基本概念什么是hivehive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。 最初，Hive是由Facebook开发">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-01-20T15:17:03.328Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
<meta name="twitter:description" content="hivehive简介和基本概念什么是hivehive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。 最初，Hive是由Facebook开发">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Hive" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/04/Hive/" class="article-date">
  <time datetime="2019-02-04T12:16:13.924Z" itemprop="datePublished">2019-02-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="hive"><a href="#hive" class="headerlink" title="hive"></a>hive</h1><h2 id="hive简介和基本概念"><a href="#hive简介和基本概念" class="headerlink" title="hive简介和基本概念"></a>hive简介和基本概念</h2><h3 id="什么是hive"><a href="#什么是hive" class="headerlink" title="什么是hive"></a>什么是hive</h3><p>hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。 其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。</p>
<p>最初，Hive是由Facebook开发，后来由Apache软件基金会开发，并作为进一步将它作为名义下Apache Hive为一个开源项目。Hive 没有专门的数据格式。 Hive 可以很好的工作在 Thrift 之上，控制分隔符，也允许用户指定数据格式。Hive不适用于在线事务处理。 它最适用于传统的数据仓库任务。</p>
<h3 id="Hive的的优点及应用场景"><a href="#Hive的的优点及应用场景" class="headerlink" title="Hive的的优点及应用场景"></a>Hive的的优点及应用场景</h3><ul>
<li><p>Hive可以自由的扩展集群的规模，一般情况下不需要重启服务。</p>
</li>
<li><p>Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。</p>
</li>
<li><p>良好的容错性，节点出现问题SQL仍可完成执行。</p>
</li>
<li><p>操作接口采用类SQL语法，提供快速开发的能力(简单、容易上手);</p>
</li>
<li><p>避免了去写MapReduce，减少开发人员的学习成本;</p>
</li>
<li><p>统一的元数据管理，可与impala/spark等共享元数据;</p>
</li>
<li><p>易扩展(HDFS+MapReduce：可以扩展集群规模；支持自定义函数);</p>
</li>
<li><p>数据的离线处理；比如：日志分析，海量结构化数据离线分析;</p>
</li>
<li><p>Hive的执行延迟比较高，因此hive常用于数据分析的，对实时性要求 不高的场合;</p>
</li>
<li><p>Hive优势在于处理大数据，对于处理小数据没有优势，因为Hive的执 行延迟比较高;</p>
</li>
</ul>
<h3 id="数据仓库概念"><a href="#数据仓库概念" class="headerlink" title="数据仓库概念"></a>数据仓库概念</h3><p>数据仓库（Data Warehouse）是一个面向主题的（Subject Oriented）、集成的（Integrated）、相对稳定的（Non-Volatile）、反应历史变化（Time Variant）的数据集合，用于支持管理决策。数据仓库体系结构通常含四个层次：数据源、数据存储和管理、数据服务、数据应用。</p>
<ul>
<li><p>数据源：是数据仓库的数据来源，含外部数据、现有业务系统和文档资料等；</p>
</li>
<li><p>数据集成：完成数据的抽取、清洗、转换和加载任务，数据源中的数据采用ETL（Extract-Transform-Load）工具以固定的周期加载到数据仓库中。</p>
</li>
<li><p>数据存储和管理：此层次主要涉及对数据的存储和管理，含数据仓库、数据集市、数据仓库检测、运行与维护工具和元数据管理等。</p>
</li>
<li><p>数据服务：为前端和应用提供数据服务，可直接从数据仓库中获取数据供前端应用使用，也可通过OLAP（OnLine Analytical Processing，联机分析处理）服务器为前端应用提供负责的数据服务。</p>
</li>
<li><p>数据应用：此层次直接面向用户，含数据查询工具、自由报表工具、数据分析工具、数据挖掘工具和各类应用系统。</p>
</li>
</ul>
<h3 id="Hive中表的分类"><a href="#Hive中表的分类" class="headerlink" title="Hive中表的分类"></a>Hive中表的分类</h3><p>内部表：什么是内部表需要对比外部表来看删表时数据和表一起删除。</p>
<p>外部表：数据已经存在于HDFS，外部表只是走一个过程，加载数据和创建表同时完成，不会移动到数据仓库目录中，仅仅是和数据建立了一个连接，删表数据不会删除数据。</p>
<p>分区表：在Hive Select查询中，一般会扫描整个表内容，会消耗很多时间做没必要的工作。 分区表指的是在创建表时，指定partition的分区空间。扫描时可以只扫描某一个分区的数据，分区表存储时分局所设立的分区分别存储数据（分区字段就是一个文件夹的标识）分区表可以是内部表也可以是外部表。</p>
<p>分桶表：对于每一个表（table）或者分区，Hive可以进一步组织成桶，也就是说捅是更为细粒度的数据范困划分。分桶表是对列值取哈希值的方式，将不同数据放到不同文件中存储,一个文件对应一个桶由列的哈希值除以桶的个数来决定每条数据划分在哪个桶中</p>
<h3 id="Hive架构体系"><a href="#Hive架构体系" class="headerlink" title="Hive架构体系"></a>Hive架构体系</h3><ul>
<li><p>用户接口主要有三个：CLI，Client 和 WUI。其中最常用的是CLI，Cli启动的时候，会同时启动一个Hive副本。Client是Hive的客户端，用户连接至Hive Server。在启动 Client模式的时候，需要指出Hive Server所在节点，并且在该节点启动Hive Server。 WUI是通过浏览器访问Hive。</p>
</li>
<li><p>Hive将元数据存储在数据库中，如mysql、derby。Hive中的元数据包括表的名字，表的列和分区及其属性，表的属性（是否为外部表等），表的数据所在目录等。</p>
</li>
<li><p>解释器、编译器、优化器完成HQL查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在HDFS中，并在随后有MapReduce调用执行。</p>
</li>
<li><p>Hive的数据存储在HDFS中，大部分的查询计算由MapReduce完成（包含<em>的查询，比如select </em> from table不会生成MapRedcue任务），Hive将元数据存储在RDBMS中，</p>
</li>
</ul>
<h3 id="Hive核心组件"><a href="#Hive核心组件" class="headerlink" title="Hive核心组件"></a>Hive核心组件</h3><p><strong>Driver</strong></p>
<p>实现了session handler，在JDBC/ODBC接口上实现了执行和获取信息的API。</p>
<p><strong>Compiler</strong></p>
<p>该组件用于对不同的查询表达式做解析查询，语义分析，最终会根据从metastore中查询到的表和分区元数据生成一个execution plain。</p>
<p><strong>Execution Egine</strong></p>
<p>该组件会执行由compiler创建的execution。其中plan从数据结构上来看，是一个DAG，该组件会管理plan的不同stage与组件中执行这些plan之间的依赖。</p>
<p><strong>Metastore</strong></p>
<p>Hive的metastore组件是hive元数据集中存放地。该组件存储了包括变量表中列和列类型等结构化的信息以及数据仓库中的分区信息（包括列和列类型信息，读写数据时必要的序列化和反序列化信息，数据被存储在HDFS文件中的位置）。Metastore组件包括两个部分：metastore services和Meta storage database。</p>
<h3 id="hive的特点"><a href="#hive的特点" class="headerlink" title="hive的特点"></a>hive的特点</h3><ul>
<li><p>通过SQL轻松访问数据的工具，从而实现数据仓库任务（如提取/转换/加载（ETL），报告和数据分析）。</p>
</li>
<li><p>一种对各种数据格式施加结构的机制</p>
</li>
<li><p>访问直接存储在Apache HDFS或其他数据存储系统（如Apache HBase）中的文件</p>
</li>
<li><p>通过Apache Tez，Apache Spark或MapReduce执行查询</p>
</li>
<li><p>程序语言与HPL-SQL</p>
</li>
<li><p>通过Hive LLAP，Apache YARN和Apache Slider进行亚秒级查询检索。</p>
</li>
</ul>
<h3 id="Hive与Hadoop生态系统中其他组件的关系"><a href="#Hive与Hadoop生态系统中其他组件的关系" class="headerlink" title="Hive与Hadoop生态系统中其他组件的关系"></a>Hive与Hadoop生态系统中其他组件的关系</h3><ul>
<li><p>Hive依赖于HDFS存储数据，依赖MR处理数据；</p>
</li>
<li><p>Pig可作为Hive的替代工具，是一种数据流语言和运行环境，适合用于在Hadoop平台上查询半结构化数据集，用于与ETL过程的一部分，即将外部数据装载到Hadoop集群中，转换为用户需要的数据格式；</p>
</li>
<li><p>HBase是一个面向列的、分布式可伸缩的数据库，可提供数据的实时访问功能，而Hive只能处理静态数据，主要是BI报表数据，Hive的初衷是为减少复杂MR应用程序的编写工作，HBase则是为了实现对数据的实时访问</p>
</li>
</ul>
<h2 id="hive-安装和客户端操作"><a href="#hive-安装和客户端操作" class="headerlink" title="hive 安装和客户端操作"></a>hive 安装和客户端操作</h2><h3 id="hive的安装"><a href="#hive的安装" class="headerlink" title="hive的安装"></a>hive的安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"># 首先需要安装hadoop、mysql[参见](http://wwww.baidu.com)</span><br><span class="line"></span><br><span class="line"># 下载</span><br><span class="line">wget http://mirror.bit.edu.cn/apache/hive/hive-2.1.1/apache-hive-2.1.1-bin.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">tar -zxvf apache-hive-2.1.1-bin.tar.gz </span><br><span class="line"></span><br><span class="line">cp $HIVE_HOME/conf/hive-env.sh.template hive-env.sh</span><br><span class="line"></span><br><span class="line"># 新增两行</span><br><span class="line">export HADOOP_HOME=$HADOOP_HOME</span><br><span class="line">export HIVE_CONF_DIR=$HIVE_HOME/conf</span><br><span class="line"></span><br><span class="line">## 新增hive-site.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;&lt;!--</span><br><span class="line">   Licensed to the Apache Software Foundation (ASF) under one or more</span><br><span class="line">   contributor license agreements.  See the NOTICE file distributed with</span><br><span class="line">   this work for additional information regarding copyright ownership.</span><br><span class="line">   The ASF licenses this file to You under the Apache License, Version 2.0</span><br><span class="line">   (the &quot;License&quot;); you may not use this file except in compliance with</span><br><span class="line">   the License.  You may obtain a copy of the License at</span><br><span class="line"></span><br><span class="line">       http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"></span><br><span class="line">   Unless required by applicable law or agreed to in writing, software</span><br><span class="line">   distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="line">   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line">   See the License for the specific language governing permissions and</span><br><span class="line">   limitations under the License.</span><br><span class="line">--&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;jdbc:mysql://ip:3306/hive?createDatabaseIfNotExist=true&amp;amp;useSSL=false&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;root&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">    &lt;property&gt;</span><br><span class="line">        &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</span><br><span class="line">        &lt;value&gt;password&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line"></span><br><span class="line"> &lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line"># 拷贝mysql的驱动到$HIVE_HOME/lib下</span><br><span class="line"></span><br><span class="line"># 初始化hive</span><br><span class="line">$HIVE_HOME/bin/schematool -dbType mysql -initSchema</span><br><span class="line"></span><br><span class="line"># 检测hive是否安装成功</span><br><span class="line">$HIVE_HOME/bin/hive</span><br><span class="line"></span><br><span class="line"># 启动hive服务</span><br><span class="line">$HIVE_HOME/bin/hiveserver2</span><br><span class="line"></span><br><span class="line"># 第一种连接 hivesever 的方式</span><br><span class="line">$HIVE_HOME/bin/beenline</span><br><span class="line"></span><br><span class="line"># 输入用户名:你主机的用户 密码:直接输入回车</span><br><span class="line">!connect jdbc:hive2://ip:10000</span><br><span class="line"></span><br><span class="line"># 第二种连接 hiveServer 的方式</span><br><span class="line">$HIVE_HOME/bin/beenline -u jdbc:hive2://ip:10000 -u root</span><br></pre></td></tr></table></figure>
<h3 id="hive-命令行操作"><a href="#hive-命令行操作" class="headerlink" title="hive 命令行操作"></a>hive 命令行操作</h3><blockquote>
<p>hive的sql操作和mysql差不多</p>
</blockquote>
<ul>
<li>查看所有数据库</li>
</ul>
<p><code>show databases;</code></p>
<ul>
<li>创建数据库</li>
</ul>
<p><code>create database db1;</code></p>
<ul>
<li>使用指定数据</li>
</ul>
<p><code>use db1;</code></p>
<ul>
<li>创内部建表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(id int, name string, sex string, age int,</span><br><span class="line"> department string)row format delimited fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除表</li>
</ul>
<p><code>drop table t_user;</code></p>
<ul>
<li>插入数据</li>
</ul>
<p><code>insert into t_user values(95013,&quot;老王&quot;,&quot;男&quot;,18,&quot;IS&quot;);</code></p>
<ul>
<li>查询表中的数据</li>
</ul>
<p><code>select * from t_user limit 1;</code></p>
<ul>
<li>创建外部表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_user(id int, name string, sex string, age int, </span><br><span class="line">    department string)row format delimited fields terminated by</span><br><span class="line">     &apos;,&apos; location &apos;/app-log/data&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>创建分区表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create external table t_user(id int, name string, sex string, </span><br><span class="line">    age int, department string) partitioned by (create_time string) </span><br><span class="line">row format delimited fields terminated by &apos;,&apos; location &apos;/app-log&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>分区表从本地文件系统加载数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &apos;/root/2018-12-02.log&apos; into table t_user partition(create_time=20181202);</span><br></pre></td></tr></table></figure>
<ul>
<li>insert单条插入的方式往分区表中插入数据：</li>
</ul>
<p><code>insert into t_user partition (create_time=&quot;20181201&quot;) values(95019,&quot;老王&quot;,&quot;男&quot;,18,&quot;IS&quot;);</code></p>
<ul>
<li>删除Hive分区表中的分区</li>
</ul>
<p><code>alter table t_user drop partition(create_time=&quot;20181203&quot;);</code></p>
<ul>
<li>创建临时表TEMPORARY代表这是一个临时表。</li>
</ul>
<p><code>create temporary table t_temp(id int,name string);</code></p>
<ul>
<li>创建多级分区表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_user2(id int, content string)</span><br><span class="line">partitioned by (day int,hour int)</span><br><span class="line">row fromat delimited fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>多级分区表插入数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into t_user2 partition(day=9,hour=1) values(1,&quot;leone&quot;),(2,&quot;tom&quot;),(3,&quot;jandy&quot;),(4,&quot;jack&quot;);</span><br></pre></td></tr></table></figure>
<ul>
<li>添加分区</li>
</ul>
<p><code>alter table t_user2 add partition (day=5, hour=9);</code></p>
<ul>
<li>分桶表 (开启hive的分桶表开关set hive.enforce.bucketing=true;)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create table t_user3(id int, name string, age int) </span><br><span class="line">clustered by (age) into 4 buckets row format delimited </span><br><span class="line">fields terminated by &apos;,&apos;;</span><br></pre></td></tr></table></figure>
<ul>
<li>分桶表插入数据只可以使用insert</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insert into t_user3 values(1, &quot;james&quot;, 19),(2, &quot;andy&quot;, 35),(3, &quot;tom&quot;, 18),</span><br><span class="line">(4, &quot;jerry&quot;, 23),(5, &quot;leone&quot;, 25),(6, &quot;kobe&quot;, 45),(7, &quot;justin&quot;, 29),(8, &quot;colin&quot;, 13);</span><br></pre></td></tr></table></figure>
<h3 id="hive-java客户端操作"><a href="#hive-java客户端操作" class="headerlink" title="hive java客户端操作"></a>hive java客户端操作</h3><p>pom:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hive-jdbc&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.hive&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;hive-exec&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.3.4&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.12&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;3.7.0&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;source&gt;1.8&lt;/source&gt;</span><br><span class="line">                    &lt;target&gt;1.8&lt;/target&gt;</span><br><span class="line">                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br></pre></td></tr></table></figure></p>
<p>java：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.sql.Connection;</span><br><span class="line">import java.sql.DriverManager;</span><br><span class="line">import java.sql.ResultSet;</span><br><span class="line">import java.sql.Statement;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;p&gt; jdbc连接hive</span><br><span class="line"> *</span><br><span class="line"> * @author leone</span><br><span class="line"> * @since 2018-06-17</span><br><span class="line"> **/</span><br><span class="line">public class HiveClientTest &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 1,123.25.51.81,https://www.google.com,2019-01-21</span><br><span class="line">     * 2,123.25.51.82,https://www.youku.com,2019-01-22</span><br><span class="line">     * 3,123.25.51.83,https://www.taobao.com,2019-01-23</span><br><span class="line">     * 4,123.25.51.84,https://www.baidu.com,2019-01-24</span><br><span class="line">     * 5,123.25.51.85,https://www.jd.com,2019-01-26</span><br><span class="line">     * 6,123.25.51.86,https://www.tianmao.com,2019-01-27</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private Connection connection;</span><br><span class="line"></span><br><span class="line">    private Statement statement;</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    public void init() throws Exception &#123;</span><br><span class="line">        Class.forName(&quot;org.apache.hive.jdbc.HiveDriver&quot;);</span><br><span class="line">        connection = DriverManager.getConnection(&quot;jdbc:hive2://node-1:10000/db1&quot;, &quot;root&quot;, &quot;&quot;);</span><br><span class="line">        statement = connection.createStatement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询表数据</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void selectTest() throws Exception &#123;</span><br><span class="line">        ResultSet result = statement.executeQuery(&quot;select * from t_log&quot;);</span><br><span class="line">        System.out.println(&quot;-----------------------------------------------------&quot;);</span><br><span class="line">        System.out.println(&quot;id\tip\turl\ttime&quot;);</span><br><span class="line">        System.out.println(&quot;-----------------------------------------------------&quot;);</span><br><span class="line">        while (result.next()) &#123;</span><br><span class="line">            int id = result.getInt(1);</span><br><span class="line">            String ip = result.getString(2);</span><br><span class="line">            String url = result.getString(3);</span><br><span class="line">            String time = result.getString(4);</span><br><span class="line">            System.out.println(&quot;|&quot; + id + &quot;\t&quot; + ip + &quot;\t&quot; + url + &quot;\t&quot; + time + &quot;|&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;-----------------------------------------------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建表</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void dropTableTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;drop table if exists t_log&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除数据库</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void dropDatabaseTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;drop database if exists db1&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建表</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void createTableTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;create table t_log(id int, ip string, url string, time string)&quot; +</span><br><span class="line">                &quot; row format delimited fields terminated by &apos;,&apos;&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询所有表</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void showTablesTest() throws Exception &#123;</span><br><span class="line">        ResultSet resultSet = statement.executeQuery(&quot;show tables&quot;);</span><br><span class="line">        while (resultSet.next()) &#123;</span><br><span class="line">            System.out.println(resultSet.getString(1));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加载数据</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void loadDataTest() throws Exception &#123;</span><br><span class="line">        String filePath = &quot;/root/app.log&quot;;</span><br><span class="line"></span><br><span class="line">        String sql = &quot;load data local inpath &apos;&quot; + filePath + &quot;&apos; overwrite into table t_log&quot;;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 统计查询（会运行 mapReduce 作业）</span><br><span class="line">     *</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void countDataTest() throws Exception &#123;</span><br><span class="line">        String sql = &quot;select count(1) from t_log&quot;;</span><br><span class="line">        ResultSet resultSet = statement.executeQuery(sql);</span><br><span class="line">        while (resultSet.next()) &#123;</span><br><span class="line">            System.out.println(resultSet.getInt(1));</span><br><span class="line">        &#125;</span><br><span class="line">        boolean flag = statement.execute(sql);</span><br><span class="line">        System.out.println(&quot;running sql:&quot; + sql + (flag ? &quot; &quot; : &quot;failed success&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/02/04/Hive/" data-id="cjrqbftyz000xakc4i3c71c3m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/04/java/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2019/02/04/HBase/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/02/04/Crontab/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/CentOS-7.5-init/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/bash/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/awk/">(no title)</a>
          </li>
        
          <li>
            <a href="/2019/02/04/后台项目技术规范/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>